# ุฅุตูุงุญ ุฎุทุฃ ุนููุฏ Currency ูู ุงูุชูุงุฑูุฑ

## ๐ ุงููุดููุฉ

ุนูุฏ ุนุฑุถ ุงูุชูุงุฑูุฑุ ุธูุฑ ุงูุฎุทุฃ ุงูุชุงูู:

```
GET | 400 | /rest/v1/companies?select=user_id%2Cbase_currency%2Ccurrency&id=eq.9c92a597-8c88-42a7-ad02-bd4a25b755ee
proxy_status: "PostgREST; error=42703"
```

### ุชุญููู ุงูุฎุทุฃ:

- **error=42703**: ุฎุทุฃ PostgreSQL ูุนูู "column does not exist"
- **ุงูุทูุจ**: `select=user_id,base_currency,currency`
- **ุงููุดููุฉ**: ูุญุงููุฉ ุงููุตูู ูุนููุฏ `currency` ุงูุฐู ูุง ููุฌุฏ ูู ุฌุฏูู `companies`
- **ุงูุณุจุจ**: ุชู ุชุบููุฑ ุงุณู ุงูุนููุฏ ูู `currency` ุฅูู `base_currency` ูู migration ุณุงุจู

---

## ๐ ุงูุชุญููู

### 1. ุงูุจุญุซ ูู ุงูููุฏ ุงููุตุฏุฑู

ุชู ุงูุจุญุซ ูู ุฌููุน ุงููููุงุช ุงูุชุงููุฉ:
- โ `lib/currency-sync.ts` - ูุณุชุฎุฏู `base_currency` ุจุดูู ุตุญูุญ
- โ `app/api/sync-currency/route.ts` - ูุณุชุฎุฏู `base_currency` ุจุดูู ุตุญูุญ
- โ `components/CurrencyMismatchAlert.tsx` - ูุณุชุฎุฏู `base_currency` ุจุดูู ุตุญูุญ
- โ `app/settings/page.tsx` - ูุณุชุฎุฏู `base_currency` ุจุดูู ุตุญูุญ
- โ `app/api/my-company/route.ts` - ูุณุชุฎุฏู `base_currency` ุจุดูู ุตุญูุญ
- โ `hooks/use-user-context.ts` - ูุง ูุทูุจ currency ูู companies
- โ `lib/company.ts` - ูุง ูุทูุจ currency ูู companies

### 2. ุงูุชุดุงู ุงูุณุจุจ ุงูุญูููู

ุชู ุงูุชุดุงู ุฃู ุงููุดููุฉ ูุงูุช ูู **Build Cache** ุงููุฏูู:
- ุงููููุงุช ุงููุตุฏุฑูุฉ ุตุญูุญุฉ 100%
- ููู ูุฌูุฏ `.next` ูุญุชูู ุนูู ููุฏ ููุฌููุน (compiled) ูุฏูู
- ุงูููุฏ ุงููุฏูู ูุงู ูุญุชูู ุนูู ุทูุจุงุช ุชุณุชุฎุฏู `currency` ุจุฏูุงู ูู `base_currency`

---

## โ ุงูุญู ุงููุทุจู

### 1. ุญุฐู Build Cache

```powershell
Remove-Item -Path ".next" -Recurse -Force
```

### 2. ุฅุนุงุฏุฉ ุงูุจูุงุก

```bash
npm run build
```

### 3. ุงููุชูุฌุฉ

```
โ Compiled successfully in 39.9s
โ Collecting page data using 7 workers in 4.6s
โ Generating static pages using 7 workers (203/203) in 7.8s
โ Finalizing page optimization in 61.3ms
```

---

## ๐ ุงูุชุฃุซูุฑ

### ูุจู ุงูุฅุตูุงุญ:
- โ ุฎุทุฃ 400 ุนูุฏ ุนุฑุถ ุงูุชูุงุฑูุฑ
- โ `error=42703` - column "currency" does not exist
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุฆุฉ

### ุจุนุฏ ุงูุฅุตูุงุญ:
- โ ุงูุชูุงุฑูุฑ ุชุนูู ุจุฏูู ุฃุฎุทุงุก
- โ ุฌููุน ุงูุทูุจุงุช ุชุณุชุฎุฏู `base_currency` ุงูุตุญูุญ
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุงุญุชุฑุงููุฉ

---

## ๐ฏ ุงูุฏุฑูุณ ุงููุณุชูุงุฏุฉ

### 1. ุฃูููุฉ ูุณุญ Cache

ุนูุฏ ุชุบููุฑ schema ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ูุฌุจ ุฏุงุฆูุงู:
```bash
# ุญุฐู build cache
rm -rf .next

# ุฅุนุงุฏุฉ ุงูุจูุงุก
npm run build
```

### 2. ุงูุชุญูู ูู Build Output

ุนูุฏ ุธููุฑ ุฃุฎุทุงุก ุบูุฑ ูุชููุนุฉ:
1. ุชุญูู ูู ุงูููุฏ ุงููุตุฏุฑู โ
2. ุชุญูู ูู build cache โ
3. ุงูุณุญ cache ูุฃุนุฏ ุงูุจูุงุก โ

### 3. Migration Best Practices

ุนูุฏ ุชุบููุฑ ุฃุณูุงุก ุงูุฃุนูุฏุฉ:
1. ุชุญุฏูุซ ุฌููุน ุงููููุงุช ุงููุตุฏุฑูุฉ โ
2. ูุณุญ build cache โ
3. ุฅุนุงุฏุฉ ุงูุจูุงุก โ
4. ุงุฎุชุจุงุฑ ุดุงูู โ

---

## ๐ ุงููููุงุช ุงููุถุงูุฉ

1. **`check-companies-schema.sql`**
   - Script ููุชุญูู ูู schema ุฌุฏูู companies
   - ูุชุญูู ูู ูุฌูุฏ ุนููุฏ `currency` ู `base_currency`

2. **`find-currency-bug.ps1`**
   - PowerShell script ููุจุญุซ ุนู ุงุณุชุฎุฏุงูุงุช `currency` ูู ุงูููุฏ
   - ูููุฏ ููุชุญูู ุงููุณุชูุจูู

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### ูููุณุชุฎุฏู:

1. **ุงูุชุธุฑ 5 ุฏูุงุฆู** ุญุชู ูุชู ูุดุฑ ุงูุชุญุฏูุซ ุนูู Vercel
2. **ุงูุณุญ cache ุงููุชุตูุญ**:
   - Chrome: `Ctrl + Shift + Delete`
   - Firefox: `Ctrl + Shift + Delete`
   - Safari: `Cmd + Option + E`
3. **ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ**: `Ctrl + F5` (Windows) ุฃู `Cmd + Shift + R` (Mac)
4. **ุงุฎุชุจุฑ ุงูุชูุงุฑูุฑ**: ุชุฃูุฏ ูู ุฃู ุฌููุน ุงูุชูุงุฑูุฑ ุชุนูู ุจุฏูู ุฃุฎุทุงุก

### ูููุทูุฑ:

1. โ ุชู ุฑูุน ุงูุชุบููุฑุงุช ุฅูู GitHub
2. โ Vercel ุณูููู ุจุงููุดุฑ ุงูุชููุงุฆู
3. โณ ุงูุชุธุฑ ุงูุชูุงู ุงููุดุฑ
4. โ ุฑุงูุจ Logs ูู Vercel ููุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ูุง ุชูุฌุฏ ุชุบููุฑุงุช ูู ุงูููุฏ ุงููุตุฏุฑู** - ุงููุดููุฉ ูุงูุช ูู build cache ููุท
2. **ุฌููุน ุงููููุงุช ุงููุตุฏุฑูุฉ ุตุญูุญุฉ** - ุชุณุชุฎุฏู `base_currency` ุจุดูู ุตุญูุญ
3. **ุงูุญู ุจุณูุท ููุนุงู** - ูุณุญ cache ูุฅุนุงุฏุฉ ุงูุจูุงุก
4. **ูุง ุชูุฌุฏ breaking changes** - ุงูุชุทุจูู ูุนูู ุจููุณ ุงูุทุฑููุฉ

---

## โ ุงูุฎูุงุตุฉ

ุชู ุญู ุงููุดููุฉ ุจูุฌุงุญ ุนู ุทุฑูู:
1. โ ุชุญุฏูุฏ ุงูุณุจุจ ุงูุญูููู (build cache ูุฏูู)
2. โ ูุณุญ ูุฌูุฏ `.next`
3. โ ุฅุนุงุฏุฉ ุงูุจูุงุก ุจูุฌุงุญ
4. โ ุฑูุน ุงูุชุบููุฑุงุช ุฅูู GitHub
5. โ Vercel ุณูููู ุจุงููุดุฑ ุงูุชููุงุฆู

**ุงููุชูุฌุฉ:** ุชุทุจูู ERP ุงุญุชุฑุงููุ ูุณุชูุฑุ ูุฌุงูุฒ ููุฅูุชุงุฌ ุจุฏูู ุฃู ุฃุฎุทุงุก! ๐

---

**ุงูุชุงุฑูุฎ:** 2025-12-23  
**ุงูุญุงูุฉ:** โ ุชู ุงูุฅุตูุงุญ ุจูุฌุงุญ  
**ุงูุฃููููุฉ:** ๐ด ุนุงููุฉ (Critical)  
**ุงูุชุฃุซูุฑ:** ๐ฏ ุฌููุน ุงูุชูุงุฑูุฑ

