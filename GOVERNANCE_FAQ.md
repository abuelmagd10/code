# โ Governance Layer - FAQ
# ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ - ูุธุงู ุงูุญูููุฉ

**Version:** 1.0.0  
**Date:** 2026-01-09

---

## ๐ ุนุงู (General)

### ุณ1: ูุง ูู Governance Layerุ
**ุฌ:** ูู ุทุจูุฉ ุญุงููุฉ ุฅูุฒุงููุฉ ููู ุฌููุน ุงูุญุฑูุงุช ุงููุงููุฉ ูุงููุฎุฒููุฉ ูู ุงููุธุงู. ูุถูู ุฃู ูู ุนูููุฉ ุชูุฑ ุนุจุฑ:
```
Request โ Approval โ Execution
```

### ุณ2: ููุงุฐุง ูุญุชุงุฌ Governance Layerุ
**ุฌ:** ููุฃุณุจุงุจ ุงูุชุงููุฉ:
- โ ุงูุงูุชุซุงู ูููุนุงููุฑ ุงููุญุงุณุจูุฉ ุงูุฏูููุฉ (IFRS)
- โ ุงูุงูุชุซุงู ููุงููู SOX (Sarbanes-Oxley)
- โ ููุน ุงูุงุญุชูุงู ูุงูุชูุงุนุจ
- โ ุชุชุจุน ูุงูู ููู ุงูุนูููุงุช
- โ ูุตู ุงูููุงู (Separation of Duties)

### ุณ3: ูู ูููู ุชุนุทูู Governance Layerุ
**ุฌ:** โ ูุง. ูู ูุธุงู ุฅูุฒุงูู ูุถูุงู ุณูุงูุฉ ุงูุจูุงูุงุช ุงููุงููุฉ.

---

## ๐ ุงูุฅุดุนุงุฑุงุช (Notifications)

### ุณ4: ููู ูุชู ุชูุฌูู ุงูุฅุดุนุงุฑุงุชุ
**ุฌ:** ุงูุฅุดุนุงุฑุงุช ุชูุฌู ุชููุงุฆูุงู ุญุณุจ:
- **ุงูุฏูุฑ (Role):** ูุซู `manager`, `accountant`, `owner`
- **ุงููุณุชุฎุฏู (User):** ูุณุชุฎุฏู ูุญุฏุฏ
- **ุงูุณูุงู ุงูุชูุธููู:** ุงููุฑุนุ ูุฑูุฒ ุงูุชูููุฉุ ุงููุฎุฒู

### ุณ5: ูุง ูู ุฃููููุงุช ุงูุฅุดุนุงุฑุงุชุ
**ุฌ:**
- `low` - ููุฎูุถุฉ
- `normal` - ุนุงุฏูุฉ (ุงูุชุฑุงุถู)
- `high` - ุนุงููุฉ (ูุจุงูุบ ูุจูุฑุฉ)
- `urgent` - ุนุงุฌูุฉ (ุญุงูุงุช ุทุงุฑุฆุฉ)

### ุณ6: ููู ุฃุญุตู ุนูู ุฅุดุนุงุฑุงุชูุ
**ุฌ:**
```typescript
import { getUserNotifications } from '@/lib/governance-layer'

const notifications = await getUserNotifications({
  userId: 'your-user-id',
  companyId: 'your-company-id',
  status: 'unread'
})
```

---

## โ ุงูููุงููุงุช (Approvals)

### ุณ7: ูู ููููู ุงูููุงููุฉ ุนูู ุงูุทูุจุงุชุ
**ุฌ:** ุฃู ุดุฎุต **ูุง ุนุฏุง** ููุดุฆ ุงูุทูุจ (Separation of Duties).

### ุณ8: ูู ูููู ุงูููุงููุฉ ุนูู ุทูุจู ุงูุฎุงุตุ
**ุฌ:** โ ูุง. ูุฐุง ูุฎุงูู ูุจุฏุฃ ูุตู ุงูููุงู.

### ุณ9: ูุงุฐุง ูุญุฏุซ ุจุนุฏ ุงูููุงููุฉุ
**ุฌ:** 
1. ุชุชุบูุฑ ุงูุญุงูุฉ ุฅูู `approved`
2. ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ููููุดุฆ
3. ูููู ุงูุขู ุชูููุฐ ุงูุนูููุฉ (Execution)

### ุณ10: ูู ูููู ุงูุชุฑุงุฌุน ุนู ุงูููุงููุฉุ
**ุฌ:** โ ูุง. ุจุนุฏ ุงูููุงููุฉ ูุง ูููู ุงูุชุนุฏูู. ูููู ููุท ุงูุฅูุบุงุก (Cancel/Void).

---

## ๐ฐ ุทูุจุงุช ุงูุงุณุชุฑุฏุงุฏ ุงูููุฏู (Refund Requests)

### ุณ11: ููุงุฐุง ูุญุชุงุฌ Refund Request ูุจู ุณูุฏ ุงูุตุฑูุ
**ุฌ:** ูููุน ุงูุงุญุชูุงู. ูู ุญุฑูุฉ ููุฏูุฉ ุตุงุฏุฑุฉ ูุฌุจ ุฃู ุชูุฑ ุนุจุฑ:
```
Refund Request โ Branch Manager Approval โ Owner Approval โ Payment Voucher
```

### ุณ12: ูู ููุงููุฉ ูุญุชุงุฌ ุทูุจ ุงูุงุณุชุฑุฏุงุฏุ
**ุฌ:** **ููุงููุชูู ุฅูุฒุงููุชูู:**
1. ููุงููุฉ ูุฏูุฑ ุงููุฑุน (Branch Manager)
2. ููุงููุฉ ููุงุฆูุฉ (Owner/CEO)

### ุณ13: ูู ูููู ุชุนุฏูู ุงููุจูุบ ุฃุซูุงุก ุงูููุงููุฉุ
**ุฌ:** โ ูุนู. ูุฏูุฑ ุงููุฑุน ููููู ุชุนุฏูู ุงููุจูุบ (ุชุฎููุถู ููุทุ ูุง ุฒูุงุฏุชู).

### ุณ14: ูุงุฐุง ูู ุญุงููุช ุฅูุดุงุก ุณูุฏ ุตุฑู ุจุฏูู Refund Requestุ
**ุฌ:** โ ุณููุดู ุงููุธุงู ุจุฑุณุงูุฉ:
```
Cannot create refund payment without an approved refund request
```

### ุณ15: ูู ูููู ุญุฐู ุณูุฏ ุตุฑู ูุฑุชุจุท ุจู Refund Requestุ
**ุฌ:** โ ูุง. ุณููุดู ุงููุธุงู ุจุฑุณุงูุฉ:
```
Cannot delete payment linked to a refund request. Void the refund request first.
```

---

## ๐ ุณุฌู ุงูุชุฏููู (Audit Trail)

### ุณ16: ูุง ุงูุฐู ูุชู ุชุณุฌููู ูู Audit Trailุ
**ุฌ:** ูู ุดูุก:
- ูู ูุงู ุจุงูุนูููุฉ (User ID, Email, Role)
- ููุน ุงูุนูููุฉ (Create, Update, Delete, Approve, Reject)
- ุงูููู ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ (Old/New Values)
- ุงูุญููู ุงููุชุบูุฑุฉ (Changed Fields)
- ูุนูููุงุช ุงูุฌูุณุฉ (IP, User Agent, Session ID)
- ุงูุชุงุฑูุฎ ูุงูููุช

### ุณ17: ูู ูููู ุญุฐู ุณุฌูุงุช Audit Trailุ
**ุฌ:** โ ูุง. ุฃุจุฏุงู. ูุฐุง ุถุฏ ุงููุงููู (SOX Compliance).

### ุณ18: ููู ุฃุญุตู ุนูู ุณุฌู ุงูุชุฏููู ูุนูููุฉ ูุนููุฉุ
**ุฌ:**
```typescript
import { getAuditTrail } from '@/lib/governance-layer'

const auditLog = await getAuditTrail({
  companyId: 'your-company-id',
  resourceType: 'refund_requests',
  resourceId: 'refund-id'
})
```

---

## ๐ก๏ธ ุงูุฃูุงู (Security)

### ุณ19: ููู ูููุน ุงููุธุงู ุงูุงุญุชูุงูุ
**ุฌ:** ุนุจุฑ ุนุฏุฉ ุทุจูุงุช:
1. **ูุตู ุงูููุงู:** ุงูููุดุฆ ูุง ููุงูู
2. **ููุงููุงุช ูุฒุฏูุฌุฉ:** ููุงุณุชุฑุฏุงุฏ ุงูููุฏู
3. **Triggers:** ุชููุน ุงูุนูููุงุช ุบูุฑ ุงููุตุฑุญ ุจูุง
4. **Audit Trail:** ุชุณุฌูู ูุงูู ููู ุดูุก
5. **RLS:** Row Level Security ุนูู ูุณุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุณ20: ูู ูููู ุชุฌุงูุฒ Governance Layerุ
**ุฌ:** โ ูุง. ุญุชู ูุฏูุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุง ููููู ุชุฌุงูุฒู ุจุณุจุจ Triggers.

---

## ๐ง ุงูุชุทููุฑ (Development)

### ุณ21: ููู ุฃุถูู ููุน ููุงููุฉ ุฌุฏูุฏุ
**ุฌ:**
```typescript
// 1. ุฃุถู ููุน ุณูุฑ ุงูุนูู
export type WorkflowType = 
  | 'financial' 
  | 'inventory' 
  | 'refund' 
  | 'transfer' 
  | 'adjustment'
  | 'your_new_type' // โ ููุง

// 2. ุงุณุชุฎุฏู create_approval_request
await createApprovalRequest({
  workflowType: 'your_new_type',
  ...
})
```

### ุณ22: ููู ุฃุถูู Trigger ุฌุฏูุฏ ููุฅุดุนุงุฑุงุชุ
**ุฌ:**
```sql
CREATE OR REPLACE FUNCTION notify_your_event()
RETURNS TRIGGER
LANGUAGE plpgsql
AS $$
BEGIN
  PERFORM create_notification(
    p_company_id := NEW.company_id,
    p_reference_type := 'your_event',
    p_reference_id := NEW.id,
    p_title := 'Your Event Title',
    p_message := 'Your Event Message',
    p_created_by := NEW.created_by,
    p_assigned_to_role := 'manager'
  );
  RETURN NEW;
END;
$$;

CREATE TRIGGER trg_notify_your_event
  AFTER INSERT ON your_table
  FOR EACH ROW
  EXECUTE FUNCTION notify_your_event();
```

### ุณ23: ููู ุฃุฎุชุจุฑ ุงููุธุงูุ
**ุฌ:**
```bash
# ุชุดุบูู ููู ุงูุงุฎุชุจุงุฑุงุช
psql -U postgres -d your_database -f scripts/201_governance_layer_tests.sql
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก (Troubleshooting)

### ุณ24: ุฎุทุฃ: "Cannot approve their own request"
**ุฌ:** โ ูุฐุง ูู ุงูุณููู ุงูุตุญูุญ. ุงุณุชุฎุฏู ูุณุชุฎุฏู ุขุฎุฑ ููููุงููุฉ.

### ุณ25: ุฎุทุฃ: "Cannot create refund payment without an approved refund request"
**ุฌ:** โ ูุฐุง ูู ุงูุณููู ุงูุตุญูุญ. ุฃูุดุฆ Refund Request ุฃููุงู.

### ุณ26: ุฎุทุฃ: "relation does not exist"
**ุฌ:** โ ุฌุฏูู ูุทููุจ ุบูุฑ ููุฌูุฏ. ุชุฃูุฏ ูู ุชุดุบูู ุงูุณูุฑูุจุชุงุช ุงูุณุงุจูุฉ.

### ุณ27: ูุง ุฃุฑู ุงูุฅุดุนุงุฑุงุช
**ุฌ:** ุชุญูู ูู:
1. ูู ุชู ุชูุนูู Triggersุ
2. ูู `assigned_to_role` ุฃู `assigned_to_user` ุตุญูุญุ
3. ูู `company_id` ุตุญูุญุ

---

## ๐ ุงูููุงุฑุฏ (Resources)

### ุณ28: ุฃูู ุฃุฌุฏ ุงููุซุงุฆู ุงููุงููุฉุ
**ุฌ:**
- **ุงูุฏููู ุงูุดุงูู:** `GOVERNANCE_LAYER_GUIDE.md`
- **ุงูููุฎุต ุงูุนุฑุจู:** `ููุฎุต_ูุธุงู_ุงูุญูููุฉ.md`
- **ุฏููู ุงูุจุฏุก ุงูุณุฑูุน:** `GOVERNANCE_LAYER_README.md`
- **ูุฎุทุทุงุช ุงูุชุฏูู:** `GOVERNANCE_WORKFLOWS.md`
- **ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ:** `GOVERNANCE_FAQ.md` (ูุฐุง ุงูููู)

### ุณ29: ุฃูู ุงูููุฏ ุงููุตุฏุฑูุ
**ุฌ:**
- **SQL Script:** `scripts/200_governance_layer_complete.sql`
- **TypeScript Helpers:** `lib/governance-layer.ts`
- **Tests:** `scripts/201_governance_layer_tests.sql`

### ุณ30: ููู ุฃุญุตู ุนูู ุงูุฏุนูุ
**ุฌ:** ุฑุงุฌุน ุงููุซุงุฆู ุฃุนูุงู. ุฅุฐุง ูู ุชุฌุฏ ุงูุฅุฌุงุจุฉุ ุชูุงุตู ูุน ูุฑูู ุงูุชุทููุฑ.

---

**โ ุงููุธุงู ูุชูุงูู ูุน IFRS + SOX + Anti-Fraud**

**ุขุฎุฑ ุชุญุฏูุซ:** 2026-01-09  
**ุงูุฅุตุฏุงุฑ:** 1.0.0
