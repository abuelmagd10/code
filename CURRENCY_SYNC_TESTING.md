# ๐งช ุฏููู ุงุฎุชุจุงุฑ ูุฒุงููุฉ ุงูุนููุฉ
# Currency Sync Testing Guide

## ๐ ูุงุฆูุฉ ุงูุงุฎุชุจุงุฑุงุช | Test Checklist

### โ ุงูุงุฎุชุจุงุฑ 1: ูุณุชุฎุฏู ูุฏุนู - ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ
**ุงููุฏู:** ุงูุชุฃูุฏ ูู ุฃู ุงููุณุชุฎุฏู ุงููุฏุนู ูุฑู ุนููุฉ ุงูุดุฑูุฉ ุชููุงุฆูุงู

**ุงูุฎุทูุงุช:**
1. ุณุฌู ุฏุฎูู ููุณุชุฎุฏู ูุฏุนู (ููุณ ูุงูู ุงูุดุฑูุฉ)
2. ุงูุชุญ Developer Console (F12)
3. ุชุญูู ูู `localStorage.getItem('app_currency')`
4. ูุฌุจ ุฃู ุชููู ูุทุงุจูุฉ ูุนููุฉ ุงูุดุฑูุฉ (EGP)

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```javascript
localStorage.getItem('app_currency') === 'EGP'
```

---

### โ ุงูุงุฎุชุจุงุฑ 2: ุชูุจูู ุนุฏู ุงูุชุทุงุจู
**ุงููุฏู:** ุงูุชุฃูุฏ ูู ุธููุฑ ุงูุชูุจูู ุนูุฏ ุงุฎุชูุงู ุงูุนููุงุช

**ุงูุฎุทูุงุช:**
1. ุณุฌู ุฏุฎูู ููุณุชุฎุฏู ูุฏุนู
2. ุงูุชุญ Developer Console
3. ุบูุฑ ุงูุนููุฉ ูุฏููุงู:
   ```javascript
   localStorage.setItem('app_currency', 'USD')
   ```
4. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ
5. ูุฌุจ ุฃู ูุธูุฑ ุชูุจูู ุฃุตูุฑ ูู ุฃุนูู ุงูุตูุญุฉ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุธููุฑ ุชูุจูู: "ุชุญุฐูุฑ: ุนุฏู ุชุทุงุจู ุงูุนููุฉ"
- ุนุฑุถ ุนููุฉ ุงูุดุฑูุฉ (EGP) ูุนููุฉ ุงูุนุฑุถ ุงูุญุงููุฉ (USD)
- ูุฌูุฏ ุฒุฑ "ูุฒุงููุฉ ุงูุนููุฉ"

---

### โ ุงูุงุฎุชุจุงุฑ 3: ุฒุฑ ุงููุฒุงููุฉ
**ุงููุฏู:** ุงูุชุฃูุฏ ูู ุนูู ุฒุฑ ุงููุฒุงููุฉ

**ุงูุฎุทูุงุช:**
1. ูู ุงูุงุฎุชุจุงุฑ ุงูุณุงุจูุ ุงุถุบุท ุนูู ุฒุฑ "ูุฒุงููุฉ ุงูุนููุฉ"
2. ุงูุชุธุฑ ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ
3. ุชุญูู ูู ุงูุนููุฉ ูู localStorage

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```javascript
localStorage.getItem('app_currency') === 'EGP'
```
- ุงุฎุชูุงุก ุงูุชูุจูู
- ุนุฑุถ ุฌููุน ุงููุจุงูุบ ุจุงูุฌููู ุงููุตุฑู

---

### โ ุงูุงุฎุชุจุงุฑ 4: ูุงูู ุงูุดุฑูุฉ - ุญุฑูุฉ ุงูุงุฎุชูุงุฑ
**ุงููุฏู:** ุงูุชุฃูุฏ ูู ุฃู ุงููุงูู ููููู ุงุณุชุฎุฏุงู ุนููุฉ ูุฎุตุตุฉ

**ุงูุฎุทูุงุช:**
1. ุณุฌู ุฏุฎูู ููุงูู ุงูุดุฑูุฉ
2. ุงุฐูุจ ุฅูู ุงูุฅุนุฏุงุฏุงุช
3. ุบูุฑ ุงูุนููุฉ ุฅูู USD
4. ุงุญูุธ ุงูุชุบููุฑุงุช
5. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุงูุนููุฉ ุชุจูู USD
- ูุง ูุธูุฑ ุชูุจูู ุนุฏู ุงูุชุทุงุจู
- ุฌููุน ุงููุจุงูุบ ุชุนุฑุถ ุจุงูุฏููุงุฑ

---

### โ ุงูุงุฎุชุจุงุฑ 5: API Endpoint
**ุงููุฏู:** ุงุฎุชุจุงุฑ API ูุฒุงููุฉ ุงูุนููุฉ

**ุงูุฎุทูุงุช:**
1. ุงูุชุญ Developer Console
2. ููุฐ ุงูุทูุจ ุงูุชุงูู:
   ```javascript
   fetch('/api/sync-currency', { method: 'POST' })
     .then(r => r.json())
     .then(console.log)
   ```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ ูููุณุชุฎุฏู ุงููุฏุนู:**
```json
{
  "success": true,
  "currency": "EGP",
  "is_owner": false,
  "synced": true,
  "message_ar": "ุชู ูุฒุงููุฉ ุงูุนููุฉ ูุน ุนููุฉ ุงูุดุฑูุฉ ุงูุฃุณุงุณูุฉ"
}
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ ูููุงูู:**
```json
{
  "success": true,
  "currency": "EGP",
  "is_owner": true,
  "synced": false,
  "message_ar": "ุงููุงูู ููููู ุงุณุชุฎุฏุงู ุนููุฉ ูุฎุตุตุฉ"
}
```

---

### โ ุงูุงุฎุชุจุงุฑ 6: GET Currency Status
**ุงููุฏู:** ุงูุญุตูู ุนูู ุญุงูุฉ ุงูุนููุฉ ุงูุญุงููุฉ

**ุงูุฎุทูุงุช:**
```javascript
fetch('/api/sync-currency', { method: 'GET' })
  .then(r => r.json())
  .then(console.log)
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```json
{
  "success": true,
  "company_currency": "EGP",
  "user_currency": "EGP",
  "display_currency": "EGP",
  "is_owner": false,
  "sync_enabled": true,
  "needs_sync": false
}
```

---

### โ ุงูุงุฎุชุจุงุฑ 7: ุชุบููุฑ ุนููุฉ ุงูุดุฑูุฉ
**ุงููุฏู:** ุงูุชุฃูุฏ ูู ูุฒุงููุฉ ุฌููุน ุงููุณุชุฎุฏููู ุนูุฏ ุชุบููุฑ ุนููุฉ ุงูุดุฑูุฉ

**ุงูุฎุทูุงุช:**
1. ุณุฌู ุฏุฎูู ููุงูู ุงูุดุฑูุฉ
2. ุงุฐูุจ ุฅูู ุงูุฅุนุฏุงุฏุงุช
3. ุบูุฑ ุงูุนููุฉ ุงูุฃุณุงุณูุฉ ูู EGP ุฅูู SAR
4. ุงุฎุชุฑ "ุชุญููู ุฌููุน ุงูุจูุงูุงุช"
5. ุณุฌู ุฎุฑูุฌ
6. ุณุฌู ุฏุฎูู ููุณุชุฎุฏู ูุฏุนู
7. ุชุญูู ูู ุงูุนููุฉ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุนููุฉ ุงููุณุชุฎุฏู ุงููุฏุนู ุชุชุบูุฑ ุชููุงุฆูุงู ุฅูู SAR
- ุฌููุน ุงููุจุงูุบ ุชุนุฑุถ ุจุงูุฑูุงู ุงูุณุนูุฏู

---

### โ ุงูุงุฎุชุจุงุฑ 8: Database Trigger
**ุงููุฏู:** ุงุฎุชุจุงุฑ Trigger ูุฒุงููุฉ ุงูุนููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุฎุทูุงุช:**
1. ุงูุชุญ Supabase SQL Editor
2. ููุฐ ุงูุงุณุชุนูุงู:
   ```sql
   -- ุชุญุฏูุซ ุนููุฉ ุงูุดุฑูุฉ
   UPDATE companies 
   SET base_currency = 'USD' 
   WHERE id = 'your-company-id';
   
   -- ุงูุชุญูู ูู ุชุญุฏูุซ ุงููุณุชุฎุฏููู ุงููุฏุนููู
   SELECT user_id, preferred_currency, currency_sync_enabled
   FROM company_members
   WHERE company_id = 'your-company-id'
   AND user_id != (SELECT user_id FROM companies WHERE id = 'your-company-id');
   ```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุฌููุน ุงููุณุชุฎุฏููู ุงููุฏุนููู ูุฏููู `preferred_currency = 'USD'`
- `currency_sync_enabled = true`

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก | Troubleshooting

### ุงููุดููุฉ: ุงูุชูุจูู ูุง ูุธูุฑ
**ุงูุญู:**
1. ุชุฃูุฏ ูู ุฃู ุงููููู `CurrencyMismatchAlert` ูุถุงู ููุตูุญุฉ
2. ุชุญูู ูู Console ููุฃุฎุทุงุก
3. ุชุฃูุฏ ูู ุฃู ุงููุณุชุฎุฏู ููุณ ูุงูู ุงูุดุฑูุฉ

### ุงููุดููุฉ: ุงูุนููุฉ ูุง ุชุชุฒุงูู
**ุงูุญู:**
1. ุชุญูู ูู ุฃู `CurrencySyncProvider` ูุถุงู ูู `layout.tsx`
2. ุชุญูู ูู ุฃู ุงูู SQL script ุชู ุชูููุฐู
3. ุงูุณุญ localStorage ูุฃุนุฏ ุชุณุฌูู ุงูุฏุฎูู

### ุงููุดููุฉ: API ูุฑุฌุน 401
**ุงูุญู:**
1. ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู
2. ุชุญูู ูู ุตูุงุญูุงุช RLS ูู Supabase
3. ุชุญูู ูู ุฃู ุงูุฌูุณุฉ ุตุงูุญุฉ

---

## ๐ ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ | Test Results

| ุงูุงุฎุชุจุงุฑ | ุงูุญุงูุฉ | ููุงุญุธุงุช |
|---------|--------|---------|
| 1. ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ | โฌ | |
| 2. ุชูุจูู ุนุฏู ุงูุชุทุงุจู | โฌ | |
| 3. ุฒุฑ ุงููุฒุงููุฉ | โฌ | |
| 4. ุญุฑูุฉ ุงููุงูู | โฌ | |
| 5. API POST | โฌ | |
| 6. API GET | โฌ | |
| 7. ุชุบููุฑ ุนููุฉ ุงูุดุฑูุฉ | โฌ | |
| 8. Database Trigger | โฌ | |

**ุงูุฑููุฒ:**
- โ ูุฌุญ
- โ ูุดู
- โฌ ูู ูุชู ุงูุงุฎุชุจุงุฑ ุจุนุฏ

---

## ๐ง ุฃุฏูุงุช ุงูุงุฎุชุจุงุฑ | Testing Tools

### Console Commands
```javascript
// ุงูุชุญูู ูู ุงูุนููุฉ ุงูุญุงููุฉ
console.log('Current Currency:', localStorage.getItem('app_currency'))

// ุชุบููุฑ ุงูุนููุฉ ูุฏููุงู
localStorage.setItem('app_currency', 'USD')

// ุฅุฑุณุงู ุญุฏุซ ุชุบููุฑ ุงูุนููุฉ
window.dispatchEvent(new Event('app_currency_changed'))

// ูุฒุงููุฉ ุงูุนููุฉ
fetch('/api/sync-currency', { method: 'POST' })
  .then(r => r.json())
  .then(console.log)

// ุงูุญุตูู ุนูู ุญุงูุฉ ุงูุนููุฉ
fetch('/api/sync-currency', { method: 'GET' })
  .then(r => r.json())
  .then(console.log)
```

---

**ุงูุชุงุฑูุฎ:** 2025-12-22  
**ุงููุฎุชุจุฑ:** _____________  
**ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:** โฌ ูุฌุญ / โฌ ูุดู

