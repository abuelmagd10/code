# ๐ ููุงุฑูุฉ ูุญุงุณุจูุฉ: ูุงุชูุฑุฉ ูุน ุฃูุฑ ุจูุน vs ูุงุชูุฑุฉ ุจุฏูู ุฃูุฑ ุจูุน

## ๐ฏ ุงููุฏู
ุชูุถูุญ ุงููุฑู ุงููุญุงุณุจู ุจูู ุฅูุดุงุก ูุงุชูุฑุฉ ูู ุฃูุฑ ุจูุน ูุฅูุดุงุก ูุงุชูุฑุฉ ูุจุงุดุฑุฉ.

---

## โ ุงูุณููุงุฑูู ุงูุฃูู: ูุงุชูุฑุฉ ูู ุฃูุฑ ุจูุน (ุงูุทุฑููุฉ ุงูุตุญูุญุฉ)

### ๐ ุงูุฎุทูุงุช:

#### 1๏ธโฃ ุฅูุดุงุก ุฃูุฑ ุจูุน (Sales Order)
```sql
INSERT INTO sales_orders (
  company_id,
  customer_id,
  order_number,
  order_date,
  subtotal,
  tax_amount,
  total_amount,
  status,
  created_by_user_id  -- โ ูุชู ุญูุธ ูู ุฃูุดุฃ ุงูุฃูุฑ
) VALUES (
  'company-123',
  'customer-456',
  'SO-0001',
  '2025-01-15',
  10000.00,
  1500.00,
  11500.00,
  'draft',
  'user-789'  -- โ ููุฏูุจ ุงููุจูุนุงุช
);
```

**ุงููุชูุฌุฉ:**
- โ ุชู ุญูุธ ูุนูููุงุช ุงูููุฏูุจ
- โ ุชู ุชุณุฌูู ุชุงุฑูุฎ ุงูุทูุจ
- โ ูููู ุชุชุจุน ุงูุทูุจ
- โ **ูุง ููุฌุฏ ููุฏ ูุญุงุณุจู** (ุงูุฃูุฑ ูุง ูุฒุงู draft)
- โ **ูุง ููุฌุฏ ุฎุตู ูุฎุฒูู** (ุงูุฃูุฑ ูุง ูุฒุงู draft)

---

#### 2๏ธโฃ ุชุญููู ุฃูุฑ ุงูุจูุน ููุงุชูุฑุฉ
```typescript
// ูู app/sales-orders/page.tsx
const convertToInvoice = async (so: SalesOrder) => {
  // ุฅูุดุงุก ุงููุงุชูุฑุฉ
  const { data: inv } = await supabase
    .from("invoices")
    .insert({
      company_id: so.company_id,
      customer_id: so.customer_id,
      invoice_number: `INV-${Date.now()}`,
      invoice_date: new Date().toISOString().split('T')[0],
      due_date: so.due_date,
      subtotal: so.subtotal,
      tax_amount: so.tax_amount,
      total_amount: so.total_amount,
      sales_order_id: so.id,  // โ ุฑุจุท ุงููุงุชูุฑุฉ ุจุฃูุฑ ุงูุจูุน
      status: "draft"
    })
    .select("id")
    .single()

  // ุชุญุฏูุซ ุฃูุฑ ุงูุจูุน
  await supabase
    .from("sales_orders")
    .update({
      status: "invoiced",
      invoice_id: inv.id  // โ ุฑุจุท ุฃูุฑ ุงูุจูุน ุจุงููุงุชูุฑุฉ
    })
    .eq("id", so.id)
}
```

**ุงููุชูุฌุฉ:**
- โ ุชู ุฑุจุท ุงููุงุชูุฑุฉ ุจุฃูุฑ ุงูุจูุน (sales_order_id)
- โ ุชู ุฑุจุท ุฃูุฑ ุงูุจูุน ุจุงููุงุชูุฑุฉ (invoice_id)
- โ ุชู ุชุญุฏูุซ ุญุงูุฉ ุฃูุฑ ุงูุจูุน (invoiced)
- โ **ูุง ููุฌุฏ ููุฏ ูุญุงุณุจู** (ุงููุงุชูุฑุฉ ูุง ุชุฒุงู draft)
- โ **ูุง ููุฌุฏ ุฎุตู ูุฎุฒูู** (ุงููุงุชูุฑุฉ ูุง ุชุฒุงู draft)

---

#### 3๏ธโฃ ุฅุฑุณุงู ุงููุงุชูุฑุฉ (status = 'sent')
```typescript
// ูู app/invoices/[id]/page.tsx
const handleStatusChange = async (newStatus: string) => {
  if (newStatus === 'sent') {
    // 1. ุฅูุดุงุก ููุฏ ูุญุงุณุจู
    await postARRevenueJournal()
    
    // 2. ุฎุตู ุงููุฎุฒูู
    await deductInventoryOnly()
    
    // 3. ุชุญุฏูุซ ุญุงูุฉ ุงููุงุชูุฑุฉ
    await supabase
      .from('invoices')
      .update({ status: 'sent' })
      .eq('id', invoiceId)
    
    // 4. ูุฒุงููุฉ ุญุงูุฉ ุฃูุฑ ุงูุจูุน
    if (invoice.sales_order_id) {
      await supabase
        .from('sales_orders')
        .update({ status: 'sent' })
        .eq('id', invoice.sales_order_id)
    }
  }
}
```

**ุงูููุฏ ุงููุญุงุณุจู:**
```
ุงูุชุงุฑูุฎ: 2025-01-15
ุงููุตู: ูุงุชูุฑุฉ ูุจูุนุงุช INV-0001 (ูู ุฃูุฑ ุจูุน SO-0001)

ูู ุญู/ ุงูุฐูู ุงููุฏููุฉ (ุงูุนููุงุก)     11,500.00 ุฌููู
    ุฅูู ุญู/ ุฅูุฑุงุฏ ุงููุจูุนุงุช                    10,000.00 ุฌููู
    ุฅูู ุญู/ ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ              1,500.00 ุฌููู
```

**ุญุฑูุฉ ุงููุฎุฒูู:**
```sql
INSERT INTO inventory_transactions (
  company_id,
  product_id,
  transaction_type,
  quantity_change,
  reference_id,
  notes
) VALUES (
  'company-123',
  'product-001',
  'sale',
  -10,  -- ุฎุตู 10 ูุญุฏุงุช
  'invoice-id',
  'ุจูุน INV-0001 (ูู ุฃูุฑ ุจูุน SO-0001)'
);
```

**ุงููุชูุฌุฉ:**
- โ ุชู ุฅูุดุงุก ููุฏ ูุญุงุณุจู
- โ ุชู ุฎุตู ุงููุฎุฒูู
- โ ุชู ุชุญุฏูุซ ุญุงูุฉ ุงููุงุชูุฑุฉ (sent)
- โ ุชู ุชุญุฏูุซ ุญุงูุฉ ุฃูุฑ ุงูุจูุน (sent)
- โ ูููู ุชุชุจุน ุงููุงุชูุฑุฉ ูู ุฃูุฑ ุงูุจูุน
- โ ูููู ูุนุฑูุฉ ูู ุฃูุดุฃ ุงูุทูุจ ุงูุฃุตูู

---

## โ ุงูุณููุงุฑูู ุงูุซุงูู: ูุงุชูุฑุฉ ุจุฏูู ุฃูุฑ ุจูุน (ุงูุทุฑููุฉ ุงูุฎุงุทุฆุฉ)

### ๐ ุงูุฎุทูุงุช:

#### 1๏ธโฃ ุฅูุดุงุก ูุงุชูุฑุฉ ูุจุงุดุฑุฉ
```sql
INSERT INTO invoices (
  company_id,
  customer_id,
  invoice_number,
  invoice_date,
  due_date,
  subtotal,
  tax_amount,
  total_amount,
  status,
  sales_order_id  -- โ NULL (ูุง ููุฌุฏ ุฃูุฑ ุจูุน)
) VALUES (
  'company-123',
  'customer-456',
  'INV-0002',
  '2025-01-15',
  '2025-02-15',
  10000.00,
  1500.00,
  11500.00,
  'draft',
  NULL  -- โ ูุง ููุฌุฏ ุฃูุฑ ุจูุน
);
```

**ุงููุชูุฌุฉ:**
- โ **ูุง ููุฌุฏ ูุนูููุงุช ุนู ุงูููุฏูุจ**
- โ **ูุง ููุฌุฏ ุชุชุจุน ููุทูุจ**
- โ **ูุง ููุฌุฏ ุฃูุฑ ุจูุน ูุฑุชุจุท**
- โ **ูุง ููุฌุฏ ููุฏ ูุญุงุณุจู** (ุงููุงุชูุฑุฉ ูุง ุชุฒุงู draft)
- โ **ูุง ููุฌุฏ ุฎุตู ูุฎุฒูู** (ุงููุงุชูุฑุฉ ูุง ุชุฒุงู draft)

---

#### 2๏ธโฃ ุฅุฑุณุงู ุงููุงุชูุฑุฉ (status = 'sent')
```typescript
// ููุณ ุงูููุฏ ุงูุณุงุจู
const handleStatusChange = async (newStatus: string) => {
  if (newStatus === 'sent') {
    // 1. ุฅูุดุงุก ููุฏ ูุญุงุณุจู
    await postARRevenueJournal()
    
    // 2. ุฎุตู ุงููุฎุฒูู
    await deductInventoryOnly()
    
    // 3. ุชุญุฏูุซ ุญุงูุฉ ุงููุงุชูุฑุฉ
    await supabase
      .from('invoices')
      .update({ status: 'sent' })
      .eq('id', invoiceId)
    
    // 4. ูุฒุงููุฉ ุญุงูุฉ ุฃูุฑ ุงูุจูุน
    if (invoice.sales_order_id) {  // โ NULL - ูุง ููุฌุฏ ุฃูุฑ ุจูุน
      // ูู ูุชู ุชูููุฐ ูุฐุง ุงูููุฏ
    }
  }
}
```

**ุงูููุฏ ุงููุญุงุณุจู:**
```
ุงูุชุงุฑูุฎ: 2025-01-15
ุงููุตู: ูุงุชูุฑุฉ ูุจูุนุงุช INV-0002 (โ ุจุฏูู ุฃูุฑ ุจูุน)

ูู ุญู/ ุงูุฐูู ุงููุฏููุฉ (ุงูุนููุงุก)     11,500.00 ุฌููู
    ุฅูู ุญู/ ุฅูุฑุงุฏ ุงููุจูุนุงุช                    10,000.00 ุฌููู
    ุฅูู ุญู/ ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ              1,500.00 ุฌููู
```

**ุญุฑูุฉ ุงููุฎุฒูู:**
```sql
INSERT INTO inventory_transactions (
  company_id,
  product_id,
  transaction_type,
  quantity_change,
  reference_id,
  notes
) VALUES (
  'company-123',
  'product-001',
  'sale',
  -10,  -- ุฎุตู 10 ูุญุฏุงุช
  'invoice-id',
  'ุจูุน INV-0002 (โ ุจุฏูู ุฃูุฑ ุจูุน)'
);
```

**ุงููุชูุฌุฉ:**
- โ ุชู ุฅูุดุงุก ููุฏ ูุญุงุณุจู (ููุณ ุงูููุฏ)
- โ ุชู ุฎุตู ุงููุฎุฒูู (ููุณ ุงูุฎุตู)
- โ ุชู ุชุญุฏูุซ ุญุงูุฉ ุงููุงุชูุฑุฉ (sent)
- โ **ูุง ููุฌุฏ ุฃูุฑ ุจูุน ููุชุญุฏูุซ**
- โ **ูุง ูููู ุชุชุจุน ุงููุงุชูุฑุฉ**
- โ **ูุง ูููู ูุนุฑูุฉ ูู ุฃูุดุฃ ุงูุทูุจ**

---

## ๐ ุงูููุงุฑูุฉ ุงููุญุงุณุจูุฉ

| ุงูุจูุฏ | ูุน ุฃูุฑ ุจูุน โ | ุจุฏูู ุฃูุฑ ุจูุน โ |
|------|-------------|----------------|
| **ุงูููุฏ ุงููุญุงุณุจู** | โ ููุณ ุงูููุฏ | โ ููุณ ุงูููุฏ |
| **ุฎุตู ุงููุฎุฒูู** | โ ููุณ ุงูุฎุตู | โ ููุณ ุงูุฎุตู |
| **ุงูุฃุฑุตุฏุฉ ุงููุญุงุณุจูุฉ** | โ ุตุญูุญุฉ | โ ุตุญูุญุฉ |
| **ุชุชุจุน ุงูุทูุจ** | โ ููุฌูุฏ | โ ุบูุฑ ููุฌูุฏ |
| **ูุนูููุงุช ุงูููุฏูุจ** | โ ููุฌูุฏุฉ | โ ุบูุฑ ููุฌูุฏุฉ |
| **ุงูุชูุงุฑูุฑ** | โ ุฏูููุฉ | โ ูุงูุตุฉ |
| **ุงููุฑุงุฌุนุฉ** | โ ุณููุฉ | โ ุตุนุจุฉ |
| **ุงูุงูุชุซุงู** | โ ูุชูุงูู | โ ุบูุฑ ูุชูุงูู |

---

## ๐ ุงูุฎูุงุตุฉ ุงููุญุงุณุจูุฉ

### โ ูู ุงููุงุญูุฉ ุงููุญุงุณุจูุฉ ุงูุจุญุชุฉ:
```
โ ุงููููุฏ ุงููุญุงุณุจูุฉ: ูุชุทุงุจูุฉ 100%
โ ุญุฑูุฉ ุงููุฎุฒูู: ูุชุทุงุจูุฉ 100%
โ ุงูุฃุฑุตุฏุฉ: ูุชุทุงุจูุฉ 100%
โ ุงูููุฒุงููุฉ: ูุชุทุงุจูุฉ 100%
โ ูุงุฆูุฉ ุงูุฏุฎู: ูุชุทุงุจูุฉ 100%
```

**ุงููุชูุฌุฉ:** ูุง ููุฌุฏ ูุฑู ูุญุงุณุจู!

---

### โ ูู ุงููุงุญูุฉ ุงูุฅุฏุงุฑูุฉ ูุงูุฑูุงุจูุฉ:
```
โ ุงูุชุชุจุน: ููููุฏ
โ ุงููุฑุงุฌุนุฉ: ุตุนุจุฉ
โ ุงูุชูุงุฑูุฑ: ูุงูุตุฉ
โ ุงูุงูุชุซุงู: ุบูุฑ ูุชูุงูู
โ ุงูุฃูุงู: ุซุบุฑุงุช
```

**ุงููุชูุฌุฉ:** ูุฑู ูุจูุฑ ุฌุฏุงู!

---

## ๐ฏ ุงูุชูุตูุฉ ุงูููุงุฆูุฉ

### ูููุญุงุณุจูู:
> "ูู ุงููุงุญูุฉ ุงููุญุงุณุจูุฉ ุงูุจุญุชุฉุ ูุง ููุฌุฏ ูุฑู. ุงููููุฏ ุตุญูุญุฉ ูุงูุฃุฑุตุฏุฉ ูุชุทุงุจูุฉ."

### ูููุฏูุฑูู:
> "ูู ุงููุงุญูุฉ ุงูุฅุฏุงุฑูุฉุ ุงููุฑู ูุจูุฑ ุฌุฏุงู. ููุฏุงู ุงูุชุชุจุน ูุงููุฑุงุฌุนุฉ ูุฎูู ูุฎุงุทุฑ ุนุงููุฉ."

### ูููุฏูููู:
> "ูู ุงููุงุญูุฉ ุงูุฑูุงุจูุฉุ ุฅูุดุงุก ููุงุชูุฑ ุจุฏูู ุฃูุงูุฑ ุจูุน ุบูุฑ ููุจูู. ูุฌุจ ูุฌูุฏ ูุณุงุฑ ุชุฏููู ูุงูู."

### ูููุทูุฑูู:
> "ูุฌุจ ุฌุนู ุฃูุฑ ุงูุจูุน ุฅูุฒุงูู ูุถูุงู ุงูุชุชุจุน ุงููุงูู ูุงูุงูุชุซุงู ูููุนุงููุฑ."

---

## ๐ ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

**ุงูุณุคุงู:** ูู ููุฌุฏ ุฎุทุฃ ูุญุงุณุจู ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ุจุฏูู ุฃูุฑ ุจูุนุ

**ุงูุฅุฌุงุจุฉ:** 
- โ **ูุญุงุณุจูุงู:** ูุงุ ุงููููุฏ ุตุญูุญุฉ ูุงูุฃุฑุตุฏุฉ ูุชุทุงุจูุฉ
- โ **ุฅุฏุงุฑูุงู:** ูุนูุ ููุฏุงู ุงูุชุชุจุน ูุงููุฑุงุฌุนุฉ
- โ **ุฑูุงุจูุงู:** ูุนูุ ุนุฏู ุงูุงูุชุซุงู ูููุนุงููุฑ
- โ **ุฃูููุงู:** ูุนูุ ุซุบุฑุงุช ูู ุงูุตูุงุญูุงุช

**ุงูุชูุตูุฉ:** ุฌุนู ุฃูุฑ ุงูุจูุน **ุฅูุฒุงูู** ูุฌููุน ุงูููุงุชูุฑ.

