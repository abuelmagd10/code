# โ๏ธ ูุฎุงุทุฑ ูุฃุฎุทุงุก ุฅูุดุงุก ูุงุชูุฑุฉ ุจุฏูู ุฃูุฑ ุจูุน

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูู ูุธุงู ERB_VitaSlims ERPุ **ููุณูุญ ุญุงููุงู ุจุฅูุดุงุก ููุงุชูุฑ ุจุฏูู ุฃูุงูุฑ ุจูุน**. ูุฐุง ุงูุชูุฑูุฑ ููุถุญ ุงููุฎุงุทุฑ ูุงูุฃุฎุทุงุก ุงููุญุชููุฉ ูู ูุฐู ุงูููุงุฑุณุฉ.

---

## ๐ ุงููุถุน ุงูุญุงูู ูู ุงููุธุงู

### โ ูุง ูู ูุณููุญ ุญุงููุงู:
```typescript
// ูู app/invoices/new/page.tsx
// ูุง ููุฌุฏ ุฃู ูุญุต ุฃู ุชุญุฐูุฑ ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ุจุฏูู ุฃูุฑ ุจูุน
// ุงูุญูู sales_order_id ุงุฎุชูุงุฑู (nullable)
```

### ๐ ุงูุนูุงูุฉ ุจูู ุงูุฌุฏุงูู:
```sql
-- ูู scripts/033_sales_order_invoice_link.sql
ALTER TABLE invoices 
  ADD COLUMN sales_order_id UUID 
  REFERENCES sales_orders(id) 
  ON DELETE SET NULL;  -- โ๏ธ ุงุฎุชูุงุฑู!

ALTER TABLE sales_orders 
  ADD COLUMN invoice_id UUID 
  REFERENCES invoices(id) 
  ON DELETE SET NULL;  -- โ๏ธ ุงุฎุชูุงุฑู!
```

---

## โ๏ธ ุงููุฎุงุทุฑ ูุงูุฃุฎุทุงุก ุงููุญุชููุฉ

### 1๏ธโฃ **ููุฏุงู ุชุชุจุน ุงูุทูุจุงุช (Order Tracking)**

#### ุงููุดููุฉ:
- โ ูุง ูููู ูุนุฑูุฉ ูู ุฃูู ุฌุงุกุช ุงููุงุชูุฑุฉ
- โ ูุง ูููู ุชุชุจุน ูุฑุงุญู ุงูุจูุน (Estimate โ Sales Order โ Invoice)
- โ ุตุนูุจุฉ ูู ูุนุฑูุฉ ุงูุทูุจุงุช ุงููุนููุฉ (Pending Orders)

#### ุงูุชุฃุซูุฑ:
```
๐ ุชูุฑูุฑ ุงูุทูุจุงุช ุงููุนููุฉ:
- ุฃูุฑ ุจูุน SO-0001: ุชู ุชุญูููู ููุงุชูุฑุฉ INV-0001 โ
- ุฃูุฑ ุจูุน SO-0002: ุชู ุชุญูููู ููุงุชูุฑุฉ INV-0002 โ
- ูุงุชูุฑุฉ INV-0003: โ ูู ุฃูู ุฌุงุกุชุ ูุง ููุฌุฏ ุฃูุฑ ุจูุน!
```

#### ุงูุฎุทูุฑุฉ: **ูุชูุณุทุฉ** ๐ก

---

### 2๏ธโฃ **ููุฏุงู ูุนูููุงุช ููุฏูุจ ุงููุจูุนุงุช**

#### ุงููุดููุฉ:
```sql
-- ุฃูุงูุฑ ุงูุจูุน ุชุญุชูู ุนูู created_by_user_id
-- ุงูููุงุชูุฑ ูุง ุชุญุชูู ุนูู ูุฐุง ุงูุญูู!

SELECT created_by_user_id FROM sales_orders;  -- โ ููุฌูุฏ
SELECT created_by_user_id FROM invoices;      -- โ ุบูุฑ ููุฌูุฏ!
```

#### ุงูุชุฃุซูุฑ:
- โ ูุง ูููู ูุนุฑูุฉ ูู ุฃูุดุฃ ุงููุงุชูุฑุฉ
- โ ูุง ูููู ุญุณุงุจ ุนูููุงุช ุงููุจูุนุงุช ุจุฏูุฉ
- โ ูุง ูููู ุชูููู ุฃุฏุงุก ููุฏูุจู ุงููุจูุนุงุช

#### ูุซุงู:
```
๐ ุชูุฑูุฑ ุนูููุงุช ุงููุจูุนุงุช ูุดูุฑ ููุงูุฑ:
- ููุฏูุจ ุฃุญูุฏ: 10 ููุงุชูุฑ ูู ุฃูุงูุฑ ุจูุน = 50,000 ุฌููู โ
- ููุฏูุจ ูุญูุฏ: 8 ููุงุชูุฑ ูู ุฃูุงูุฑ ุจูุน = 40,000 ุฌููู โ
- ููุงุชูุฑ ุจุฏูู ุฃูุงูุฑ: 5 ููุงุชูุฑ = 25,000 ุฌููู โ ููู ุงูุนูููุฉุ
```

#### ุงูุฎุทูุฑุฉ: **ุนุงููุฉ** ๐ด

---

### 3๏ธโฃ **ุนุฏู ุงูุงูุชุฒุงู ุจุณูุฑ ุงูุนูู ุงููุญุงุณุจู (Workflow)**

#### ุงููุดููุฉ:
ุงูููุท ุงููุญุงุณุจู ุงูุตุญูุญ:
```
Estimate (ุนุฑุถ ุณุนุฑ) 
  โ
Sales Order (ุฃูุฑ ุจูุน) 
  โ
Invoice (ูุงุชูุฑุฉ) 
  โ
Payment (ุฏูุน)
```

ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ุจุฏูู ุฃูุฑ:
```
โ ุชุฎุทู ูุฑุญูุฉ ุฃูุฑ ุงูุจูุน
โ ููุฏุงู ุงูููุงููุงุช ูุงูุชุฃููุฏุงุช
โ ุนุฏู ุงูุงูุชุฒุงู ุจุงูุณูุงุณุงุช ุงูุฏุงุฎููุฉ
```

#### ุงูุชุฃุซูุฑ:
- โ ุตุนูุจุฉ ูู ุงููุฑุงุฌุนุฉ ูุงูุชุฏููู
- โ ููุฏุงู ุงูุณูุทุฑุฉ ุนูู ุนูููุฉ ุงูุจูุน
- โ ุงุญุชูุงู ุญุฏูุซ ุฃุฎุทุงุก ูู ุงูุฃุณุนุงุฑ ุฃู ุงููููุงุช

#### ุงูุฎุทูุฑุฉ: **ุนุงููุฉ** ๐ด

---

### 4๏ธโฃ **ูุดุงูู ูู ุงูุชูุงุฑูุฑ ูุงูุชุญูููุงุช**

#### ุงููุดููุฉ:
```sql
-- ุชูุฑูุฑ ุงููุจูุนุงุช ุญุณุจ ููุฏูุจ ุงููุจูุนุงุช
SELECT 
  u.name as sales_rep,
  COUNT(i.id) as invoice_count,
  SUM(i.total_amount) as total_sales
FROM invoices i
LEFT JOIN sales_orders so ON i.sales_order_id = so.id
LEFT JOIN users u ON so.created_by_user_id = u.id
WHERE i.company_id = 'xxx'
GROUP BY u.name;

-- ุงููุชูุฌุฉ:
-- ุฃุญูุฏ: 10 ููุงุชูุฑุ 50,000 ุฌููู โ
-- ูุญูุฏ: 8 ููุงุชูุฑุ 40,000 ุฌููู โ
-- NULL: 5 ููุงุชูุฑุ 25,000 ุฌููู โ (ููุงุชูุฑ ุจุฏูู ุฃูุงูุฑ)
```

#### ุงูุชุฃุซูุฑ:
- โ ุชูุงุฑูุฑ ุบูุฑ ุฏูููุฉ
- โ ุตุนูุจุฉ ูู ุงุชุฎุงุฐ ุงููุฑุงุฑุงุช
- โ ููุฏุงู ุฑุคูุฉ ูุงุถุญุฉ ููุฃุฏุงุก

#### ุงูุฎุทูุฑุฉ: **ุนุงููุฉ** ๐ด

---

### 5๏ธโฃ **ููุฏุงู ุชุชุจุน ุญุงูุฉ ุงูุทูุจ (Order Status)**

#### ุงููุดููุฉ:
```typescript
// ูู app/sales-orders/page.tsx
// ูุชู ูุฒุงููุฉ ุญุงูุฉ ุฃูุฑ ุงูุจูุน ูุน ุงููุงุชูุฑุฉ:
const syncOrderWithInvoice = async (orderId: string, invoiceStatus: string) => {
  // draft โ invoiced โ sent โ paid โ returned
}

// โ ุงูููุงุชูุฑ ุจุฏูู ุฃูุงูุฑ: ูุง ููุฌุฏ ุญุงูุฉ ููุชุชุจุน!
```

#### ุงูุชุฃุซูุฑ:
- โ ูุง ูููู ูุนุฑูุฉ ุญุงูุฉ ุงูุทูุจ
- โ ุตุนูุจุฉ ูู ุฅุฏุงุฑุฉ ุงููุฎุฒูู
- โ ููุฏุงู ุงูุชูุณูู ุจูู ุงูุฃูุณุงู

#### ุงูุฎุทูุฑุฉ: **ูุชูุณุทุฉ** ๐ก

---

### 6๏ธโฃ **ูุดุงูู ูู ุงููุฑุงุฌุนุฉ ูุงูุชุฏููู (Audit)**

#### ุงููุดููุฉ:
```
๐ ุณุคุงู ุงููุฏูู: "ูู ูุงูู ุนูู ูุฐู ุงููุงุชูุฑุฉุ"
โ ูุง ููุฌุฏ ุฃูุฑ ุจูุน โ ูุง ููุฌุฏ ููุงููุฉ
โ ูุง ููุฌุฏ ุณุฌู ููุทูุจ ุงูุฃุตูู
โ ุตุนูุจุฉ ูู ุชุชุจุน ุงูุชุบููุฑุงุช
```

#### ุงูุชุฃุซูุฑ:
- โ ุตุนูุจุฉ ูู ุงููุฑุงุฌุนุฉ ุงูุฏุงุฎููุฉ
- โ ูุดุงูู ูู ุงูุชุฏููู ุงูุฎุงุฑุฌู
- โ ุงุญุชูุงู ุฑูุถ ุงูููุงุชูุฑ ูู ุงูุฌูุงุช ุงูุฑูุงุจูุฉ

#### ุงูุฎุทูุฑุฉ: **ุนุงููุฉ ุฌุฏุงู** ๐ด๐ด

---

### 7๏ธโฃ **ููุฏุงู ูุนูููุงุช ุงูุดุญู**

#### ุงููุดููุฉ:
```sql
-- ุฃูุงูุฑ ุงูุจูุน ุชุญุชูู ุนูู ูุนูููุงุช ุงูุดุญู
SELECT shipping_provider_id FROM sales_orders;  -- โ ููุฌูุฏ

-- ุนูุฏ ุงูุชุญููู ููุงุชูุฑุฉุ ูุชู ููู ูุนูููุงุช ุงูุดุญู
-- โ ุงูููุงุชูุฑ ุจุฏูู ุฃูุงูุฑ: ูุง ูุนูููุงุช ุดุญู!
```

#### ุงูุชุฃุซูุฑ:
- โ ุตุนูุจุฉ ูู ุชุชุจุน ุงูุดุญูุงุช
- โ ููุฏุงู ุงูุชูุงูู ูุน ุดุฑูุงุช ุงูุดุญู
- โ ูุดุงูู ูู ุฎุฏูุฉ ุงูุนููุงุก

#### ุงูุฎุทูุฑุฉ: **ูุชูุณุทุฉ** ๐ก

---

### 8๏ธโฃ **ูุดุงูู ูู ุฅุฏุงุฑุฉ ุงููุฎุฒูู**

#### ุงููุดููุฉ:
```typescript
// ุนูุฏ ุฅุฑุณุงู ุงููุงุชูุฑุฉ (status = 'sent'):
// 1. ุฎุตู ุงููุฎุฒูู (inventory_transactions)
// 2. ุฅูุดุงุก ููุฏ ูุญุงุณุจู (journal_entries)

// โ ุงูููุงุชูุฑ ุจุฏูู ุฃูุงูุฑ:
// - ูุง ููุฌุฏ ุชุฎุทูุท ูุณุจู ูููุฎุฒูู
// - ุงุญุชูุงู ููุงุฏ ุงููุฎุฒูู ุจุดูู ููุงุฌุฆ
// - ุตุนูุจุฉ ูู ุงูุชูุจุค ุจุงูุทูุจ
```

#### ุงูุชุฃุซูุฑ:
- โ ููุงุฏ ูุฎุฒูู ุบูุฑ ูุชููุน
- โ ุตุนูุจุฉ ูู ุงูุชุฎุทูุท
- โ ููุฏุงู ูุจูุนุงุช ูุญุชููุฉ

#### ุงูุฎุทูุฑุฉ: **ุนุงููุฉ** ๐ด

---

### 9๏ธโฃ **ููุฏุงู ุงูุชูุงูู ูุน ุงูุชูุฏูุฑุงุช (Estimates)**

#### ุงููุดููุฉ:
```
ุงูููุท ุงูุตุญูุญ:
Estimate โ Sales Order โ Invoice

ุงูููุท ุงูุฎุงุทุฆ:
โ Invoice ูุจุงุดุฑุฉ (ุจุฏูู Estimate ุฃู Sales Order)
```

#### ุงูุชุฃุซูุฑ:
- โ ููุฏุงู ุชุชุจุน ุนุฑูุถ ุงูุฃุณุนุงุฑ
- โ ุตุนูุจุฉ ูู ูุนุฑูุฉ ูุนุฏู ุงูุชุญููู (Conversion Rate)
- โ ููุฏุงู ูุฑุต ุชุญุณูู ุงูุฃุณุนุงุฑ

#### ุงูุฎุทูุฑุฉ: **ูุชูุณุทุฉ** ๐ก

---

### ๐ **ูุดุงูู ูู ุงูุตูุงุญูุงุช ูุงูุฃูุงู**

#### ุงููุดููุฉ:
```typescript
// ูุฏ ุชููู ููุงู ุตูุงุญูุงุช ูุฎุชููุฉ:
// - ุฅูุดุงุก ุฃูุฑ ุจูุน: ูุญุชุงุฌ ููุงููุฉ ุงููุฏูุฑ
// - ุฅูุดุงุก ูุงุชูุฑุฉ ูุจุงุดุฑุฉ: โ ูู ููุงููุ

// โ ุงุญุชูุงู ุชุฌุงูุฒ ุงูุตูุงุญูุงุช
// โ ุงุญุชูุงู ุฅูุดุงุก ููุงุชูุฑ ุบูุฑ ูุตุฑุญ ุจูุง
```

#### ุงูุชุฃุซูุฑ:
- โ ุซุบุฑุงุช ุฃูููุฉ
- โ ุงุญุชูุงู ุงูุงุญุชูุงู
- โ ููุฏุงู ุงูุณูุทุฑุฉ

#### ุงูุฎุทูุฑุฉ: **ุนุงููุฉ ุฌุฏุงู** ๐ด๐ด

---

## ๐ ููุฎุต ุงููุฎุงุทุฑ

| ุงููุฎุงุทุฑุฉ | ุงูุฎุทูุฑุฉ | ุงูุชุฃุซูุฑ ุนูู | ุงูุญู ุงูููุชุฑุญ |
|---------|---------|-------------|--------------|
| ููุฏุงู ุชุชุจุน ุงูุทูุจุงุช | ๐ก ูุชูุณุทุฉ | ุงูุชูุงุฑูุฑ | ุฅูุฒุงูู |
| ููุฏุงู ูุนูููุงุช ุงูููุฏูุจ | ๐ด ุนุงููุฉ | ุงูุนูููุงุช | ุฅูุฒุงูู |
| ุนุฏู ุงูุงูุชุฒุงู ุจุงูู Workflow | ๐ด ุนุงููุฉ | ุงููุฑุงุฌุนุฉ | ุฅูุฒุงูู |
| ุชูุงุฑูุฑ ุบูุฑ ุฏูููุฉ | ๐ด ุนุงููุฉ | ุงููุฑุงุฑุงุช | ุฅูุฒุงูู |
| ููุฏุงู ุชุชุจุน ุงูุญุงูุฉ | ๐ก ูุชูุณุทุฉ | ุงูุฅุฏุงุฑุฉ | ุฅูุฒุงูู |
| ูุดุงูู ุงูุชุฏููู | ๐ด๐ด ุนุงููุฉ ุฌุฏุงู | ุงูุงูุชุซุงู | ุฅูุฒุงูู |
| ููุฏุงู ูุนูููุงุช ุงูุดุญู | ๐ก ูุชูุณุทุฉ | ุงูุฎุฏูุฉ | ุฅูุฒุงูู |
| ูุดุงูู ุงููุฎุฒูู | ๐ด ุนุงููุฉ | ุงูุชุฎุทูุท | ุฅูุฒุงูู |
| ููุฏุงู ุงูุชูุงูู | ๐ก ูุชูุณุทุฉ | ุงูุชุญููู | ุฅูุฒุงูู |
| ุซุบุฑุงุช ุฃูููุฉ | ๐ด๐ด ุนุงููุฉ ุฌุฏุงู | ุงูุฃูุงู | ุฅูุฒุงูู |

---

## โ ุงูุญููู ุงูููุชุฑุญุฉ

### ุงูุญู 1: ุฌุนู ุฃูุฑ ุงูุจูุน ุฅูุฒุงูู (ููุตู ุจู ๐)

```typescript
// ูู app/invoices/new/page.tsx
const handleSubmit = async (e: React.FormEvent) => {
  e.preventDefault()

  // โ ูุญุต ูุฌูุฏ ุฃูุฑ ุจูุน
  if (!formData.sales_order_id) {
    toast({
      title: "ุฃูุฑ ุงูุจูุน ูุทููุจ",
      description: "ูุฌุจ ุฅูุดุงุก ุฃูุฑ ุจูุน ุฃููุงู ูุจู ุฅูุดุงุก ุงููุงุชูุฑุฉ",
      variant: "destructive"
    })
    return
  }

  // ... ุจุงูู ุงูููุฏ
}
```

### ุงูุญู 2: ุฅุถุงูุฉ ุชุญุฐูุฑ ููู (ุญู ูุคูุช)

```typescript
// ุฅุถุงูุฉ ุชุญุฐูุฑ ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ุจุฏูู ุฃูุฑ
if (!formData.sales_order_id) {
  const confirmed = confirm(
    "โ๏ธ ุชุญุฐูุฑ: ุฅูุดุงุก ูุงุชูุฑุฉ ุจุฏูู ุฃูุฑ ุจูุน\n\n" +
    "ุงููุฎุงุทุฑ:\n" +
    "- ููุฏุงู ุชุชุจุน ุงูุทูุจ\n" +
    "- ููุฏุงู ูุนูููุงุช ุงูููุฏูุจ\n" +
    "- ูุดุงูู ูู ุงูุชูุงุฑูุฑ\n" +
    "- ุตุนูุจุฉ ูู ุงููุฑุงุฌุนุฉ\n\n" +
    "ูู ุฃูุช ูุชุฃูุฏ ูู ุงููุชุงุจุนุฉุ"
  )
  if (!confirmed) return
}
```

### ุงูุญู 3: ุฅุถุงูุฉ ุญูู created_by_user_id ููููุงุชูุฑ

```sql
-- ุฅุถุงูุฉ ุญูู ูุชุชุจุน ูู ุฃูุดุฃ ุงููุงุชูุฑุฉ
ALTER TABLE invoices 
  ADD COLUMN created_by_user_id UUID 
  REFERENCES auth.users(id);

-- ุฅูุดุงุก index ููุฃุฏุงุก
CREATE INDEX idx_invoices_created_by 
  ON invoices(created_by_user_id);
```

---

## ๐ฏ ุงูุชูุตูุงุช ุงูููุงุฆูุฉ

### ููุงุณุชุฎุฏุงู ุงูููุฑู:
1. โ **ุฅุถุงูุฉ ุชุญุฐูุฑ ููู** ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ุจุฏูู ุฃูุฑ ุจูุน
2. โ **ุชูุซูู ุงููุฎุงุทุฑ** ูุฅุจูุงุบ ุฌููุน ุงููุณุชุฎุฏููู
3. โ **ูุฑุงุฌุนุฉ ุงูููุงุชูุฑ ุงูุญุงููุฉ** ุจุฏูู ุฃูุงูุฑ ุจูุน

### ููุชุทููุฑ ุงููุณุชูุจูู:
1. ๐ง **ุฌุนู ุฃูุฑ ุงูุจูุน ุฅูุฒุงูู** (ููุตู ุจู ุจุดุฏุฉ)
2. ๐ง **ุฅุถุงูุฉ ุญูู created_by_user_id** ููููุงุชูุฑ
3. ๐ง **ุชุญุณูู ุงูุชูุงุฑูุฑ** ูุชุดูู ุงูููุงุชูุฑ ุจุฏูู ุฃูุงูุฑ
4. ๐ง **ุฅุถุงูุฉ ุตูุงุญูุงุช** ููุชุญูู ูู ูู ููููู ุฅูุดุงุก ููุงุชูุฑ ุจุฏูู ุฃูุงูุฑ

---

## ๐ ุงูุฎูุงุตุฉ

**ุฅูุดุงุก ูุงุชูุฑุฉ ุจุฏูู ุฃูุฑ ุจูุน:**
- โ **ุบูุฑ ููุตู ุจู** ูู ุจูุฆุงุช ุงูุฅูุชุงุฌ
- โ๏ธ **ูุณุจุจ ูุฎุงุทุฑ ุนุงููุฉ** ูู ุงูุชุชุจุน ูุงููุฑุงุฌุนุฉ
- ๐ด **ูุคุซุฑ ุณูุจุงู** ุนูู ุงูุชูุงุฑูุฑ ูุงูุชุญูููุงุช
- ๐ด๐ด **ูุฎูู ุซุบุฑุงุช ุฃูููุฉ** ููุดุงูู ูู ุงูุงูุชุซุงู

**ุงูุชูุตูุฉ:** ุฌุนู ุฃูุฑ ุงูุจูุน **ุฅูุฒุงูู** ูุฌููุน ุงูููุงุชูุฑ ูู ุฃูุฑุจ ููุช ูููู.

