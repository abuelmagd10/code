# ๐ง ุชุตุญูุญ ุงููุธุงู ุงููุญุงุณุจู - COGS (Cost of Goods Sold)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุตุญูุญ ุงููุธุงู ุงููุญุงุณุจู ููุชูุงูู ูุน **ุงููุนุงููุฑ ุงููุญุงุณุจูุฉ ุงูุฏูููุฉ** (GAAP/IFRS) ูุงูุฃูุธูุฉ ุงูุงุญุชุฑุงููุฉ ูุซู:
- โ Odoo
- โ Zoho Books
- โ Next ERP

---

## โ๏ธ ุงููุดููุฉ

### ุงููุถุน ุงูุณุงุจู (ุฎุงุทุฆ ูุญุงุณุจููุง):
```
โ ุงููุดุชุฑูุงุช โ ูุตุฑูู (Expense)
โ COGS = 0 (ูุง ููุณุฌู ุนูุฏ ุงูุจูุน)
โ ุงูุฑุจุญ ูุถุฎู ุจุดูู ุฎุงุทุฆ
```

**ูุซุงู:**
- ุดุฑุงุก ุจุถุงุนุฉ: 5,000 ุฌ.ู
- ุจูุน ุจุถุงุนุฉ: 10,000 ุฌ.ู
- **ุงูุฑุจุญ ุงูุธุงูุฑ: 10,000 ุฌ.ู** โ (ุฎุทุฃ!)

---

## โ ุงูุญู

### ุงููุถุน ุงูุฌุฏูุฏ (ุตุญูุญ ูุญุงุณุจููุง):
```
โ ุงููุดุชุฑูุงุช โ ุงููุฎุฒูู (Asset)
โ ุนูุฏ ุงูุจูุน โ COGS ููุณุฌู ุชููุงุฆููุง
โ ุงูุฑุจุญ = ุงููุจูุนุงุช - COGS - ุงููุตุฑููุงุช
```

**ูุซุงู:**
- ุดุฑุงุก ุจุถุงุนุฉ: 5,000 ุฌ.ู โ ุงููุฎุฒูู (Asset)
- ุจูุน ุจุถุงุนุฉ: 10,000 ุฌ.ู
- COGS: 5,000 ุฌ.ู (ุชููุงุฆู)
- **ุงูุฑุจุญ ุงูุตุญูุญ: 5,000 ุฌ.ู** โ

---

## ๐ ุงูุชุทุจูู ุงูุณุฑูุน

### ุงูุทุฑููุฉ 1: ุณูุฑูุจุช ุชููุงุฆู (ููุตู ุจูุง)

#### Windows (PowerShell):
```powershell
.\apply-cogs-fix.ps1
```

#### Linux/Mac:
```bash
chmod +x apply-cogs-fix.sh
./apply-cogs-fix.sh
```

### ุงูุทุฑููุฉ 2: Supabase Dashboard
1. ุงูุชุญ SQL Editor ูู Supabase
2. ุทุจูู ุงูุณูุฑูุจุชุงุช ุจุงูุชุฑุชูุจ:
   - `scripts/011_auto_cogs_trigger.sql`
   - `scripts/012_fix_historical_cogs.sql`
   - `scripts/enhanced_reports_system.sql`
3. ุดุบูู: `SELECT * FROM fix_historical_cogs('YOUR_COMPANY_ID');`

### ุงูุทุฑููุฉ 3: ูุงุฌูุฉ ุงููุณุชุฎุฏู
```bash
npm run dev
# ุซู ุงูุชุญ: http://localhost:3000/settings/fix-cogs
```

---

## ๐ ุงููููุงุช

### ุงูุณูุฑูุจุชุงุช:
- **`apply-cogs-fix.ps1`** - ุณูุฑูุจุช PowerShell ููุชุทุจูู ุงูุชููุงุฆู
- **`apply-cogs-fix.sh`** - ุณูุฑูุจุช Bash ููุชุทุจูู ุงูุชููุงุฆู

### ูุงุนุฏุฉ ุงูุจูุงูุงุช:
- **`scripts/011_auto_cogs_trigger.sql`** - Trigger ููู COGS ุงูุชููุงุฆู
- **`scripts/012_fix_historical_cogs.sql`** - ุฅุตูุงุญ ุงูุจูุงูุงุช ุงููุฏููุฉ
- **`scripts/enhanced_reports_system.sql`** - ุชุญุฏูุซ ูุงุฆูุฉ ุงูุฏุฎู

### ุงูููุฏ:
- **`app/api/fix-cogs-accounting/route.ts`** - API ููุชุตุญูุญ
- **`app/api/simple-report/route.ts`** - ุชุตุญูุญ ุญุณุงุจ COGS
- **`app/bills/[id]/page.tsx`** - ุชุญุฏูุซ ููุทู ุงููุดุชุฑูุงุช
- **`app/settings/fix-cogs/page.tsx`** - ูุงุฌูุฉ ุงูุชุตุญูุญ

### ุงูุชูุซูู:
- **`QUICK_START.md`** - ุฏููู ุงูุจุฏุก ุงูุณุฑูุน โญ
- **`COGS_FIX_README.md`** - ุฏููู ุงูุชุทุจูู ุงููุงูู
- **`docs/COGS_ACCOUNTING_FIX.md`** - ุงูุชูุซูู ุงูุชูุตููู
- **`CHANGELOG_COGS_FIX.md`** - ุณุฌู ุงูุชุบููุฑุงุช
- **`SUPABASE_DEPLOYMENT.md`** - ุฏููู ุชุทุจูู Supabase

---

## ๐ง ุงูุชุบููุฑุงุช ุงูุฑุฆูุณูุฉ

### 1. Database Trigger
```sql
-- ูููุดุฆ ููุฏ COGS ุชููุงุฆููุง ุนูุฏ ุงูุจูุน
CREATE TRIGGER trg_auto_cogs_on_sale
BEFORE INSERT ON inventory_transactions
FOR EACH ROW EXECUTE FUNCTION auto_create_cogs_journal();
```

### 2. ุงููููุฏ ุงููุญุงุณุจูุฉ

#### ุนูุฏ ุงูุดุฑุงุก:
```
ูุฏูู: ุงููุฎุฒูู (Asset)         5,000 ุฌ.ู
ุฏุงุฆู: ุงูุฐูู ุงูุฏุงุฆูุฉ (AP)       5,000 ุฌ.ู
```

#### ุนูุฏ ุงูุจูุน:
```
ุฃ) ููุฏ ุงููุจูุนุงุช:
ูุฏูู: ุงูุฐูู ุงููุฏููุฉ (AR)      10,000 ุฌ.ู
ุฏุงุฆู: ุงููุจูุนุงุช (Revenue)      10,000 ุฌ.ู

ุจ) ููุฏ COGS (ุชููุงุฆู):
ูุฏูู: ุชูููุฉ ุงูุจุถุงุนุฉ (COGS)    5,000 ุฌ.ู
ุฏุงุฆู: ุงููุฎุฒูู (Asset)         5,000 ุฌ.ู
```

### 3. ุญุณุงุจ ุงูุฑุจุญ
```
ุงูุฑุจุญ = ุงููุจูุนุงุช - COGS - ุงููุตุฑููุงุช
      = 10,000 - 5,000 - 2,000
      = 3,000 ุฌ.ู โ
```

---

## โ ุงูุชุญูู ูู ุงููุฌุงุญ

### 1. ูุญุต ูููุฏ COGS:
```sql
SELECT COUNT(*) FROM journal_entries 
WHERE reference_type = 'invoice_cogs';
```
**ุงููุชููุน:** ุนุฏุฏ > 0

### 2. ูุญุต ูุนุงููุงุช ุจุฏูู COGS:
```sql
SELECT COUNT(*) FROM inventory_transactions it
JOIN products p ON it.product_id = p.id
WHERE it.transaction_type = 'sale'
  AND p.item_type != 'service'
  AND it.journal_entry_id IS NULL;
```
**ุงููุชููุน:** 0

---

## ๐ ุงูุชุฃุซูุฑ ุนูู ุงูุชูุงุฑูุฑ

### ูุจู ุงูุชุตุญูุญ:
| ุงูุจูุฏ | ุงููููุฉ |
|------|--------|
| ุงููุจูุนุงุช | 100,000 ุฌ.ู |
| COGS | 0 ุฌ.ู โ |
| ุงููุตุฑููุงุช | 20,000 ุฌ.ู |
| **ุงูุฑุจุญ** | **80,000 ุฌ.ู** โ |

### ุจุนุฏ ุงูุชุตุญูุญ:
| ุงูุจูุฏ | ุงููููุฉ |
|------|--------|
| ุงููุจูุนุงุช | 100,000 ุฌ.ู |
| COGS | 60,000 ุฌ.ู โ |
| ุงููุตุฑููุงุช | 20,000 ุฌ.ู |
| **ุงูุฑุจุญ** | **20,000 ุฌ.ู** โ |

---

## ๐ ุงูุฃูุงู

- โ ุฌููุน ุงูุฏูุงู ุชุณุชุฎุฏู `SECURITY DEFINER`
- โ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูู API
- โ ูุง ูููู ุญุฐู ุงููููุฏ ุงููุฏููุฉ
- โ ููุท ุฅุถุงูุฉ ูููุฏ ุฌุฏูุฏุฉ

---

## ๐ ุญู ุงููุดุงูู

### "psql: command not found"
```bash
# Windows
# ุซุจูุช PostgreSQL ูู: https://www.postgresql.org/download/

# Mac
brew install postgresql

# Linux
sudo apt-get install postgresql-client
```

### "COGS accounts not found"
```sql
INSERT INTO chart_of_accounts (
  company_id, account_code, account_name, 
  account_type, sub_type, normal_balance
) VALUES (
  'YOUR_COMPANY_ID', '5000', 'ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ',
  'expense', 'cost_of_goods_sold', 'debit'
);
```

---

## ๐ ุงููุฑุงุฌุน

- [GAAP - Cost of Goods Sold](https://www.investopedia.com/terms/c/cogs.asp)
- [Odoo Accounting](https://www.odoo.com/documentation/16.0/applications/finance/accounting.html)
- [Zoho Books Inventory](https://www.zoho.com/books/guides/inventory-accounting.html)

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงููุณุฎ ุงูุงุญุชูุงุทู:** ุงุญูุธ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุจู ุงูุชุทุจูู
2. **ุงูุงุฎุชุจุงุฑ:** ุงุฎุชุจุฑ ุนูู ุจูุฆุฉ ุชุทููุฑ ุฃููุงู
3. **cost_price:** ุชุฃูุฏ ูู ุชุญุฏูุฏ ุณุนุฑ ุงูุชูููุฉ ูุฌููุน ุงูููุชุฌุงุช
4. **ุงูุฎุฏูุงุช:** ูุง ุชุชุฃุซุฑ ุจุงูู COGS (ุตุญูุญ ูุญุงุณุจููุง)

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. โ **ุทุจูู ุงูุชุตุญูุญุงุช** ุจุงุณุชุฎุฏุงู ุฅุญุฏู ุงูุทุฑู ุฃุนูุงู
2. โ **ุชุญูู ูู ุงููุชุงุฆุฌ** ุจุงุณุชุฎุฏุงู ุงุณุชุนูุงูุงุช ุงูุชุญูู
3. โ **ุงุฎุชุจุฑ ุงูุชูุงุฑูุฑ** (Simple Report / Income Statement)
4. โ **ุฑุงุฌุน ุงูุชูุซูู** ูููุฒูุฏ ูู ุงูุชูุงุตูู

---

## ๐ ุงูุฏุนู

ูููุฒูุฏ ูู ุงููุนูููุงุช:
- **ุงูุจุฏุก ุงูุณุฑูุน:** `QUICK_START.md` โญ
- **ุฏููู ุงูุชุทุจูู:** `COGS_FIX_README.md`
- **ุงูุชูุซูู ุงููุงูู:** `docs/COGS_ACCOUNTING_FIX.md`

---

**ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ:** 2025-12-23  
**ุงูุฅุตุฏุงุฑ:** 1.0.0  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุชุทุจูู

