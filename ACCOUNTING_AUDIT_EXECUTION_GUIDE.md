# ๐ ุฏููู ุชูููุฐ ุงููุฑุงุฌุนุฉ ุงููุญุงุณุจูุฉ ุงูุดุงููุฉ
# Comprehensive Accounting Audit Execution Guide

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2025-12-24  
**ุงููุฏู:** ุฏููู ุนููู ุฎุทูุฉ ุจุฎุทูุฉ ูุชูููุฐ ุงููุฑุงุฌุนุฉ ุงููุญุงุณุจูุฉ ุงูุดุงููุฉ

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงูุฏููู ูุดุฑุญ ููููุฉ ุชูููุฐ ุงููุฑุงุฌุนุฉ ุงููุญุงุณุจูุฉ ุงูุดุงููุฉ ูููุธุงู ERPุ ูุงูุชู ุชุบุทู:

### โ ูุง ูุชู ูุญุตู:

1. **ุงููููุฏ ุงููุญุงุณุจูุฉ**
   - ุงูุชุญูู ูู ุชูุงุฒู ุงููููุฏ (ุงููุฏูู = ุงูุฏุงุฆู)
   - ุงูููุงุชูุฑ ูุงููุฏููุนุงุช ุจุฏูู ูููุฏ
   - ูููุฏ ุงูุฅููุงู ูุงูุงุณุชููุงู

2. **ุฃุฑุตุฏุฉ ุงูุญุณุงุจุงุช**
   - ุฃุฑุตุฏุฉ ุงูุนููุงุก (AR)
   - ุฃุฑุตุฏุฉ ุงูููุฑุฏูู (AP)
   - ุงูุญุณุงุจุงุช ุงูุจูููุฉ ูุงูููุฏูุฉ
   - ุงููุฎุฒูู

3. **ุชูุงูู ุงูุจูุงูุงุช**
   - ุงูุณุฌูุงุช ุงูููุฑุฑุฉ
   - ุงููููุฏ ุงููุงูุตุฉ
   - ุงูุนูุงูุงุช ุจูู ุงูุฌุฏุงูู (Foreign Keys)

4. **ุงูุชูุงุฑูุฑ ุงููุงููุฉ**
   - ุงูููุฒุงููุฉ ุงูุนููููุฉ (Balance Sheet)
   - ูุงุฆูุฉ ุงูุฏุฎู (P&L)
   - ุงูุชุฏููุงุช ุงูููุฏูุฉ (Cash Flow)

---

## ๐ ุทุฑู ุงูุชูููุฐ

### ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู ุณูุฑุจุช Node.js (ููุตู ุจูุง) โญ

ูุฐู ุงูุทุฑููุฉ ุชููู ุจุชูููุฐ ุฌููุน ุงูุงุณุชุนูุงูุงุช ุชููุงุฆูุงู ูุฅูุดุงุก ุชูุงุฑูุฑ ุดุงููุฉ.

#### ุงูุฎุทูุงุช:

1. **ุงูุชุฃูุฏ ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ**
   ```bash
   # ุชุฃูุฏ ูู ูุฌูุฏ ููู .env.local ูู ุฌุฐุฑ ุงููุดุฑูุน
   # ูุฌุจ ุฃู ูุญุชูู ุนูู:
   NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
   SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
   ```

2. **ุชูููุฐ ุงููุฑุงุฌุนุฉ**
   ```bash
   # ุชูููุฐ ุงููุฑุงุฌุนุฉ ูุฌููุน ุงูุดุฑูุงุช
   node scripts/run-comprehensive-audit.js

   # ุฃู ุงุณุชุฎุฏุงู npm script
   npm run audit:comprehensive
   ```

3. **ูุฑุงุฌุนุฉ ุงููุชุงุฆุฌ**
   - ุณูุชู ุฅูุดุงุก ููู `AUDIT_REPORT_YYYY-MM-DD.json` ูุญุชูู ุนูู ุฌููุน ุงููุชุงุฆุฌ
   - ุณูุชู ุฅูุดุงุก ููู `AUDIT_REPORT_YYYY-MM-DD.txt` ูุญุชูู ุนูู ููุฎุต ูุตู
   - ุณูุชู ุนุฑุถ ุงูููุฎุต ูู Terminal

#### ูุซุงู ุนูู ุงูุฅุฎุฑุงุฌ:
```
๐ ุจุฏุก ุงููุฑุงุฌุนุฉ ุงููุญุงุณุจูุฉ ุงูุดุงููุฉ...
============================================================

๐ ุชูููุฐ: 1.1 - ุงููููุฏ ุบูุฑ ุงููุชูุงุฒูุฉ
โ ุชู ุจูุฌุงุญ - ุนุฏุฏ ุงููุชุงุฆุฌ: 3

๐ ุชูููุฐ: 1.2 - ููุงุชูุฑ ุจุฏูู ูููุฏ ูุญุงุณุจูุฉ
โ ุชู ุจูุฌุงุญ - ุนุฏุฏ ุงููุชุงุฆุฌ: 5

...

๐ ุชู ุญูุธ ุงูุชูุฑูุฑ ูู: AUDIT_REPORT_2025-12-24.json
๐ ุชู ุญูุธ ุงูููุฎุต ูู: AUDIT_REPORT_2025-12-24.txt
```

---

### ุงูุทุฑููุฉ 2: ุงุณุชุฎุฏุงู Supabase SQL Editor

ูุฐู ุงูุทุฑููุฉ ููุงุณุจุฉ ุฅุฐุง ููุช ุชุฑูุฏ ุชูููุฐ ุงุณุชุนูุงูุงุช ูุญุฏุฏุฉ ููุท.

#### ุงูุฎุทูุงุช:

1. **ูุชุญ Supabase Dashboard**
   - ุงูุฏุฎูู ุฅูู ุงููุดุฑูุน ุนูู https://supabase.com
   - ุงุฎุชูุงุฑ ุงููุดุฑูุน ุงูุฎุงุต ุจู
   - ุงูุฐูุงุจ ุฅูู: **Database** โ **SQL Editor**

2. **ูุชุญ ููู SQL**
   - ูุชุญ ุงูููู: `scripts/COMPREHENSIVE_ACCOUNTING_AUDIT.sql`
   - ูุณุฎ ูุญุชูู ุงูููู ูุงููุงู ุฃู ูุณุฎ ุงุณุชุนูุงูุงุช ูุญุฏุฏุฉ

3. **ุชูููุฐ ุงูุงุณุชุนูุงูุงุช**
   - ูุตู ุงูุงุณุชุนูุงู ูู SQL Editor
   - ุงูุถุบุท ุนูู **Run** ุฃู `Ctrl+Enter`
   - ูุฑุงุฌุนุฉ ุงููุชุงุฆุฌ ูู ุงูุฌุฏูู ุฃุณูู ุงููุญุฑุฑ

4. **ุชุตุฏูุฑ ุงููุชุงุฆุฌ (ุงุฎุชูุงุฑู)**
   - ุงูุถุบุท ุนูู **Download CSV** ูุชุตุฏูุฑ ุงููุชุงุฆุฌ
   - ุญูุธ ุงูููู ูููุฑุงุฌุนุฉ ูุงุญูุงู

---

### ุงูุทุฑููุฉ 3: ุงุณุชุฎุฏุงู API Endpoint

ููููู ุฅูุดุงุก API endpoint ูุชูููุฐ ุงููุฑุงุฌุนุฉ ูู ุฎูุงู ุงููุงุฌูุฉ.

#### ุงูุฎุทูุงุช:

1. **ุฅูุดุงุก API Route** (ุฅุฐุง ูู ููู ููุฌูุฏุงู)
   ```typescript
   // app/api/audit/comprehensive/route.ts
   import { createSSR } from '@/lib/supabase/server'
   import { NextResponse } from 'next/server'
   
   export async function GET() {
     const supabase = await createSSR()
     // ุชูููุฐ ุงุณุชุนูุงูุงุช ุงููุฑุงุฌุนุฉ
     // ...
     return NextResponse.json({ results })
   }
   ```

2. **ุงุณุชุฏุนุงุก API**
   ```bash
   curl http://localhost:3000/api/audit/comprehensive
   ```

---

## ๐ ููู ุงููุชุงุฆุฌ

### 1. ุงููููุฏ ุบูุฑ ุงููุชูุงุฒูุฉ (Unbalanced Entries)

**ูุง ูุนููู:**
- ูููุฏ ูุญุงุณุจูุฉ ูุง ูุชุณุงูู ูููุง ูุฌููุน ุงููุฏูู ูุน ูุฌููุน ุงูุฏุงุฆู
- ูุฐุง ุฎุทุฃ ูุญุงุณุจู ุญุฑุฌ ูุฌุจ ุฅุตูุงุญู ููุฑุงู

**ูุซุงู ุนูู ุงููุชูุฌุฉ:**
```json
{
  "journal_entry_id": "123e4567-e89b-12d3-a456-426614174000",
  "company_name": "ุดุฑูุฉ ุงููุซุงู",
  "total_debit": 1000.00,
  "total_credit": 950.00,
  "difference": 50.00
}
```

**ููููุฉ ุงูุฅุตูุงุญ:**
1. ูุฑุงุฌุนุฉ ุงูููุฏ ูู ุตูุญุฉ ุงููููุฏ ุงูููููุฉ
2. ุงูุชุญูู ูู ุฌููุน ุงูุณุทูุฑ
3. ุฅุถุงูุฉ ุฃู ุชุนุฏูู ุงูุณุทูุฑ ูุชุญููู ุงูุชูุงุฒู
4. ุฃู ุฅูุดุงุก ููุฏ ุชุณููุฉ (Adjustment Entry)

---

### 2. ููุงุชูุฑ ุจุฏูู ูููุฏ ูุญุงุณุจูุฉ

**ูุง ูุนููู:**
- ููุงุชูุฑ ุชู ุฅุตุฏุงุฑูุง ูููู ูู ูุชู ุฅูุดุงุก ูููุฏ ูุญุงุณุจูุฉ ููุง
- ูุฐุง ูุนูู ุฃู ุงูุฅูุฑุงุฏุงุช ุบูุฑ ูุณุฌูุฉ ูู ุงูุฏูุงุชุฑ

**ูุซุงู ุนูู ุงููุชูุฌุฉ:**
```json
{
  "invoice_id": "inv-001",
  "invoice_number": "INV-2025-001",
  "total_amount": 5000.00,
  "customer_name": "ุนููู ุงููุซุงู"
}
```

**ููููุฉ ุงูุฅุตูุงุญ:**
1. ุงุณุชุฎุฏุงู API ูุฅูุดุงุก ุงููููุฏ ุงูููููุฏุฉ:
   ```bash
   POST /api/fix-sent-invoice-journals
   ```
2. ุฃู ุฅูุดุงุก ุงููููุฏ ูุฏููุงู ูู ุฎูุงู ุงููุงุฌูุฉ

---

### 3. ุฃุฑุตุฏุฉ ุงูุนููุงุก (Customer Balances)

**ูุง ูุนููู:**
- ููุงุฑูุฉ ุจูู ุฃุฑุตุฏุฉ ุงูุนููุงุก ุงููุญุณูุจุฉ ูู ุงูููุงุชูุฑ ูุฃุฑุตุฏุฉ ุงููููุฏ ุงููุญุงุณุจูุฉ
- ุงููุฑููุงุช ุชุดูุฑ ุฅูู ูููุฏ ูุงูุตุฉ ุฃู ุฎุงุทุฆุฉ

**ูุซุงู ุนูู ุงููุชูุฌุฉ:**
```json
{
  "customer_name": "ุนููู ุงููุซุงู",
  "invoice_balance": 10000.00,
  "journal_balance": 9500.00,
  "difference": 500.00
}
```

**ููููุฉ ุงูุฅุตูุงุญ:**
1. ูุฑุงุฌุนุฉ ุฌููุน ููุงุชูุฑ ุงูุนููู
2. ุงูุชุญูู ูู ุงููููุฏ ุงููุญุงุณุจูุฉ ุงููุฑุชุจุทุฉ
3. ุฅูุดุงุก ููุฏ ุชุณููุฉ ูููุฑู

---

### 4. ุงูุณุฌูุงุช ุงูููุฑุฑุฉ (Duplicate Records)

**ูุง ูุนููู:**
- ูุฌูุฏ ุณุฌูุงุช ููุฑุฑุฉ ูู ุงูุนููุงุกุ ุงูููุฑุฏููุ ุฃู ุงูููุงุชูุฑ
- ูุฐุง ูุคุฏู ุฅูู ุชุถุฎู ุงูุจูุงูุงุช ูุฃุฎุทุงุก ูู ุงูุชูุงุฑูุฑ

**ููููุฉ ุงูุฅุตูุงุญ:**
1. ูุฑุงุฌุนุฉ ุงูุณุฌูุงุช ุงูููุฑุฑุฉ
2. ุฏูุฌ ุงูุณุฌูุงุช ุงูููุฑุฑุฉ
3. ุชุญุฏูุซ ุงูุนูุงูุงุช (Foreign Keys)
4. ุญุฐู ุงูุณุฌูุงุช ุงูุฒุงุฆุฏุฉ

---

## ๐ง ุฅุตูุงุญ ุงููุดุงูู ุงูุดุงุฆุนุฉ

### ูุดููุฉ 1: ูููุฏ ุบูุฑ ูุชูุงุฒูุฉ

**ุงูุญู ุงูุณุฑูุน:**
```sql
-- ุฅูุดุงุก ููุฏ ุชุณููุฉ
INSERT INTO journal_entries (company_id, entry_date, description, reference_type)
VALUES ('company-id', CURRENT_DATE, 'ููุฏ ุชุณููุฉ', 'adjustment');

-- ุฅุถุงูุฉ ุณุทูุฑ ุงูููุฏ
INSERT INTO journal_entry_lines (journal_entry_id, account_id, debit_amount, credit_amount)
VALUES
  ('entry-id', 'account-id-1', 50.00, 0),
  ('entry-id', 'account-id-2', 0, 50.00);
```

---

### ูุดููุฉ 2: ููุงุชูุฑ ุจุฏูู ูููุฏ

**ุงูุญู ุงูุณุฑูุน:**
```bash
# ุงุณุชุฎุฏุงู API ูุฅูุดุงุก ุงููููุฏ ุงูููููุฏุฉ
curl -X POST http://localhost:3000/api/fix-sent-invoice-journals \
  -H "Content-Type: application/json"
```

---

### ูุดููุฉ 3: ุฃุฑุตุฏุฉ ุบูุฑ ูุชุทุงุจูุฉ

**ุงูุญู ุงูุณุฑูุน:**
1. ุชุดุบูู ุณูุฑุจุช ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุฃุฑุตุฏุฉ:
   ```bash
   node scripts/recalculate-balances.js
   ```

2. ุฃู ุงุณุชุฎุฏุงู ุตูุญุฉ ุงูุชูุงุฑูุฑ:
   - ุงูุฐูุงุจ ุฅูู: **Reports** โ **Update Account Balances**
   - ุงุฎุชูุงุฑ ุงููุชุฑุฉ ุงูุฒูููุฉ
   - ุงูุถุบุท ุนูู **Recalculate**

---

## ๐ ุงูุชูุงุฑูุฑ ุงููุงููุฉ

ุจุนุฏ ุฅุตูุงุญ ุฌููุน ุงููุดุงููุ ูุฌุจ ุงูุชุญูู ูู ุงูุชูุงุฑูุฑ ุงููุงููุฉ:

### 1. ุงูููุฒุงููุฉ ุงูุนููููุฉ (Balance Sheet)

**ุงูุชุญูู:**
```
ุงูุฃุตูู = ุงูุงูุชุฒุงูุงุช + ุญููู ุงูููููุฉ
```

**ุงููุตูู:**
- ุงูุฐูุงุจ ุฅูู: **Reports** โ **Balance Sheet**
- ุงุฎุชูุงุฑ ุชุงุฑูุฎ ุงูููุฒุงููุฉ
- ุงูุชุญูู ูู ุงูุชูุงุฒู

---

### 2. ูุงุฆูุฉ ุงูุฏุฎู (Income Statement / P&L)

**ุงูุชุญูู:**
```
ุตุงูู ุงูุฑุจุญ = ุงูุฅูุฑุงุฏุงุช - ุงููุตุฑููุงุช - COGS
```

**ุงููุตูู:**
- ุงูุฐูุงุจ ุฅูู: **Reports** โ **Income Statement**
- ุงุฎุชูุงุฑ ุงููุชุฑุฉ ุงูุฒูููุฉ
- ูุฑุงุฌุนุฉ ุงูุฃุฑูุงู

---

### 3. ุงูุชุฏููุงุช ุงูููุฏูุฉ (Cash Flow)

**ุงูุชุญูู:**
```
ุตุงูู ุงูุชุฏูู ุงูููุฏู = ุงูุชุดุบูููุฉ + ุงูุงุณุชุซูุงุฑูุฉ + ุงูุชูููููุฉ
```

**ุงููุตูู:**
- ุงูุฐูุงุจ ุฅูู: **Reports** โ **Cash Flow Statement**
- ุงุฎุชูุงุฑ ุงููุชุฑุฉ ุงูุฒูููุฉ
- ุงูุชุญูู ูู ุงูุชุฏููุงุช

---

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ (Final Checklist)

ูุจู ุงุนุชุจุงุฑ ุงููุฑุงุฌุนุฉ ููุชููุฉุ ุชุฃูุฏ ูู:

- [ ] **ุฌููุน ุงููููุฏ ูุชูุงุฒูุฉ** (ุงููุฏูู = ุงูุฏุงุฆู)
- [ ] **ุฌููุน ุงูููุงุชูุฑ ููุง ูููุฏ ูุญุงุณุจูุฉ**
- [ ] **ุฌููุน ุงููุฏููุนุงุช ููุง ูููุฏ ูุญุงุณุจูุฉ**
- [ ] **ุฃุฑุตุฏุฉ ุงูุนููุงุก ูุชุทุงุจูุฉ** (ุงูููุงุชูุฑ = ุงููููุฏ)
- [ ] **ุฃุฑุตุฏุฉ ุงูููุฑุฏูู ูุชุทุงุจูุฉ** (ุงูููุงุชูุฑ = ุงููููุฏ)
- [ ] **ูุง ุชูุฌุฏ ุณุฌูุงุช ููุฑุฑุฉ**
- [ ] **ุงูููุฒุงููุฉ ุงูุนููููุฉ ูุชูุงุฒูุฉ**
- [ ] **ูุงุฆูุฉ ุงูุฏุฎู ุตุญูุญุฉ**
- [ ] **ุงูุชุฏููุงุช ุงูููุฏูุฉ ููุทููุฉ**
- [ ] **ุฌููุน ุงูุชูุงุฑูุฑ ุชุนุฑุถ ุจูุงูุงุช ุฏูููุฉ**

---

## ๐ ุงูุฏุนู ูุงููุณุงุนุฏุฉ

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:

1. **ุฑุงุฌุน ุงููุซุงุฆู:**
   - `COMPREHENSIVE_AUDIT_GUIDE.md`
   - `docs/ACCOUNTING_PATTERN.md`
   - `docs/ERP_COMPLIANCE_REPORT.md`

2. **ุฑุงุฌุน ุงูุณูุฑุจุชุงุช:**
   - `scripts/COMPREHENSIVE_ACCOUNTING_AUDIT.sql`
   - `scripts/run-comprehensive-audit.js`

3. **ุฑุงุฌุน ุงูุชูุงุฑูุฑ ุงูุณุงุจูุฉ:**
   - ุงุจุญุซ ุนู ูููุงุช `AUDIT_REPORT_*.json`
   - ูุงุฑู ุงููุชุงุฆุฌ ูุน ุงููุฑุงุฌุนุงุช ุงูุณุงุจูุฉ

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ

ุจุนุฏ ุฅููุงู ุงููุฑุงุฌุนุฉ:

1. **ุฅูุดุงุก ุฎุทุฉ ุฅุตูุงุญ** ูููุดุงูู ุงูููุชุดูุฉ
2. **ุชุญุฏูุฏ ุงูุฃููููุงุช** (ุงููุดุงูู ุงูุญุฑุฌุฉ ุฃููุงู)
3. **ุชูููุฐ ุงูุฅุตูุงุญุงุช** ุฎุทูุฉ ุจุฎุทูุฉ
4. **ุฅุนุงุฏุฉ ุงููุฑุงุฌุนุฉ** ููุชุญูู ูู ุงูุญู
5. **ุชูุซูู ุงูุชุบููุฑุงุช** ูู ุณุฌู ุงูุชุฏููู (Audit Log)

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-12-24
**ุงูุฅุตุฏุงุฑ:** 1.0


