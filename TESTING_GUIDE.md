# ๐งช ุฏููู ุงูุงุฎุชุจุงุฑ ุงูุณุฑูุน - ูุธุงู Vendor Credits

## ๐ ุงูุจุฏุก ุงูุณุฑูุน

### 1. ุชุดุบูู ุงูุชุทุจูู
```bash
npm run dev
```

ุซู ุงูุชุญ ุงููุชุตูุญ ุนูู: **http://localhost:3000**

---

## โ ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ

### ุงูุณููุงุฑูู 1๏ธโฃ: ุฅูุดุงุก Vendor Credit ุชููุงุฆูุงู โ

**ุงููุฏู:** ุงูุชุญูู ูู ุฅูุดุงุก Vendor Credit ุชููุงุฆูุงู ุนูุฏ ูุฑุชุฌุน ูุงุชูุฑุฉ ูุฏููุนุฉ

**ุงูุฎุทูุงุช:**
1. ุงุฐูุจ ุฅูู **Bills** (ููุงุชูุฑ ุงูููุฑุฏูู)
2. ุฃูุดุฆ ูุงุชูุฑุฉ ุดุฑุงุก ุฌุฏูุฏุฉ:
   - ุงุฎุชุฑ ููุฑุฏ
   - ุฃุถู ููุชุฌุงุช
   - ุงุญูุธ ุงููุงุชูุฑุฉ
3. ุงุฏูุน ุงููุงุชูุฑุฉ (ุบููุฑ ุงูุญุงูุฉ ุฅูู **Paid**)
4. ุงุฐูุจ ุฅูู **Purchase Returns** (ูุฑุชุฌุนุงุช ุงููุดุชุฑูุงุช)
5. ุฃูุดุฆ ูุฑุชุฌุน ุฌุฏูุฏ:
   - ุงุฎุชุฑ ุงููุงุชูุฑุฉ ุงูุชู ุฃูุดุฃุชูุง
   - ุฃุถู ุงูููุชุฌุงุช ุงููุฑุชุฌุนุฉ
   - ุงุญูุธ ุงููุฑุชุฌุน
6. ุงุฐูุจ ุฅูู **Vendor Credits** (ุฅุดุนุงุฑุงุช ุฏุงุฆู ุงูููุฑุฏูู)
7. **ุชุญูู:** ูุฌุจ ุฃู ุชุฌุฏ ุฅุดุนุงุฑ ุฏุงุฆู ุฌุฏูุฏ ุชู ุฅูุดุงุคู ุชููุงุฆูุงู

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุฅุดุนุงุฑ ุฏุงุฆู ุฌุฏูุฏ ุจููุณ ูููุฉ ุงููุฑุชุฌุน
- โ ุงูุฅุดุนุงุฑ ูุฑุชุจุท ุจุงููุงุชูุฑุฉ ูุงููุฑุชุฌุน
- โ ุงูุญุงูุฉ = `open`

---

### ุงูุณููุงุฑูู 2๏ธโฃ: ุนุฏู ุฅูุดุงุก Vendor Credit ููููุงุชูุฑ ุบูุฑ ุงููุฏููุนุฉ โ

**ุงููุฏู:** ุงูุชุญูู ูู ุนุฏู ุฅูุดุงุก Vendor Credit ููููุงุชูุฑ ุบูุฑ ุงููุฏููุนุฉ

**ุงูุฎุทูุงุช:**
1. ุฃูุดุฆ ูุงุชูุฑุฉ ุดุฑุงุก ุฌุฏูุฏุฉ
2. **ูุง ุชุฏูุน ุงููุงุชูุฑุฉ** (ุงุชุฑููุง ุจุญุงูุฉ **Received**)
3. ุฃูุดุฆ ูุฑุชุฌุน ุนูู ูุฐู ุงููุงุชูุฑุฉ
4. ุงุฐูุจ ุฅูู **Vendor Credits**
5. **ุชุญูู:** ูุฌุจ ุฃูุง ุชุฌุฏ ุฅุดุนุงุฑ ุฏุงุฆู ุฌุฏูุฏ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ูุง ูุชู ุฅูุดุงุก Vendor Credit
- โ ุฑุณุงูุฉ ูู console ุชููู "Bill is not Paid or Partially Paid"

---

### ุงูุณููุงุฑูู 3๏ธโฃ: ููุน ุงูุงุฒุฏูุงุฌ ๐ซ

**ุงููุฏู:** ุงูุชุญูู ูู ููุน ุฅูุดุงุก vendor_credit ูุฑุชูู ูููุณ ุงููุฑุชุฌุน

**ุงูุฎุทูุงุช:**
1. ุฃูุดุฆ ูุงุชูุฑุฉ ูุฏููุนุฉ
2. ุฃูุดุฆ ูุฑุชุฌุน ุนูููุง (ุณูุชู ุฅูุดุงุก Vendor Credit ุชููุงุฆูุงู)
3. ุญุงูู ุฅูุดุงุก Vendor Credit ูุฏููุงู ูููุณ ุงููุฑุชุฌุน (ุนุจุฑ SQL ุฃู API)
4. **ุชุญูู:** ูุฌุจ ุฃู ุชุญุตู ุนูู ุฎุทุฃ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุฎุทุฃ: "duplicate key value violates unique constraint"
- โ ูุง ูููู ุฅูุดุงุก vendor_credit ูุฑุชูู ูููุณ ุงููุฑุชุฌุน

---

### ุงูุณููุงุฑูู 4๏ธโฃ: ุชุทุจูู Vendor Credit ุนูู ูุงุชูุฑุฉ ๐ฐ

**ุงููุฏู:** ุงูุชุญูู ูู ุชุทุจูู Vendor Credit ุนูู ูุงุชูุฑุฉ ููุฑุฏ

**ุงูุฎุทูุงุช:**
1. ุฃูุดุฆ Vendor Credit (ุนุจุฑ ูุฑุชุฌุน ุนูู ูุงุชูุฑุฉ ูุฏููุนุฉ)
2. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูู Vendor Credit
3. ุงุถุบุท ุนูู **"ุชุทุจูู ุนูู ูุงุชูุฑุฉ ููุฑุฏ"**
4. ุงุฎุชุฑ ูุงุชูุฑุฉ ูู ููุณ ุงูููุฑุฏ
5. ุฃุฏุฎู ุงููุจูุบ ุงููุฑุงุฏ ุชุทุจููู
6. ุงุญูุธ
7. **ุชุญูู:** 
   - ุญุงูุฉ ุงูุฅุดุนุงุฑ ุชุญุฏุซุช
   - ุงููุจูุบ ุงููุทุจู ุชุญุฏุซ
   - ุญุงูุฉ ุงููุงุชูุฑุฉ ุชุญุฏุซุช

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ `applied_amount` ูุฒูุฏ
- โ ุงูุญุงูุฉ ุชุชุบูุฑ ูู `open` ุฅูู `applied`
- โ ุญุงูุฉ ุงููุงุชูุฑุฉ ุชุชุญุฏุซ (ุฅุฐุง ุชู ุฏูุน ูุงูู ุงููุจูุบ โ `paid`)

---

### ุงูุณููุงุฑูู 5๏ธโฃ: ุชุญุฏูุซ ุงูุญุงูุฉ ุชููุงุฆูุงู ๐

**ุงููุฏู:** ุงูุชุญูู ูู ุชุญุฏูุซ ุญุงูุฉ Vendor Credit ุชููุงุฆูุงู

**ุงูุฎุทูุงุช:**
1. ุฃูุดุฆ Vendor Credit ุจูููุฉ 1000 ุฌููู
2. ุทุจูู 500 ุฌููู ุนูู ูุงุชูุฑุฉ
3. **ุชุญูู:** ุงูุญุงูุฉ = `applied`
4. ุทุจูู 500 ุฌููู ุงููุชุจููุฉ ุนูู ูุงุชูุฑุฉ ุฃุฎุฑู
5. **ุชุญูู:** ุงูุญุงูุฉ = `closed`

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุนูุฏ ุชุทุจูู ุฌุฒุก: ุงูุญุงูุฉ = `applied`
- โ ุนูุฏ ุชุทุจูู ูุงูู ุงููุจูุบ: ุงูุญุงูุฉ = `closed`
- โ ุงูุชุญุฏูุซ ูุชู ุชููุงุฆูุงู ุจุฏูู ุชุฏุฎู ูุฏูู

---

## ๐ ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ูุญุต ุงูุฃุนูุฏุฉ ุงูุฌุฏูุฏุฉ:
```sql
SELECT column_name, data_type, is_nullable 
FROM information_schema.columns 
WHERE table_name = 'vendor_credits' 
  AND column_name IN ('branch_id', 'cost_center_id', 'source_purchase_invoice_id', 'source_purchase_return_id', 'reference_type', 'reference_id')
ORDER BY column_name;
```

### ูุญุต ุงูููุงุฑุณ:
```sql
SELECT indexname, indexdef 
FROM pg_indexes 
WHERE tablename = 'vendor_credits' 
  AND indexname LIKE 'idx_vendor_credits_%'
ORDER BY indexname;
```

### ูุญุต ุงูู Triggers:
```sql
SELECT trigger_name, event_manipulation, event_object_table 
FROM information_schema.triggers 
WHERE trigger_name LIKE '%vendor_credit%'
ORDER BY trigger_name;
```

### ูุญุต Vendor Credits ุงููุฑุชุจุทุฉ ุจูุฑุชุฌุนุงุช:
```sql
SELECT 
  vc.credit_number,
  vc.credit_date,
  vc.total_amount,
  vc.applied_amount,
  vc.status,
  pr.return_number,
  b.bill_number,
  s.name as supplier_name
FROM vendor_credits vc
LEFT JOIN purchase_returns pr ON vc.source_purchase_return_id = pr.id
LEFT JOIN bills b ON vc.source_purchase_invoice_id = b.id
LEFT JOIN suppliers s ON vc.supplier_id = s.id
WHERE vc.reference_type = 'purchase_return'
ORDER BY vc.created_at DESC;
```

---

## ๐ ูุงุฆูุฉ ุงูุชุญูู

### ูุจู ุงูุงุฎุชุจุงุฑ:
- [ ] ุงูุชุทุจูู ูุนูู (`npm run dev`)
- [ ] ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุญุฏุซุฉ
- [ ] ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู console

### ุฃุซูุงุก ุงูุงุฎุชุจุงุฑ:
- [ ] ุงูุณููุงุฑูู 1: ุฅูุดุงุก Vendor Credit ุชููุงุฆูุงู โ
- [ ] ุงูุณููุงุฑูู 2: ุนุฏู ุฅูุดุงุก ููููุงุชูุฑ ุบูุฑ ุงููุฏููุนุฉ โ
- [ ] ุงูุณููุงุฑูู 3: ููุน ุงูุงุฒุฏูุงุฌ ๐ซ
- [ ] ุงูุณููุงุฑูู 4: ุชุทุจูู Vendor Credit ๐ฐ
- [ ] ุงูุณููุงุฑูู 5: ุชุญุฏูุซ ุงูุญุงูุฉ ุชููุงุฆูุงู ๐

### ุจุนุฏ ุงูุงุฎุชุจุงุฑ:
- [ ] ูุฑุงุฌุนุฉ ุงููููุฏ ุงููุญุงุณุจูุฉ
- [ ] ุงูุชุญูู ูู ุตุญุฉ ุงูุฃุฑุตุฏุฉ
- [ ] ูุฑุงุฌุนุฉ console logs
- [ ] ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูู ูุชู ุฅูุดุงุก Vendor Credit
**ุงูุญู:**
1. ุชุญูู ูู ุญุงูุฉ ุงููุงุชูุฑุฉ (ูุฌุจ ุฃู ุชููู Paid ุฃู Partially Paid)
2. ุงูุชุญ console ูุงุจุญุซ ุนู ุฑุณุงุฆู ุงูุฎุทุฃ
3. ุชุญูู ูู ูุฌูุฏ ููุฏ ูุญุงุณุจู ูููุงุชูุฑุฉ

### ุงููุดููุฉ: ุฎุทุฃ "Vendor Credit already exists"
**ุงูุญู:**
- ูุฐุง ุทุจูุนู - ูููุน ุงููุธุงู ุฅูุดุงุก vendor_credit ููุฑุฑ

### ุงููุดููุฉ: ูุง ูููู ุชุทุจูู Vendor Credit
**ุงูุญู:**
1. ุชุญูู ูู ุฃู ุงููุงุชูุฑุฉ ูููุณ ุงูููุฑุฏ
2. ุชุญูู ูู ุฃู ุงููุจูุบ ุงููุชุจูู ูุงูู
3. ุชุญูู ูู ุฃู ุงููุงุชูุฑุฉ ููุณุช ูุฏููุนุฉ ุจุงููุงูู

---

## ๐ ุงูุฏุนู

ูููุณุงุนุฏุฉ:
1. ุฑุงุฌุน `docs/VENDOR_CREDITS_AUTOMATIC_SYSTEM.md`
2. ุฑุงุฌุน `VENDOR_CREDITS_IMPLEMENTATION_GUIDE.md`
3. ุชุญูู ูู console logs
4. ุฑุงุฌุน database logs ูู Supabase

---

**ุชุงุฑูุฎ:** 2026-01-06  
**ุงูุฅุตุฏุงุฑ:** 1.0.0  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุฎุชุจุงุฑ

