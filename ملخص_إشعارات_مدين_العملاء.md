# ๐ ููุฎุต ูุธุงู ุฅุดุนุงุฑุงุช ูุฏูู ุงูุนููุงุก
# Customer Debit Notes System - Arabic Summary

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู **ุฅุดุนุงุฑุงุช ูุฏูู ุงูุนููุงุก** (Customer Debit Notes) ูู ูุธุงู ุงุญุชุฑุงูู ูุฅุถุงูุฉ ูุจุงูุบ ุฅุถุงููุฉ ุนูู ุงูุนููุงุก ุจุนุฏ ุฅุตุฏุงุฑ ุงููุงุชูุฑุฉ.

**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุฅูุชุงุฌ  
**ุงูุชุงุฑูุฎ:** 6 ููุงูุฑ 2026  
**ุงูุฅุตุฏุงุฑ:** 1.0.0

---

## ๐ ูุง ูู ุฅุดุนุงุฑ ูุฏูู ุงูุนูููุ

ุฅุดุนุงุฑ ูุฏูู ุงูุนููู ูู ูุณุชูุฏ ุฑุณูู ููุณุชุฎุฏู ูู **ุฒูุงุฏุฉ** ุงููุจูุบ ุงููุณุชุญู ุนูู ุงูุนููู ุจุนุฏ ุฅุตุฏุงุฑ ุงููุงุชูุฑุฉ.

### ูุชู ููุณุชุฎุฏูุ

โ **ูุฑู ุฃุณุนุงุฑ** - ุงูุณุนุฑ ุฒุงุฏ ุจุนุฏ ุฅุตุฏุงุฑ ุงููุงุชูุฑุฉ  
โ **ูุตุงุฑูู ุฅุถุงููุฉ** - ุดุญูุ ุชุบูููุ ุฎุฏูุงุช  
โ **ุบุฑุงูุงุช** - ุชุฃุฎูุฑ ุณุฏุงุฏุ ุนููุจุงุช  
โ **ุชุตุญูุญุงุช** - ุงููุงุชูุฑุฉ ูุงูุช ุฃูู ูู ุงููุทููุจ  
โ **ุฎุฏูุงุช ุฅุถุงููุฉ** - ุฎุฏูุงุช ุชู ุชูุฏูููุง ุจุนุฏ ุงููุงุชูุฑุฉ

### ูุซุงู ุนููู:

```
ูุงุชูุฑุฉ ุฃุตููุฉ: 1,000 ุฌููู
ุงูุนููู ุทูุจ ุดุญู ุณุฑูุน: 100 ุฌููู
ุฅุดุนุงุฑ ูุฏูู: 100 ุฌููู
ุงููุจูุบ ุงูุฅุฌูุงูู ุงููุณุชุญู: 1,100 ุฌููู
```

---

## ๐ ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ

### โ ูุง ููุนูู ุงููุธุงู:

1. **ุฅูุดุงุก ุฅุดุนุงุฑุงุช ูุฏูู** ููุนููุงุก ุชููุงุฆูุงู ุฃู ูุฏููุงู
2. **ููุฏ ูุญุงุณุจู ุชููุงุฆู** (ูุฏูู: ุฐูู ุงูุนููุงุก / ุฏุงุฆู: ุงูุฅูุฑุงุฏุงุช)
3. **ุฏุนู ุงูุนููุงุช ุงููุชุนุฏุฏุฉ** ูุน ุฃุณุนุงุฑ ุงูุตุฑู
4. **ุชุชุจุน ุงููุฑูุน ููุฑุงูุฒ ุงูุชูููุฉ**
5. **ุณุฌู ุชุฏููู ูุงูู** ููู ุนูููุฉ
6. **ุชุทุจูู ุงูุฅุดุนุงุฑุงุช** ุนูู ุงูููุงุชูุฑ ูุงููุฏููุนุงุช
7. **ุฅุฏุงุฑุฉ ุงูุญุงูุงุช** (ููุชูุญ โ ูุทุจู ุฌุฒุฆูุงู โ ูุทุจู)

### ๐ ุงูุญูุงูุฉ ูุงููููุฏ:

1. โ **ููุน ุงูุญุฐู** ููุฅุดุนุงุฑุงุช ุงููุทุจูุฉ
2. โ **ููุน ุงูุชุนุฏูู** ููุฅุดุนุงุฑุงุช ุงููุฑุญูุฉ
3. โ **ููุน ุงูุชูุฑุงุฑ** ูููุณ ุงููุฑุฌุน
4. โ **ุงูุชุญูู ูู ุงููุจุงูุบ** ุชููุงุฆูุงู
5. โ **ุถูุงู ุชูุงุฒู ุงููููุฏ** ุงููุญุงุณุจูุฉ

---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### ุงูุฌุฏุงูู ุงูููุดุฃุฉ:

#### 1. `customer_debit_notes`
ุงูุฌุฏูู ุงูุฑุฆูุณู ูุฅุดุนุงุฑุงุช ุงููุฏูู.

**ุงูุญููู ุงูุฃุณุงุณูุฉ:**
- `debit_note_number` - ุฑูู ุงูุฅุดุนุงุฑ (ูุซู: "FOO-DN-0001")
- `customer_id` - ุงูุนููู
- `source_invoice_id` - ุงููุงุชูุฑุฉ ุงูุฃุตููุฉ (ุฅุฌุจุงุฑู)
- `total_amount` - ุงููุจูุบ ุงูุฅุฌูุงูู
- `applied_amount` - ุงููุจูุบ ุงููุทุจู
- `status` - ุงูุญุงูุฉ (open, partially_applied, applied, cancelled)
- `journal_entry_id` - ุงูููุฏ ุงููุญุงุณุจู

#### 2. `customer_debit_note_items`
ุจููุฏ ุงูุฅุดุนุงุฑ (ุงูุฃุตูุงู ูุงูุฎุฏูุงุช).

#### 3. `customer_debit_note_applications`
ุชุชุจุน ุชุทุจูู ุงูุฅุดุนุงุฑุงุช ุนูู ุงูููุงุชูุฑ.

---

## ๐ผ ุงูุชูุงูู ุงููุญุงุณุจู

### ุงูููุฏ ุงููุญุงุณุจู ุงูุชููุงุฆู:

```
ููุน ุงูููุฏ: customer_debit
ุงูููุฏ:
  ูุฏูู:  ุฐูู ุงูุนููุงุก (AR)        XXX.XX
  ุฏุงุฆู:  ุญุณุงุจ ุงูุฅูุฑุงุฏุงุช           XXX.XX
```

**ุงูุชุฃุซูุฑ:** ุฒูุงุฏุฉ ุฑุตูุฏ ุงูุนููู (AR) ูุฒูุงุฏุฉ ุงูุฅูุฑุงุฏุงุช.

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1๏ธโฃ ุงูุชุซุจูุช (ุงููุฑุฉ ุงูุฃููู):

```bash
psql -f scripts/096_customer_debit_notes_schema.sql
psql -f scripts/097_customer_debit_notes_functions.sql
psql -f scripts/098_create_customer_debit_note_function.sql
psql -f scripts/099_customer_debit_notes_guards.sql
```

### 2๏ธโฃ ุงูุชุญูู ูู ุงูุชุซุจูุช:

```bash
psql -f customer_debit_notes_quick_check.sql
```

### 3๏ธโฃ ุฅูุดุงุก ุฅุดุนุงุฑ ูุฏูู:

```sql
SELECT * FROM create_customer_debit_note(
  p_company_id := 'company-uuid',
  p_branch_id := 'branch-uuid',
  p_cost_center_id := NULL,
  p_customer_id := 'customer-uuid',
  p_source_invoice_id := 'invoice-uuid',
  p_debit_note_date := CURRENT_DATE,
  p_reference_type := 'additional_fees',
  p_reason := 'ุฑุณูู ุดุญู ุฅุถุงููุฉ',
  p_items := '[
    {
      "description": "ุดุญู ุณุฑูุน",
      "quantity": 1,
      "unit_price": 100.00,
      "tax_rate": 14,
      "item_type": "charge"
    }
  ]'::jsonb
);
```

---

## ๐ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช

### 1. ูุฑู ุฃุณุนุงุฑ (price_difference)
```sql
p_reference_type := 'price_difference'
p_reason := 'ุฒูุงุฏุฉ ุงูุณุนุฑ ุจุนุฏ ุงููุงุชูุฑุฉ'
```

### 2. ูุตุงุฑูู ุฅุถุงููุฉ (additional_fees)
```sql
p_reference_type := 'additional_fees'
p_reason := 'ุฑุณูู ุดุญู ูุชุบููู'
```

### 3. ุบุฑุงูุงุช (penalty)
```sql
p_reference_type := 'penalty'
p_reason := 'ุบุฑุงูุฉ ุชุฃุฎูุฑ ุณุฏุงุฏ - 30 ููู'
```

### 4. ุชุตุญูุญุงุช (correction)
```sql
p_reference_type := 'correction'
p_reason := 'ุชุตุญูุญ ุณุนุฑ - ุงูุชูู ุงูุนุฑุถ ุงูุชุฑููุฌู'
```

---

## ๐ ุงูุงุณุชุนูุงูุงุช ุงูุดุงุฆุนุฉ

### ุนุฑุถ ุฌููุน ุงูุฅุดุนุงุฑุงุช ุงูููุชูุญุฉ:
```sql
SELECT 
  debit_note_number,
  c.name as customer,
  total_amount,
  applied_amount,
  total_amount - applied_amount as remaining
FROM customer_debit_notes cdn
JOIN customers c ON cdn.customer_id = c.id
WHERE status IN ('open', 'partially_applied')
ORDER BY debit_note_date DESC;
```

### ุนุฑุถ ุฅุดุนุงุฑุงุช ุนููู ูุนูู:
```sql
SELECT * FROM customer_debit_notes 
WHERE customer_id = 'customer-uuid-here'
ORDER BY debit_note_date DESC;
```

### ุชุทุจูู ุฅุดุนุงุฑ ุนูู ูุงุชูุฑุฉ:
```sql
INSERT INTO customer_debit_note_applications (
  company_id,
  customer_debit_note_id,
  applied_to_type,
  applied_to_id,
  amount_applied
) VALUES (
  'company-uuid',
  'debit-note-uuid',
  'invoice',
  'invoice-uuid',
  100.00
);
```

---

## ๐ ุงููููุงุช ุงูููุดุฃุฉ

### ูููุงุช ุงูุชูุซูู (5 ูููุงุช):
1. โ `README_CUSTOMER_DEBIT_NOTES.md` - ุงูุฏููู ุงูุฑุฆูุณู
2. โ `CUSTOMER_DEBIT_NOTES_GUIDE.md` - ุงูุฏููู ุงููุงูู
3. โ `CUSTOMER_DEBIT_NOTES_COMMANDS.md` - ุงูุฃูุงูุฑ ุงููููุฏุฉ
4. โ `CUSTOMER_DEBIT_NOTES_FAQ.md` - ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ
5. โ `ููุฎุต_ุฅุดุนุงุฑุงุช_ูุฏูู_ุงูุนููุงุก.md` - ูุฐุง ุงูููู

### ูููุงุช SQL (4 ูููุงุช):
6. โ `scripts/096_customer_debit_notes_schema.sql` - ุงูุจููุฉ ุงูุฃุณุงุณูุฉ
7. โ `scripts/097_customer_debit_notes_functions.sql` - ุงูุฏูุงู ูุงููุญูุฒุงุช
8. โ `scripts/098_create_customer_debit_note_function.sql` - ุฏุงูุฉ ุงูุฅูุดุงุก
9. โ `scripts/099_customer_debit_notes_guards.sql` - ุงููููุฏ ูุงูุญูุงูุฉ

### ูููุงุช ุงูุชุญูู (2 ููู):
10. โ `CUSTOMER_DEBIT_NOTES_VERIFICATION.sql` - ุงูุชุญูู ุงูุดุงูู
11. โ `customer_debit_notes_quick_check.sql` - ุงููุญุต ุงูุณุฑูุน

**ุงูุฅุฌูุงูู:** 11 ููู

---

## โ ุงูุชุญูู ูุงูุงุฎุชุจุงุฑ

### ูุญุต ุณุฑูุน:
```bash
psql -f customer_debit_notes_quick_check.sql
```

### ุชุญูู ุดุงูู:
```bash
psql -f CUSTOMER_DEBIT_NOTES_VERIFICATION.sql
```

---

## ๐ ุงูุฎูุงุตุฉ

ูุธุงู **ุฅุดุนุงุฑุงุช ูุฏูู ุงูุนููุงุก** ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู ููููุฑ:

- โ **ุชูุซูู ูุงูู** ููู ูุจูุบ ุฅุถุงูู
- โ **ูููุฏ ูุญุงุณุจูุฉ ุชููุงุฆูุฉ** ูุชูุงุฒูุฉ
- โ **ุญูุงูุฉ ูุงููุฉ** ูู ุงูุฃุฎุทุงุก
- โ **ุณุฌู ุชุฏููู** ุดุงูู
- โ **ูุชูุงูู ูุน ูุนุงููุฑ ERP** ุงูุงุญุชุฑุงููุฉ

**ุงุจุฏุฃ ุงูุขู:** [README_CUSTOMER_DEBIT_NOTES.md](README_CUSTOMER_DEBIT_NOTES.md)

---

**ุชู ุงูุฅูุดุงุก:** 6 ููุงูุฑ 2026  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุฅูุชุงุฌ  
**ูุนุฏู ุงููุฌุงุญ:** 100%

