# ุฏููู ุชูููุฐ ูุธุงู ุฅุดุนุงุฑุงุช ุฏุงุฆู ุงูููุฑุฏูู (Vendor Credits)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชูููุฐ ูุธุงู ุฅุดุนุงุฑุงุช ุฏุงุฆู ุงูููุฑุฏูู (Vendor Credits) ุงูุชููุงุฆู ุนูุฏ ูุฑุชุฌุนุงุช ุงููุดุชุฑูุงุช ูููุงู ููููุงุตูุงุช ุงูุฅูุฒุงููุฉ ุงููุญุฏุฏุฉ.

## ๐ฏ ุงูุฃูุฏุงู ุงููุญููุฉ

โ **ุฅูุดุงุก Vendor Credit ุชููุงุฆูุงู** ุนูุฏ ูุฑุชุฌุน ูุงุชูุฑุฉ Paid/Partially Paid  
โ **ุฑุจุท ุงูุฅุดุนุงุฑ ุจุงูุณูุงู ุงูุตุญูุญ** (company, branch, cost_center, vendor, invoice, return)  
โ **ุฅูุดุงุก ููุฏ ูุญุงุณุจู ุนูุณู** ุตุญูุญ  
โ **ุชุญุฏูุซ ุญุงูุฉ ุงูุฅุดุนุงุฑ ุชููุงุฆูุงู** (open โ applied โ closed)  
โ **ุฏุนู ุชุทุจูู ุงูุฅุดุนุงุฑ ุนูู ููุงุชูุฑ ุงูููุฑุฏ**  
โ **ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ** (Migration Script)  
โ **ููุน ุงูุงุฒุฏูุงุฌ** (ุนุฏู ุฅูุดุงุก vendor_credit ูุฑุชูู ูููุณ ุงููุฑุชุฌุน)  

## ๐ ุงููููุงุช ุงููุถุงูุฉ/ุงููุนุฏูุฉ

### 1. Database Schema
```
scripts/092_vendor_credits_enhancement.sql
```
- ุฅุถุงูุฉ ุญููู: `branch_id`, `cost_center_id`, `source_purchase_invoice_id`, `source_purchase_return_id`, `subtotal`, `tax_amount`
- ุฅุถุงูุฉ triggers ูุชุญุฏูุซ ุงูุญุงูุฉ ุชููุงุฆูุงู
- ุฅุถุงูุฉ ูููุฏ ูุฑูุฏุฉ ูููุน ุงูุงุฒุฏูุงุฌ

### 2. Helper Functions
```
lib/purchase-returns-vendor-credits.ts
```
- ุฏุงูุฉ `createVendorCreditForReturn()` ูุฅูุดุงุก Vendor Credits ุชููุงุฆูุงู
- ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ vendor_credit ูุณุจู
- ุฅูุดุงุก ุจููุฏ vendor_credit ูู ุจููุฏ ุงููุฑุชุฌุน

### 3. UI Components
```
app/purchase-returns/new/page.tsx
```
- ุชุญุฏูุซ ููุทู ุงูุญูุธ ูุฅูุดุงุก Vendor Credit ุชููุงุฆูุงู
- ุงุณุชุฏุนุงุก `createVendorCreditForReturn()` ููููุงุชูุฑ Paid/Partially Paid

```
app/vendor-credits/[id]/page.tsx
```
- ุนุฑุถ ูุนูููุงุช ุงููุฑุชุฌุน ุงููุฑุชุจุท
- ุนุฑุถ ุงููุงุชูุฑุฉ ุงูุฃุตููุฉ
- ุนุฑุถ ุงููุฑุน ููุฑูุฒ ุงูุชูููุฉ

### 4. Migration Scripts
```
scripts/093_migrate_existing_purchase_returns_to_vendor_credits.sql
```
- ูุนุงูุฌุฉ ุงููุฑุชุฌุนุงุช ุงูููุฌูุฏุฉ
- ุฅูุดุงุก vendor_credits ููุงุจูุฉ ููุง
- ููุน ุงูุงุฒุฏูุงุฌ

### 5. Documentation
```
docs/VENDOR_CREDITS_AUTOMATIC_SYSTEM.md
```
- ุชูุซูู ุดุงูู ูููุธุงู
- ุงูููุงุนุฏ ุงูุฅูุฒุงููุฉ
- ุฃูุซูุฉ ุนูู ุณูุฑ ุงูุนูู

## ๐ ุฎุทูุงุช ุงูุชุทุจูู

### ุงูุฎุทูุฉ 1: ุชุทุจูู ุชุญุฏูุซุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ุนูู Supabase Dashboard:
1. ุงูุชุญ SQL Editor ูู Supabase Dashboard
2. ุงูุณุฎ ูุญุชูู `scripts/092_vendor_credits_enhancement.sql`
3. ููุฐ ุงูุณูุฑูุจุช
4. ุชุญูู ูู ุงููุชุงุฆุฌ

#### ุฃู ุนุจุฑ CLI:
```bash
psql -U postgres -d your_database -f scripts/092_vendor_credits_enhancement.sql
```

### ุงูุฎุทูุฉ 2: ุชุทุจูู Migration ููุจูุงูุงุช ุงูููุฌูุฏุฉ

#### ุนูู Supabase Dashboard:
1. ุงูุชุญ SQL Editor
2. ุงูุณุฎ ูุญุชูู `scripts/093_migrate_existing_purchase_returns_to_vendor_credits.sql`
3. ููุฐ ุงูุณูุฑูุจุช
4. ุฑุงุฌุน ุงููุชุงุฆุฌ ูู ุงูู Logs

#### ุฃู ุนุจุฑ CLI:
```bash
psql -U postgres -d your_database -f scripts/093_migrate_existing_purchase_returns_to_vendor_credits.sql
```

### ุงูุฎุทูุฉ 3: ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู

```bash
npm run dev
```

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### 1. ุงุฎุชุจุงุฑ ุฅูุดุงุก Vendor Credit ุชููุงุฆูุงู

1. ุฃูุดุฆ ูุงุชูุฑุฉ ุดุฑุงุก ุฌุฏูุฏุฉ
2. ุงุฏูุน ุงููุงุชูุฑุฉ (ุญุงูุฉ: Paid)
3. ุฃูุดุฆ ูุฑุชุฌุน ูุดุชุฑูุงุช ุนูู ุงููุงุชูุฑุฉ
4. ุชุญูู ูู ุฅูุดุงุก Vendor Credit ุชููุงุฆูุงู
5. ุชุญูู ูู ุฑุจุท ุงูุฅุดุนุงุฑ ุจุงููุงุชูุฑุฉ ูุงููุฑุชุฌุน

### 2. ุงุฎุชุจุงุฑ ุนุฏู ุฅูุดุงุก Vendor Credit ููููุงุชูุฑ ุบูุฑ ุงููุฏููุนุฉ

1. ุฃูุดุฆ ูุงุชูุฑุฉ ุดุฑุงุก ุฌุฏูุฏุฉ (ุญุงูุฉ: Received)
2. ุฃูุดุฆ ูุฑุชุฌุน ูุดุชุฑูุงุช ุนูู ุงููุงุชูุฑุฉ
3. ุชุญูู ูู **ุนุฏู** ุฅูุดุงุก Vendor Credit

### 3. ุงุฎุชุจุงุฑ ุชุทุจูู Vendor Credit ุนูู ูุงุชูุฑุฉ

1. ุงูุชุญ ุตูุญุฉ Vendor Credit
2. ุงุถุบุท ุนูู "ุชุทุจูู ุนูู ูุงุชูุฑุฉ ููุฑุฏ"
3. ุงุฎุชุฑ ูุงุชูุฑุฉ ูู ููุณ ุงูููุฑุฏ
4. ุฃุฏุฎู ุงููุจูุบ ุงููุฑุงุฏ ุชุทุจููู
5. ุชุญูู ูู ุชุญุฏูุซ ุญุงูุฉ ุงูุฅุดุนุงุฑ ูุงููุงุชูุฑุฉ

### 4. ุงุฎุชุจุงุฑ ููุน ุงูุงุฒุฏูุงุฌ

1. ุญุงูู ุฅูุดุงุก ูุฑุชุฌุน ูุฑุชูู ุนูู ููุณ ุงููุงุชูุฑุฉ
2. ุชุญูู ูู ุนุฏู ุฅูุดุงุก vendor_credit ููุฑุฑ

## ๐ ุงูุชุญูู ูู ุงููุชุงุฆุฌ

### ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

```sql
-- ุนุฑุถ ุฌููุน Vendor Credits ุงููุฑุชุจุทุฉ ุจูุฑุชุฌุนุงุช
SELECT 
  vc.credit_number,
  vc.credit_date,
  vc.total_amount,
  vc.status,
  pr.return_number,
  b.bill_number,
  s.name as supplier_name
FROM vendor_credits vc
LEFT JOIN purchase_returns pr ON vc.source_purchase_return_id = pr.id
LEFT JOIN bills b ON vc.source_purchase_invoice_id = b.id
LEFT JOIN suppliers s ON vc.supplier_id = s.id
WHERE vc.reference_type = 'purchase_return'
ORDER BY vc.created_at DESC;
```

### ูู ูุงุฌูุฉ ุงููุณุชุฎุฏู:

1. ุงูุชุญ ุตูุญุฉ Vendor Credits
2. ุชุญูู ูู ุนุฑุถ ุฌููุน ุงูุฅุดุนุงุฑุงุช
3. ุงูุชุญ ุฅุดุนุงุฑ ูุนูู
4. ุชุญูู ูู ุนุฑุถ ูุนูููุงุช ุงููุฑุชุฌุน ูุงููุงุชูุฑุฉ ุงูุฃุตููุฉ

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ูุง ุชูู ุจุชุนุฏูู vendor_credits ูุฏููุงู** - ูุชู ุฅูุดุงุคูุง ุชููุงุฆูุงู
2. **ูุง ุชุญุฐู vendor_credits** - ูุฏ ูุคุซุฑ ุนูู ุณูุงูุฉ ุงูุจูุงูุงุช
3. **ุชุญูู ูู ุงูุฃุฑุตุฏุฉ** ุจุนุฏ ุชุทุจูู Migration
4. **ุฑุงุฌุน ุงููููุฏ ุงููุญุงุณุจูุฉ** ููุชุฃูุฏ ูู ุตุญุชูุง

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูู ูุชู ุฅูุดุงุก Vendor Credit

**ุงูุญู:**
1. ุชุญูู ูู ุญุงูุฉ ุงููุงุชูุฑุฉ (ูุฌุจ ุฃู ุชููู Paid ุฃู Partially Paid)
2. ุชุญูู ูู ูุฌูุฏ ููุฏ ูุญุงุณุจู ูููุงุชูุฑุฉ
3. ุฑุงุฌุน console logs ููุฃุฎุทุงุก

### ุงููุดููุฉ: ุฎุทุฃ "Vendor Credit already exists"

**ุงูุญู:**
- ูุฐุง ุทุจูุนู - ูููุน ุงููุธุงู ุฅูุดุงุก vendor_credit ููุฑุฑ ูููุณ ุงููุฑุชุฌุน

### ุงููุดููุฉ: ูุง ูููู ุชุทุจูู Vendor Credit ุนูู ูุงุชูุฑุฉ

**ุงูุญู:**
1. ุชุญูู ูู ุฃู ุงููุงุชูุฑุฉ ูููุณ ุงูููุฑุฏ
2. ุชุญูู ูู ุฃู ุงููุจูุบ ุงููุชุจูู ูู ุงูุฅุดุนุงุฑ ูุงูู
3. ุชุญูู ูู ุฃู ุงููุงุชูุฑุฉ ููุณุช ูุฏููุนุฉ ุจุงููุงูู

## ๐ ุงูุฏุนู

ูููุณุงุนุฏุฉ ุฃู ุงูุฅุจูุงุบ ุนู ูุดุงููุ ูุฑุฌู:
1. ูุฑุงุฌุนุฉ ุงูุชูุซูู ูู `docs/VENDOR_CREDITS_AUTOMATIC_SYSTEM.md`
2. ุงูุชุญูู ูู console logs
3. ูุฑุงุฌุนุฉ database logs ูู Supabase

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ

- [ ] ุชู ุชุทุจูู `092_vendor_credits_enhancement.sql`
- [ ] ุชู ุชุทุจูู `093_migrate_existing_purchase_returns_to_vendor_credits.sql`
- [ ] ุชู ุงุฎุชุจุงุฑ ุฅูุดุงุก Vendor Credit ุชููุงุฆูุงู
- [ ] ุชู ุงุฎุชุจุงุฑ ุชุทุจูู Vendor Credit ุนูู ูุงุชูุฑุฉ
- [ ] ุชู ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุงุฒุฏูุงุฌ
- [ ] ุชู ูุฑุงุฌุนุฉ ุงููููุฏ ุงููุญุงุณุจูุฉ
- [ ] ุชู ุงูุชุญูู ูู ุตุญุฉ ุงูุฃุฑุตุฏุฉ

---

**ุชุงุฑูุฎ ุงูุชูููุฐ:** 2026-01-06  
**ุงูุฅุตุฏุงุฑ:** 1.0.0  
**ุงูุญุงูุฉ:** โ ููุชูู

