# ๐งช ุฏููู ุงุฎุชุจุงุฑ ููุธููุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุนุงุฏุฉ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงูุฏููู ููุถุญ ููููุฉ ุงุฎุชุจุงุฑ ููุธููุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุนุงุฏุฉ ุจุดูู ุดุงูู ููุชุฃูุฏ ูู ุฃููุง ุชุนูู ุจุดูู ุตุญูุญ ูุขูู.

---

## ๐ฏ ุงูุณููุงุฑูู ุงููุงูู ููุงุฎุชุจุงุฑ

### ุงููุฑุญูุฉ 1: ุงูุฅุนุฏุงุฏ ูุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ

#### 1.1 ุฅูุดุงุก ุดุฑูุฉ ุชุฌุฑูุจูุฉ
```
1. ุชุณุฌูู ุงูุฏุฎูู ููุณุชุฎุฏู ุฌุฏูุฏ
2. ุฅูุดุงุก ุดุฑูุฉ ุฌุฏูุฏุฉ: "ุดุฑูุฉ ุงูุงุฎุชุจุงุฑ"
3. ุฅุนุฏุงุฏ ุฏููู ุงูุญุณุงุจุงุช ุงูุฃุณุงุณู
```

#### 1.2 ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ
```
โ ุงูุนููุงุก:
- ุนููู 1: ูุญูุฏ ุฃุญูุฏ
- ุนููู 2: ูุงุทูุฉ ุนูู
- ุนููู 3: ุฃุญูุฏ ูุญููุฏ

โ ุงูููุฑุฏูู:
- ููุฑุฏ 1: ุดุฑูุฉ ุงูุชูุฑูุฏุงุช
- ููุฑุฏ 2: ูุคุณุณุฉ ุงูุฌููุฉ

โ ุงูููุชุฌุงุช:
- ููุชุฌ 1: ููุชุฌ ุฃ (ุณุนุฑ: 100)
- ููุชุฌ 2: ููุชุฌ ุจ (ุณุนุฑ: 200)
- ููุชุฌ 3: ููุชุฌ ุฌ (ุณุนุฑ: 150)

โ ุงูููุงุชูุฑ:
- ูุงุชูุฑุฉ 1: ููุนููู 1ุ ููุชุฌ ุฃ ร 5 = 500
- ูุงุชูุฑุฉ 2: ููุนููู 2ุ ููุชุฌ ุจ ร 3 = 600
- ูุงุชูุฑุฉ 3: ููุนููู 3ุ ููุชุฌ ุฌ ร 2 = 300
ุงูุฅุฌูุงูู: 1,400

โ ุงููููุฏ ุงููุญุงุณุจูุฉ:
- ููุฏ 1: ูุฏูู 500 (ุงูุนููุงุก) - ุฏุงุฆู 500 (ุงููุจูุนุงุช)
- ููุฏ 2: ูุฏูู 600 (ุงูุนููุงุก) - ุฏุงุฆู 600 (ุงููุจูุนุงุช)
- ููุฏ 3: ูุฏูู 300 (ุงูุนููุงุก) - ุฏุงุฆู 300 (ุงููุจูุนุงุช)
```

#### 1.3 ุงูุชุญูู ูู ุงูุฃุฑุตุฏุฉ ุงูุฃูููุฉ
```sql
-- ุฑุตูุฏ ุงูุนููุงุก (ูุฏูู)
SELECT SUM(debit_amount - credit_amount) FROM journal_entry_lines
WHERE account_id = (SELECT id FROM chart_of_accounts WHERE account_code = '1210')
-- ุงููุชููุน: 1,400

-- ุฑุตูุฏ ุงููุจูุนุงุช (ุฏุงุฆู)
SELECT SUM(credit_amount - debit_amount) FROM journal_entry_lines
WHERE account_id = (SELECT id FROM chart_of_accounts WHERE account_code = '4100')
-- ุงููุชููุน: 1,400
```

---

### ุงููุฑุญูุฉ 2: ุงุฎุชุจุงุฑ ุงูุชุตุฏูุฑ

#### 2.1 ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช
```
โ ุงุฎุชุจุงุฑ 1: ุชุณุฌูู ุงูุฏุฎูู ูู Owner
- ุงูุฐูุงุจ ุฅูู: /settings/backup
- ูุฌุจ ุฃู ูุธูุฑ ุฒุฑ "ุชุตุฏูุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุงููุฉ"
- ุงููุชูุฌุฉ ุงููุชููุนุฉ: โ ูุธูุฑ ุงูุฒุฑ

โ ุงุฎุชุจุงุฑ 2: ุชุณุฌูู ุงูุฏุฎูู ูู Admin
- ุงูุฐูุงุจ ุฅูู: /settings/backup
- ูุฌุจ ุฃู ูุธูุฑ ุฒุฑ "ุชุตุฏูุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุงููุฉ"
- ุงููุชูุฌุฉ ุงููุชููุนุฉ: โ ูุธูุฑ ุงูุฒุฑ

โ ุงุฎุชุจุงุฑ 3: ุชุณุฌูู ุงูุฏุฎูู ูู Accountant
- ุงูุฐูุงุจ ุฅูู: /settings/backup
- ูุฌุจ ุฃู ูุธูุฑ ุชุญุฐูุฑ "ููุท ุงููุงูู ุฃู ุงููุฏูุฑ ููููู ุชุตุฏูุฑ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ"
- ุงููุชูุฌุฉ ุงููุชููุนุฉ: โ ูุธูุฑ ุงูุชุญุฐูุฑ
```

#### 2.2 ุชูููุฐ ุงูุชุตุฏูุฑ
```
1. ุชุณุฌูู ุงูุฏุฎูู ูู Owner
2. ุงูุฐูุงุจ ุฅูู: /settings/backup
3. ุงูุถุบุท ุนูู "ุชุตุฏูุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุงููุฉ"
4. ุงูุชุธุงุฑ ุงูุชูุงู ุงูุชุตุฏูุฑ (Progress Bar)
5. ุญูุธ ุงูููู: backup_ุดุฑูุฉ_ุงูุงุฎุชุจุงุฑ_2024-01-01.json

โ ุงูุชุญูู ูู ุงูููู:
- ุญุฌู ุงูููู > 0 KB
- ุงูููู ุจุตูุบุฉ JSON ุตุญูุญุฉ
- ูุญุชูู ุนูู metadata, schema_info, data
- metadata.total_records > 0
- metadata.checksum ููุฌูุฏ
```

#### 2.3 ูุญุต ูุญุชูู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
```json
{
  "metadata": {
    "version": "2.0",
    "system_version": "1.0.0",
    "company_name": "ุดุฑูุฉ ุงูุงุฎุชุจุงุฑ",
    "total_records": 15,  // ุชูุฑูุจุงู
    "checksum": "..."
  },
  "data": {
    "companies": [1 ุณุฌู],
    "customers": [3 ุณุฌูุงุช],
    "suppliers": [2 ุณุฌูุงุช],
    "products": [3 ุณุฌูุงุช],
    "invoices": [3 ุณุฌูุงุช],
    "invoice_items": [3 ุณุฌูุงุช],
    "journal_entries": [3 ุณุฌูุงุช],
    "journal_entry_lines": [6 ุณุฌูุงุช]
  }
}
```

#### 2.4 ุงูุชุญูู ูู Audit Log
```sql
SELECT * FROM audit_logs
WHERE action = 'backup_export'
ORDER BY created_at DESC
LIMIT 1;

-- ูุฌุจ ุฃู ูุญุชูู ุนูู:
-- โ company_id
-- โ user_id
-- โ action = 'backup_export'
-- โ metadata.total_records
-- โ metadata.size_mb
```

---

### ุงููุฑุญูุฉ 3: ุงุฎุชุจุงุฑ ุงูุงุณุชุนุงุฏุฉ

#### 3.1 ุญุฐู ุงูุจูุงูุงุช (ูุญุงูุงุฉ ููุฏุงู ุงูุจูุงูุงุช)
```sql
-- ุญุฐู ุงูููุงุชูุฑ
DELETE FROM invoice_items WHERE company_id = 'xxx';
DELETE FROM invoices WHERE company_id = 'xxx';

-- ุญุฐู ุงููููุฏ ุงููุญุงุณุจูุฉ
DELETE FROM journal_entry_lines WHERE journal_entry_id IN (
  SELECT id FROM journal_entries WHERE company_id = 'xxx'
);
DELETE FROM journal_entries WHERE company_id = 'xxx';

-- ุงูุชุญูู ูู ุงูุญุฐู
SELECT COUNT(*) FROM invoices WHERE company_id = 'xxx';  -- 0
SELECT COUNT(*) FROM journal_entries WHERE company_id = 'xxx';  -- 0
```

#### 3.2 ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช
```
โ ุงุฎุชุจุงุฑ 1: ุชุณุฌูู ุงูุฏุฎูู ูู Owner
- ุงูุฐูุงุจ ุฅูู: /settings/backup
- ูุฌุจ ุฃู ูุธูุฑ ุฒุฑ "ุงุฎุชูุงุฑ ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ"
- ุงููุชูุฌุฉ ุงููุชููุนุฉ: โ ูุธูุฑ ุงูุฒุฑ

โ ุงุฎุชุจุงุฑ 2: ุชุณุฌูู ุงูุฏุฎูู ูู Admin
- ุงูุฐูุงุจ ุฅูู: /settings/backup
- ูุฌุจ ุฃู ูุธูุฑ ุชุญุฐูุฑ "ููุท ูุงูู ุงูุดุฑูุฉ ููููู ุงุณุชุนุงุฏุฉ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ"
- ุงููุชูุฌุฉ ุงููุชููุนุฉ: โ ูุธูุฑ ุงูุชุญุฐูุฑ
```

#### 3.3 ุชูููุฐ ุงูุงุณุชุนุงุฏุฉ
```
1. ุชุณุฌูู ุงูุฏุฎูู ูู Owner
2. ุงูุฐูุงุจ ุฅูู: /settings/backup
3. ุงูุถุบุท ุนูู "ุงุฎุชูุงุฑ ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ"
4. ุงุฎุชูุงุฑ ุงูููู: backup_ุดุฑูุฉ_ุงูุงุฎุชุจุงุฑ_2024-01-01.json

โ ูุฑุญูุฉ ุงูุชุญูู (Validation Phase):
- ูุธูุฑ "ุฌุงุฑู ุงูุชุญูู ูู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ..."
- ูุธูุฑ ุชูุฑูุฑ ุงูุชุญูู:
  โ ูุนูููุงุช ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
  โ ููุฎุต ุงูุนูููุฉ (15 ุณุฌู ููุฅุฏุฑุงุฌ)
  โ ุชูุงุตูู ุงูุฌุฏุงูู
  โ ุชุญุฐูุฑุงุช (ุณูุชู ุงุณุชุจุฏุงู ุงูุจูุงูุงุช ุงูุญุงููุฉ)
  โ ุชูููู ุงููุฎุงุทุฑ: HIGH

5. ุงูุถุบุท ุนูู "ุฃููู ุฐููุ ุงููุชุงุจุนุฉ ุฅูู ุงูุชุฃููุฏ"

โ ูุฑุญูุฉ ุงูุชุฃููุฏ ุงููุฒุฏูุฌ:
- ูุชุงุจุฉ "RESTORE" ูู ุงูุญูู
- ุชุญุฏูุฏ checkbox "ุฃููู ุฃู ูุฐู ุงูุนูููุฉ ุณุชุญุฐู ุฌููุน ุงูุจูุงูุงุช..."
- ุงูุถุบุท ุนูู "ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ"

โ ูุฑุญูุฉ ุงูุชูููุฐ:
- ูุธูุฑ "ุฌุงุฑู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ..."
- Progress Bar ูู 0% ุฅูู 100%
- ูุธูุฑ "ุชู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ!"
- ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุชููุงุฆูุงู
```

---

### ุงููุฑุญูุฉ 4: ุงูุชุญูู ูู ุงููุชุงุฆุฌ

#### 4.1 ุงูุชุญูู ูู ุงูุจูุงูุงุช
```sql
-- ุนุฏุฏ ุงูููุงุชูุฑ
SELECT COUNT(*) FROM invoices WHERE company_id = 'xxx';
-- ุงููุชููุน: 3 โ

-- ุนุฏุฏ ุงููููุฏ ุงููุญุงุณุจูุฉ
SELECT COUNT(*) FROM journal_entries WHERE company_id = 'xxx';
-- ุงููุชููุน: 3 โ

-- ุนุฏุฏ ุงูุนููุงุก
SELECT COUNT(*) FROM customers WHERE company_id = 'xxx';
-- ุงููุชููุน: 3 โ
```

#### 4.2 ุงูุชุญูู ูู ุงูุฃุฑุตุฏุฉ
```sql
-- ุฑุตูุฏ ุงูุนููุงุก (ูุฏูู)
SELECT SUM(debit_amount - credit_amount) FROM journal_entry_lines
WHERE account_id = (SELECT id FROM chart_of_accounts WHERE account_code = '1210')
-- ุงููุชููุน: 1,400 โ

-- ุฑุตูุฏ ุงููุจูุนุงุช (ุฏุงุฆู)
SELECT SUM(credit_amount - debit_amount) FROM journal_entry_lines
WHERE account_id = (SELECT id FROM chart_of_accounts WHERE account_code = '4100')
-- ุงููุชููุน: 1,400 โ
```

#### 4.3 ุงูุชุญูู ูู ุณูุงูุฉ ุงููููุฏ
```sql
-- ุงูุชุญูู ูู ุชูุงุฒู ุฌููุน ุงููููุฏ
SELECT je.id, je.reference_number,
  SUM(jel.debit_amount) as total_debit,
  SUM(jel.credit_amount) as total_credit,
  ABS(SUM(jel.debit_amount) - SUM(jel.credit_amount)) as difference
FROM journal_entries je
JOIN journal_entry_lines jel ON je.id = jel.journal_entry_id
WHERE je.company_id = 'xxx'
GROUP BY je.id, je.reference_number
HAVING ABS(SUM(jel.debit_amount) - SUM(jel.credit_amount)) > 0.01;

-- ุงููุชููุน: 0 ุณุฌูุงุช (ุฌููุน ุงููููุฏ ูุชูุงุฒูุฉ) โ
```

#### 4.4 ุงูุชุญูู ูู Audit Log
```sql
SELECT * FROM audit_logs
WHERE action = 'backup_restore'
ORDER BY created_at DESC
LIMIT 1;

-- ูุฌุจ ุฃู ูุญุชูู ุนูู:
-- โ company_id
-- โ user_id
-- โ action = 'backup_restore'
-- โ metadata.records_restored = 15
-- โ metadata.success = true
```

---

## โ ูุนุงููุฑ ุงููุฌุงุญ

### ุงูุชุตุฏูุฑ
- [x] ูุนูู ููุท ูู Owner/Admin
- [x] ูุตุฏุฑ ุฌููุน ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ
- [x] ูุณุชุจุนุฏ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ
- [x] ูุญุณุจ Checksum ุตุญูุญ
- [x] ูุณุฌู ูู Audit Log

### ุงูุงุณุชุนุงุฏุฉ
- [x] ูุนูู ููุท ูู Owner
- [x] ูุชุญูู ูู ุตุญุฉ ุงููุณุฎุฉ ูุจู ุงูุงุณุชุนุงุฏุฉ
- [x] ูุนุฑุถ ุชูุฑูุฑ ุชูุตููู
- [x] ูุชุทูุจ ุชุฃููุฏ ูุฒุฏูุฌ
- [x] ูุณุชุนูุฏ ุฌููุน ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ
- [x] ุงูุฃุฑุตุฏุฉ ูุชุทุงุจูุฉ 100%
- [x] ุฌููุน ุงููููุฏ ูุชูุงุฒูุฉ
- [x] ูุง ุชูุฌุฏ ุฃุฎุทุงุก Foreign Key
- [x] ูุณุฌู ูู Audit Log

---

## ๐ฏ ุงูุฎูุงุตุฉ

ุฅุฐุง ูุฌุญุช ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุฃุนูุงูุ ูุฅู ููุธููุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุนุงุฏุฉ:
- โ **ุขููุฉ**: ุตูุงุญูุงุช ูุญุฏุฏุฉุ ุชุญูู ูุฒุฏูุฌ
- โ **ููุซููุฉ**: ูุญุต ุดุงููุ ุชุญูู ูู ุงูุณูุงูุฉ
- โ **ุฏูููุฉ**: ุงูุฃุฑุตุฏุฉ ูุชุทุงุจูุฉ 100%
- โ **ุฌุงูุฒุฉ ููุฅูุชุงุฌ**: ูุง ุฃุฎุทุงุกุ ูุง ููุฏุงู ุจูุงูุงุช

**ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูู ุงูุฅูุชุงุฌ! ๐**

