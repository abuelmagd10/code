# ๐ก๏ธ Realtime Route Guard - ุญูุงูุฉ ุงููุณุงุฑุงุช ูุญุธูุงู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุญูุงูุฉ ูุฑูุฒู ูููุณุงุฑุงุช ูุนูู ูุน Realtime ูุชุญุฏูุซ ุงูุตูุงุญูุงุช ูุญุธูุงู. ูููุน ุงููุตูู ูููุณุงุฑุงุช ุบูุฑ ุงููุณููุญุฉ ููุบูู ุงูุตูุญุงุช ุชููุงุฆูุงู ุนูุฏ ุณุญุจ ุงูุตูุงุญูุฉ.

## ๐ฏ ุงูุฃูุฏุงู

1. **ููุน ุงููุตูู ูููุณุงุฑุงุช ุบูุฑ ุงููุณููุญุฉ**
2. **ุฅุบูุงู ุงูุตูุญุงุช ุชููุงุฆูุงู ุนูุฏ ุณุญุจ ุงูุตูุงุญูุฉ**
3. **Redirect ุชููุงุฆู ูุตูุญุฉ ูุณููุญุฉ**
4. **ุจุฏูู Refresh**

## ๐๏ธ ุงูุจููุฉ

### 1. RealtimeRouteGuard Component

**ุงููููุน**: `components/realtime-route-guard.tsx`

**ุงููุธููุฉ**:
- ุญูุงูุฉ ุฌููุน ุงููุณุงุฑุงุช
- ูุญุต ุงูุตูุงุญูุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
- ุฅุนุงุฏุฉ ุงููุญุต ุนูุฏ ุชุญุฏูุซ ุงูุตูุงุญูุงุช
- Redirect ุชููุงุฆู

**ุงูุงุณุชุฎุฏุงู**:
```tsx
// ูู app/layout.tsx ุฃู AppShell
<RealtimeRouteGuard>
  {children}
</RealtimeRouteGuard>
```

### 2. PageGuard Component

**ุงููููุน**: `components/page-guard.tsx`

**ุงููุธููุฉ**:
- ุญูุงูุฉ ุตูุญุฉ ูุนููุฉ
- ุงูุชุญูู ูู ุงูุตูุงุญูุฉ
- Redirect ุนูุฏ ุนุฏู ุงูุตูุงุญูุฉ

**ุงูุงุณุชุฎุฏุงู**:
```tsx
// ูู ุตูุญุฉ ูุนููุฉ
<PageGuard resource="invoices" fallbackPath="/dashboard">
  <InvoicesContent />
</PageGuard>
```

### 3. AppShell Integration

**ุงููููุน**: `components/app-shell.tsx`

**ุงููุธููุฉ**:
- ุญูุงูุฉ ุนูู ูุณุชูู ุงูุชุทุจูู
- ุงุณุชุฎุฏุงู RealtimeRouteGuard ุฏุงุฎููุงู

## ๐ ุฏูุฑุฉ ุงูุญูุงูุฉ

### 1. ุนูุฏ ุชุญููู ุงูุตูุญุฉ

```
1. RealtimeRouteGuard ููุญุต ุงููุณุงุฑ
2. getResourceFromPath(pathname)
3. canAccessPage(resource)
4. ุฅุฐุง โ: Redirect ุฅูู getFirstAllowedPage()
5. ุฅุฐุง โ: ุนุฑุถ ุงููุญุชูู
```

### 2. ุนูุฏ ุชุบููุฑ ุงูุตูุงุญูุงุช

```
1. Realtime Event ูู Governance Channel
2. useGovernanceRealtime ูุณุชูุจู ุงูุญุฏุซ
3. loadAccessProfile() ูุชู ุงุณุชุฏุนุงุคู
4. AccessContext ูุชุญุฏุซ
5. RealtimeRouteGuard ูุนูุฏ ุงููุญุต
6. ุฅุฐุง โ: ุฅุบูุงู ุงูุตูุญุฉ + Redirect
7. Toast: "ุชู ุชุญุฏูุซ ุตูุงุญูุงุชู..."
```

### 3. ุนูุฏ ุงูุชููู

```
1. ุชุบููุฑ ุงููุณุงุฑ (pathname)
2. RealtimeRouteGuard ููุญุต ุงููุณุงุฑ ุงูุฌุฏูุฏ
3. canAccessPage(resource)
4. ุฅุฐุง โ: Redirect ููุฑุงู
5. ุฅุฐุง โ: ุงูุณูุงุญ ุจุงููุตูู
```

## ๐ซ ููุน ุงููุตูู

### ุงูุญุงูุงุช ุงููุญููุฉ

1. **ุตูุญุฉ ุบูุฑ ูุตุฑุญ ุจูุง**:
   - โ ุงููุณุชุฎุฏู ูุญุงูู ุงููุตูู ูุจุงุดุฑุฉ
   - โ Redirect ุฅูู ุฃูู ุตูุญุฉ ูุณููุญุฉ

2. **ุณุญุจ ุตูุงุญูุฉ ุฃุซูุงุก ุงูุนูู**:
   - โ ุงููุณุชุฎุฏู ูุงู ูู ุตูุญุฉ `/invoices`
   - โ ุฅุบูุงู ุงูุตูุญุฉ ููุฑุงู
   - โ Redirect ุฅูู `/dashboard`
   - โ Toast: "ุชู ุชุญุฏูุซ ุตูุงุญูุงุชู..."

3. **ุชุบููุฑ ุงูุฏูุฑ**:
   - โ ุงููุณุชุฎุฏู ูุงู `manager` ูุฃุตุจุญ `viewer`
   - โ ุฅุบูุงู ุฌููุน ุงูุตูุญุงุช ุบูุฑ ุงููุณููุญุฉ
   - โ Redirect ุฅูู ุฃูู ุตูุญุฉ ูุณููุญุฉ

## ๐ ุงูุฑุณุงุฆู ูุงูุชูุจููุงุช

### ุฑุณุงูุฉ ุนุฏู ุงูุตูุงุญูุฉ

```
"ุบูุฑ ูุตุฑุญ ุจุงููุตูู"
"ุชู ุชุญุฏูุซ ุตูุงุญูุงุชู ุจูุงุณุทุฉ ุงูุฅุฏุงุฑุฉ."
"ูู ูุนุฏ ูุณููุญ ูู ุงููุตูู ุฅูู ูุฐู ุงูุตูุญุฉ."
"ุณูุชู ุชูุฌููู ุชููุงุฆูุงู ุฅูู ุตูุญุฉ ูุณููุญุฉ..."
```

### Toast Notifications

- **ุชุบููุฑ ุงูุฏูุฑ**: "ุชู ุชุญุฏูุซ ุตูุงุญูุงุชู"
- **ุชุบููุฑ ุงููุฑุน**: "ุชู ุชุญุฏูุซ ุชุนูููู"
- **ุชุบููุฑ ุงูุตูุงุญูุงุช**: "ุชู ุชุญุฏูุซ ุตูุงุญูุงุช ุงูุฏูุฑ"

## ๐ ุงูุฃูุงู

### ุทุจูุงุช ุงูุญูุงูุฉ

1. **Route Guard**: ููุน ุงููุตูู ูููุณุงุฑ
2. **PageGuard**: ููุน ุนุฑุถ ุงููุญุชูู
3. **API Security**: ููุน ุงูุนูููุงุช ูู API
4. **Realtime Filtering**: ููุน ุงุณุชูุจุงู ุงูุฃุญุฏุงุซ

### ุงูุชุญูู ุงููุชุนุฏุฏ

```typescript
// 1. Route Guard
if (!canAccessPage(resource)) {
  router.replace(getFirstAllowedPage())
}

// 2. PageGuard
<PageGuard resource={resource}>
  <Content />
</PageGuard>

// 3. API
if (!canAction(resource, action)) {
  return { error: "Unauthorized" }
}
```

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ููุน ุงููุตูู ุงููุจุงุดุฑ

```typescript
// 1. ุชุณุฌูู ุฏุฎูู ููุณุชุฎุฏู ุนุงุฏู
// 2. ูุญุงููุฉ ุงููุตูู ูุจุงุดุฑุฉ ุฅูู /settings/users
// 3. ุงููุชูุฌุฉ: Redirect ุฅูู /dashboard
```

### ุงุฎุชุจุงุฑ 2: ุฅุบูุงู ุงูุตูุญุฉ ุนูุฏ ุณุญุจ ุงูุตูุงุญูุฉ

```typescript
// 1. ุชุณุฌูู ุฏุฎูู ููุณุชุฎุฏู ูู ุตูุญุฉ /invoices
// 2. ูู ุญุณุงุจ Admin: ุณุญุจ ุตูุงุญูุฉ invoices
// 3. ุงููุชูุฌุฉ:
//    - ุฅุบูุงู ุงูุตูุญุฉ ููุฑุงู
//    - Redirect ุฅูู /dashboard
//    - Toast: "ุชู ุชุญุฏูุซ ุตูุงุญูุงุชู..."
```

### ุงุฎุชุจุงุฑ 3: ุงูุชููู ุจูู ุงูุตูุญุงุช

```typescript
// 1. ุชุณุฌูู ุฏุฎูู ููุณุชุฎุฏู
// 2. ุงูุชููู ูู /dashboard ุฅูู /invoices
// 3. ุฅุฐุง ุบูุฑ ูุตุฑุญ: Redirect ููุฑุงู
// 4. ุฅุฐุง ูุตุฑุญ: ุงูุณูุงุญ ุจุงููุตูู
```

## ๐ ุงููุฑุงุฌุน

- `components/realtime-route-guard.tsx` - Route Guard
- `components/page-guard.tsx` - Page Guard
- `components/app-shell.tsx` - App Shell
- `lib/access-context.tsx` - Access Context
- `DYNAMIC_PERMISSION_UI_SYSTEM.md` - ุงููุธุงู ุงูุนุงู
