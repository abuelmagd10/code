<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØªÙ†Ø¸ÙŠÙ Service Worker ÙˆØ§Ù„ÙƒØ§Ø´</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2563eb;
      margin-bottom: 20px;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #1d4ed8;
    }
    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    .log {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 15px;
      margin-top: 20px;
      max-height: 400px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 14px;
    }
    .log-item {
      margin: 5px 0;
      padding: 5px;
    }
    .log-success {
      color: #10b981;
    }
    .log-error {
      color: #ef4444;
    }
    .log-info {
      color: #3b82f6;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
    }
    .status-success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #10b981;
    }
    .status-error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #ef4444;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”§ ØªÙ†Ø¸ÙŠÙ Service Worker ÙˆØ§Ù„ÙƒØ§Ø´</h1>
    <p>Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ø¥Ø²Ø§Ù„Ø© Service Worker Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆØªÙ†Ø¸ÙŠÙ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ Caches.</p>
    
    <div id="status"></div>
    
    <div>
      <button onclick="clearServiceWorkers()">Ø¥Ø²Ø§Ù„Ø© Service Workers</button>
      <button onclick="clearCaches()">ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù€ Caches</button>
      <button onclick="clearAll()">ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙƒÙ„</button>
      <button onclick="checkStatus()">ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø©</button>
    </div>
    
    <div id="log" class="log"></div>
  </div>

  <script>
    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const item = document.createElement('div');
      item.className = `log-item log-${type}`;
      item.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logDiv.appendChild(item);
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(message);
    }

    function setStatus(message, type = 'success') {
      const statusDiv = document.getElementById('status');
      statusDiv.className = `status status-${type}`;
      statusDiv.textContent = message;
    }

    async function clearServiceWorkers() {
      log('Ø¨Ø¯Ø¡ Ø¥Ø²Ø§Ù„Ø© Service Workers...', 'info');
      
      if (!('serviceWorker' in navigator)) {
        log('Service Workers ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­', 'error');
        setStatus('Service Workers ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©', 'error');
        return;
      }

      try {
        const registrations = await navigator.serviceWorker.getRegistrations();
        log(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${registrations.length} Service Worker(s)`, 'info');

        if (registrations.length === 0) {
          log('Ù„Ø§ ØªÙˆØ¬Ø¯ Service Workers Ù…Ø³Ø¬Ù„Ø©', 'info');
          setStatus('Ù„Ø§ ØªÙˆØ¬Ø¯ Service Workers Ù…Ø³Ø¬Ù„Ø©', 'success');
          return;
        }

        for (const registration of registrations) {
          const scriptURL = registration.active?.scriptURL || registration.installing?.scriptURL || 'unknown';
          log(`Ø¥Ø²Ø§Ù„Ø© Service Worker: ${scriptURL}`, 'info');
          
          const unregistered = await registration.unregister();
          if (unregistered) {
            log(`âœ… ØªÙ… Ø¥Ø²Ø§Ù„Ø© Service Worker Ø¨Ù†Ø¬Ø§Ø­: ${scriptURL}`, 'success');
          } else {
            log(`âš ï¸ ÙØ´Ù„ Ø¥Ø²Ø§Ù„Ø© Service Worker: ${scriptURL}`, 'error');
          }
        }

        setStatus(`ØªÙ… Ø¥Ø²Ø§Ù„Ø© ${registrations.length} Service Worker(s) Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        log('âœ… Ø§ÙƒØªÙ…Ù„Øª Ø¹Ù…Ù„ÙŠØ© Ø¥Ø²Ø§Ù„Ø© Service Workers', 'success');
      } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø²Ø§Ù„Ø© Service Workers: ${error.message}`, 'error');
        setStatus('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø²Ø§Ù„Ø© Service Workers', 'error');
      }
    }

    async function clearCaches() {
      log('Ø¨Ø¯Ø¡ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù€ Caches...', 'info');

      if (!('caches' in window)) {
        log('Cache API ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­', 'error');
        setStatus('Cache API ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©', 'error');
        return;
      }

      try {
        const cacheNames = await caches.keys();
        log(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${cacheNames.length} cache(s)`, 'info');

        if (cacheNames.length === 0) {
          log('Ù„Ø§ ØªÙˆØ¬Ø¯ caches', 'info');
          setStatus('Ù„Ø§ ØªÙˆØ¬Ø¯ caches', 'success');
          return;
        }

        let deletedCount = 0;
        for (const cacheName of cacheNames) {
          log(`Ø­Ø°Ù cache: ${cacheName}`, 'info');
          const deleted = await caches.delete(cacheName);
          if (deleted) {
            log(`âœ… ØªÙ… Ø­Ø°Ù cache: ${cacheName}`, 'success');
            deletedCount++;
          } else {
            log(`âš ï¸ ÙØ´Ù„ Ø­Ø°Ù cache: ${cacheName}`, 'error');
          }
        }

        setStatus(`ØªÙ… Ø­Ø°Ù ${deletedCount} cache(s) Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        log(`âœ… Ø§ÙƒØªÙ…Ù„Øª Ø¹Ù…Ù„ÙŠØ© ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù€ Caches (ØªÙ… Ø­Ø°Ù ${deletedCount}/${cacheNames.length})`, 'success');
      } catch (error) {
        log(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù€ Caches: ${error.message}`, 'error');
        setStatus('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù€ Caches', 'error');
      }
    }

    async function clearAll() {
      log('Ø¨Ø¯Ø¡ ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙƒÙ„...', 'info');
      await clearServiceWorkers();
      await new Promise(resolve => setTimeout(resolve, 500));
      await clearCaches();
      log('âœ… Ø§ÙƒØªÙ…Ù„ ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙƒÙ„ - ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©', 'success');
      setStatus('ØªÙ… Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø¨Ù†Ø¬Ø§Ø­ - ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©', 'success');
    }

    async function checkStatus() {
      log('ÙØ­Øµ Ø­Ø§Ù„Ø© Service Workers ÙˆØ§Ù„Ù€ Caches...', 'info');

      // ÙØ­Øµ Service Workers
      if ('serviceWorker' in navigator) {
        const registrations = await navigator.serviceWorker.getRegistrations();
        log(`Service Workers Ø§Ù„Ù…Ø³Ø¬Ù„Ø©: ${registrations.length}`, 'info');
        registrations.forEach((reg, index) => {
          const scriptURL = reg.active?.scriptURL || reg.installing?.scriptURL || 'unknown';
          const state = reg.active?.state || reg.installing?.state || 'unknown';
          log(`  ${index + 1}. ${scriptURL} (${state})`, 'info');
        });
      } else {
        log('Service Workers ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©', 'error');
      }

      // ÙØ­Øµ Caches
      if ('caches' in window) {
        const cacheNames = await caches.keys();
        log(`Ø§Ù„Ù€ Caches Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©: ${cacheNames.length}`, 'info');
        cacheNames.forEach((name, index) => {
          log(`  ${index + 1}. ${name}`, 'info');
        });
      } else {
        log('Cache API ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©', 'error');
      }

      setStatus('ØªÙ… ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø© - Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø³Ø¬Ù„ Ø£Ø¯Ù†Ø§Ù‡', 'success');
    }

    // ÙØ­Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('load', () => {
      log('ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„ØªÙ†Ø¸ÙŠÙ', 'info');
      checkStatus();
    });
  </script>
</body>
</html>

