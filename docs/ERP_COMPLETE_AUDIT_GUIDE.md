# ๐ ุฏููู ุงููุฑุงุฌุนุฉ ุงูุดุงููุฉ ููุธุงู ERP
## Comprehensive ERP Audit Guide

---

## ๐ ููุฑุณ ุงููุญุชููุงุช

1. [ุงูุฏูุฑุฉ ุงููุญุงุณุจูุฉ ุงููุงููุฉ](#1-ุงูุฏูุฑุฉ-ุงููุญุงุณุจูุฉ-ุงููุงููุฉ)
2. [Checklist ุงูุชูููุฐ ุงููุฏูู](#2-checklist-ุงูุชูููุฐ-ุงููุฏูู)
3. [ูุฑุงุฌุนุฉ ุงูุญูููุฉ ูุงูุตูุงุญูุงุช](#3-ูุฑุงุฌุนุฉ-ุงูุญูููุฉ-ูุงูุตูุงุญูุงุช)
4. [ูุฑุงุฌุนุฉ ุงูุตูุญุงุช ูุงูููุทู](#4-ูุฑุงุฌุนุฉ-ุงูุตูุญุงุช-ูุงูููุทู)
5. [ูููุฐุฌ ุงูุชูุฑูุฑ ุงูููุงุฆู](#5-ูููุฐุฌ-ุงูุชูุฑูุฑ-ุงูููุงุฆู)

---

# 1. ุงูุฏูุฑุฉ ุงููุญุงุณุจูุฉ ุงููุงููุฉ

## ๐ ุฏูุฑุฉ ุงููุดุชุฑูุงุช (Purchase Cycle)

### ุงูุฎุทูุฉ 1: ุฃูุฑ ุงูุดุฑุงุก (Purchase Order)

| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุงูุฌุฏุงูู ุงููุชุฃุซุฑุฉ** | `purchase_orders`, `purchase_order_items` |
| **ุงูุญุงูุฉ ุงูุฃูููุฉ** | `draft` |
| **ุงูุชุฃุซูุฑ ุนูู ุงููุฎุฒูู** | โ ูุง ููุฌุฏ |
| **ุงูุชุฃุซูุฑ ุงููุญุงุณุจู** | โ ูุง ููุฌุฏ |
| **ุงูุตูุญุงุช ุงููุชุฃุซุฑุฉ** | `/purchase-orders`, `/purchase-orders/new` |

**ูุง ูุฌุจ ุงูุชุญูู ููู:**
- [ ] ุฅูุดุงุก ุฃูุฑ ุงูุดุฑุงุก ุจูุฌุงุญ
- [ ] ุธููุฑู ูู ูุงุฆูุฉ ุฃูุงูุฑ ุงูุดุฑุงุก
- [ ] ุญุงูุชู = `draft`
- [ ] ูุง ุชุบููุฑ ูู ุงููุฎุฒูู
- [ ] ูุง ูููุฏ ูุญุงุณุจูุฉ

---

### ุงูุฎุทูุฉ 2: ูุงุชูุฑุฉ ุงูุดุฑุงุก (Bill/Purchase Invoice)

| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุงูุฌุฏุงูู ุงููุชุฃุซุฑุฉ** | `bills`, `bill_items` |
| **ุงูุญุงูุงุช ุงููุชุงุญุฉ** | `draft` โ `sent/received` โ `paid` |
| **ุฑุจุท ุจุฃูุฑ ุงูุดุฑุงุก** | `purchase_order_id` ูู `bills` |

**ุนูุฏ ุงูุญุงูุฉ `draft`:**
| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุงูุชุฃุซูุฑ ุนูู ุงููุฎุฒูู** | โ ูุง ููุฌุฏ |
| **ุงูุชุฃุซูุฑ ุงููุญุงุณุจู** | โ ูุง ููุฌุฏ |

**ุนูุฏ ุชุบููุฑ ุงูุญุงูุฉ ุฅูู `sent/received`:**
| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุงูุชุฃุซูุฑ ุนูู ุงููุฎุฒูู** | โ ุฒูุงุฏุฉ `products.quantity_on_hand` |
| **ุงูุชุฃุซูุฑ ุงููุญุงุณุจู** | โ ูุง ูููุฏ (ุงูููุท ุงูููุฏู) |
| **ุงูุฌุฏุงูู ุงููุชุฃุซุฑุฉ** | `products`, `inventory_transactions` |

**ูุง ูุฌุจ ุงูุชุญูู ููู ุนูุฏ `sent`:**
- [ ] ุฒูุงุฏุฉ ูููุฉ ุงูููุชุฌ ูู `products.quantity_on_hand`
- [ ] ุฅูุดุงุก ุณุฌู ูู `inventory_transactions` ููุน `purchase_in`
- [ ] ูุง ููุฌุฏ ููุฏ ูู `journal_entries`
- [ ] ุชุญุฏูุซ ุญุงูุฉ ุฃูุฑ ุงูุดุฑุงุก ุงููุฑุชุจุท

**ุนูุฏ ุชุบููุฑ ุงูุญุงูุฉ ุฅูู `paid`:**
| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุงูููุฏ ุงููุญุงุณุจู** | Dr: ุงููุฎุฒูู + ุถุฑูุจุฉ ุงููุฏุฎูุงุช / Cr: ุงูุฐูู ุงูุฏุงุฆูุฉ |
| **ุงูุฌุฏุงูู ุงููุชุฃุซุฑุฉ** | `journal_entries`, `journal_entry_lines` |

```
ุงูููุฏ ุงููุญุงุณุจู:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงููุฎุฒูู (ุฃุตู)           XXX   |
ุถุฑูุจุฉ ุงููุฏุฎูุงุช (ุฅู ูุฌุฏุช) XXX   |
                              | ุงูุฐูู ุงูุฏุงุฆูุฉ (ููุฑุฏูู) XXX
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### ุงูุฎุทูุฉ 3: ูุฑุชุฌุนุงุช ุงููุดุชุฑูุงุช (Purchase Returns)

| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุงูุฌุฏุงูู ุงููุชุฃุซุฑุฉ** | `purchase_returns`, `purchase_return_items`, `products`, `inventory_transactions` |
| **ุงูุชุฃุซูุฑ ุนูู ุงููุฎุฒูู** | โ ุชูููู `products.quantity_on_hand` |
| **ุงูุตูุญุงุช** | `/purchase-returns`, `/purchase-returns/new` |

**ุงูููุฏ ุงููุญุงุณุจู (ุฅุฐุง ูุงูุช ุงููุงุชูุฑุฉ ูุฏููุนุฉ):**
```
ุงูููุฏ ุงููุญุงุณุจู:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูุฐูู ุงูุฏุงุฆูุฉ           XXX   |
                              | ุงููุฎุฒูู XXX
                              | ุถุฑูุจุฉ ุงููุฏุฎูุงุช XXX (ุฅู ูุฌุฏุช)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุฏูุฑุฉ ุงููุจูุนุงุช (Sales Cycle)

### ุงูุฎุทูุฉ 4: ุฃูุฑ ุงูุจูุน (Sales Order)

| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุงูุฌุฏุงูู ุงููุชุฃุซุฑุฉ** | `sales_orders`, `sales_order_items` |
| **ุงูุญุงูุฉ ุงูุฃูููุฉ** | `draft` |
| **ุงูุชุฃุซูุฑ ุนูู ุงููุฎุฒูู** | โ ูุง ููุฌุฏ |
| **ุงูุชุฃุซูุฑ ุงููุญุงุณุจู** | โ ูุง ููุฌุฏ |
| **ุงูุตูุญุงุช** | `/sales-orders`, `/sales-orders/new` |

**ูุง ูุฌุจ ุงูุชุญูู ููู:**
- [ ] ุฅูุดุงุก ุฃูุฑ ุงูุจูุน ุจูุฌุงุญ
- [ ] ุธููุฑู ูู ูุงุฆูุฉ ุฃูุงูุฑ ุงูุจูุน
- [ ] ุญุงูุชู = `draft`
- [ ] ูุง ุชุบููุฑ ูู ุงููุฎุฒูู

---

### ุงูุฎุทูุฉ 5: ูุงุชูุฑุฉ ุงูุจูุน (Sales Invoice)

| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุงูุฌุฏุงูู ุงููุชุฃุซุฑุฉ** | `invoices`, `invoice_items` |
| **ุงูุญุงูุงุช ุงููุชุงุญุฉ** | `draft` โ `sent` โ `paid`/`partially_paid` |
| **ุฑุจุท ุจุฃูุฑ ุงูุจูุน** | `sales_order_id` ูู `invoices` |

**ุนูุฏ ุงูุญุงูุฉ `draft`:**
| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุงูุชุฃุซูุฑ ุนูู ุงููุฎุฒูู** | โ ูุง ููุฌุฏ |
| **ุงูุชุฃุซูุฑ ุงููุญุงุณุจู** | โ ูุง ููุฌุฏ |

---

### ุงูุฎุทูุฉ 6: ุชุญุฏูุฏ ููุฑุณูุฉ (Mark as Sent)

| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุงูุญุงูุฉ ุงูุฌุฏูุฏุฉ** | `sent` |
| **ุงูุชุฃุซูุฑ ุนูู ุงููุฎุฒูู** | โ ุฎุตู `products.quantity_on_hand` |
| **ุจุถุงุนุฉ ูุฏู ุงูุบูุฑ** | โ ุฅุถุงูุฉ ุณุฌู ูู `third_party_inventory` |
| **ุงูุชุฃุซูุฑ ุงููุญุงุณุจู** | โ ูุง ูููุฏ (ุงูููุท ุงูููุฏู) |

**ุงูุฌุฏุงูู ุงููุชุฃุซุฑุฉ:**
- `invoices` - ุชุญุฏูุซ `status = 'sent'`
- `products` - ุชูููู `quantity_on_hand`
- `inventory_transactions` - ุฅูุดุงุก ุณุฌู `sale_out`
- `third_party_inventory` - ุฅูุดุงุก ุณุฌู ููุจุถุงุนุฉ ุงููุฑุณูุฉ

**ูุง ูุฌุจ ุงูุชุญูู ููู:**
- [ ] ุญุงูุฉ ุงููุงุชูุฑุฉ = `sent`
- [ ] ุชูููู ูููุฉ ุงูููุชุฌ ูู `products.quantity_on_hand`
- [ ] ุฅูุดุงุก ุณุฌู ูู `inventory_transactions` ููุน `sale_out`
- [ ] ุฅูุดุงุก ุณุฌู ูู `third_party_inventory`
- [ ] ุธููุฑ ุงูุจุถุงุนุฉ ูู ุตูุญุฉ "ุจุถุงุนุฉ ูุฏู ุงูุบูุฑ"
- [ ] **โ ูุง ููุฌุฏ ููุฏ ูุญุงุณุจู** (ุงูููุท ุงูููุฏู)
- [ ] ุชุญุฏูุซ ุญุงูุฉ ุฃูุฑ ุงูุจูุน ุงููุฑุชุจุท ุฅูู `invoiced`

---

### ุงูุฎุทูุฉ 7: ุจุถุงุนุฉ ูุฏู ุงูุบูุฑ (Goods in Transit)

| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุงูุฌุฏูู** | `third_party_inventory` |
| **ุงูุญููู ุงูุฑุฆูุณูุฉ** | `invoice_id`, `product_id`, `quantity`, `cleared_quantity`, `returned_quantity` |
| **ุงูุตูุญุฉ** | `/inventory/third-party` |

**ุงูุญุณุงุจุงุช:**
```
ุงููููุฉ ุงููุชุงุญุฉ = quantity - cleared_quantity - returned_quantity
```

**ูุง ูุฌุจ ุงูุชุญูู ููู:**
- [ ] ุธููุฑ ุฌููุน ุงูููุงุชูุฑ ุงููุฑุณูุฉ
- [ ] ุงููููุงุช ุตุญูุญุฉ
- [ ] ุงููููุฉ = ุงูุณุนุฑ ร ุงููููุฉ ุงููุชุงุญุฉ
- [ ] ุงูุญุงูุฉ ุชุชุทุงุจู ูุน ุญุงูุฉ ุงููุงุชูุฑุฉ

---

### ุงูุฎุทูุฉ 8: ูุฑุชุฌุนุงุช ุงููุจูุนุงุช (Sales Returns)

#### 8.1 ูุฑุชุฌุน ุฌุฒุฆู (Partial Return)

| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุงูุฌุฏุงูู ุงููุชุฃุซุฑุฉ** | `sales_returns`, `sales_return_items`, `invoice_items`, `third_party_inventory` |
| **ุญุงูุฉ ุงููุงุชูุฑุฉ** | `partially_returned` (ุฅุฐุง ูุงูุช `sent`) |
| **ุงูุชุฃุซูุฑ ุนูู ุงููุฎุฒูู** | โ ุฒูุงุฏุฉ `products.quantity_on_hand` (ุฅุฐุง ูุฑุชุฌุน ูููุฎุฒู) |

**ุชุญุฏูุซุงุช ุงูุฌุฏุงูู:**
```sql
-- invoice_items
UPDATE invoice_items SET returned_quantity = returned_quantity + X

-- third_party_inventory
UPDATE third_party_inventory SET returned_quantity = returned_quantity + X

-- invoices
UPDATE invoices SET 
  returned_amount = returned_amount + X,
  return_status = 'partial',
  status = CASE 
    WHEN returned_amount >= original_total THEN 'fully_returned'
    ELSE 'partially_returned' -- ุฃู ุชุจูู sent/paid ุญุณุจ ุงูููุทู
  END,
  total_amount = original_total - returned_amount
```

**ูุง ูุฌุจ ุงูุชุญูู ููู:**
- [ ] ุชุญุฏูุซ `invoice_items.returned_quantity`
- [ ] ุชุญุฏูุซ `third_party_inventory.returned_quantity`
- [ ] ุชุญุฏูุซ `invoices.returned_amount`
- [ ] `invoices.return_status = 'partial'`
- [ ] ุญุงูุฉ ุงููุงุชูุฑุฉ ุงูุตุญูุญุฉ (`sent`/`partially_paid` ูุน badge ูุฑุชุฌุน ุฌุฒุฆู)
- [ ] ุฒูุงุฏุฉ ุงููุฎุฒูู (ุฅุฐุง ูุฑุชุฌุน ูููุฎุฒู)
- [ ] ุชุญุฏูุซ ุตูุญุฉ "ุจุถุงุนุฉ ูุฏู ุงูุบูุฑ"

#### 8.2 ูุฑุชุฌุน ูุงูู (Full Return)

| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุญุงูุฉ ุงููุงุชูุฑุฉ** | `fully_returned` |
| **ุงูุชุฃุซูุฑ** | ููุณ ุงููุฑุชุฌุน ุงูุฌุฒุฆู + ุงููุงุชูุฑุฉ ุชุฎุชูู ูู "ุจุถุงุนุฉ ูุฏู ุงูุบูุฑ" |

---

### ุงูุฎุทูุฉ 9: ูุจุถ ุงููุฏููุนุงุช (Payments)

#### 9.1 ุฏูุนุฉ ุฌุฒุฆูุฉ (Partial Payment)

| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุงูุฌุฏุงูู ุงููุชุฃุซุฑุฉ** | `payments`, `invoices`, `journal_entries`, `journal_entry_lines` |
| **ุญุงูุฉ ุงููุงุชูุฑุฉ** | `partially_paid` |

**ุงูููุฏ ุงููุญุงุณุจู ุนูุฏ ุงูุฏูุน ุงูุฃูู:**
```
ููุฏ ุงููุงุชูุฑุฉ (AR/Revenue) - ุฅุฐุง ูู ููู ููุฌูุฏุงู:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูุฐูู ุงููุฏููุฉ            XXX   |
                              | ุฅูุฑุงุฏุงุช ุงููุจูุนุงุช XXX
                              | ุถุฑูุจุฉ ุงููุฎุฑุฌุงุช XXX (ุฅู ูุฌุฏุช)
                              | ุฅูุฑุงุฏ ุงูุดุญู XXX (ุฅู ูุฌุฏ)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ููุฏ ุงูุฏูุน:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูููุฏูุฉ / ุงูุจูู          XXX   |
                              | ุงูุฐูู ุงููุฏููุฉ XXX
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ูุง ูุฌุจ ุงูุชุญูู ููู:**
- [ ] ุฅูุดุงุก ุณุฌู ูู `payments`
- [ ] ุชุญุฏูุซ `invoices.paid_amount`
- [ ] ุญุงูุฉ ุงููุงุชูุฑุฉ = `partially_paid`
- [ ] ุฅูุดุงุก ููุฏ ุงููุงุชูุฑุฉ (AR/Revenue) ุนูุฏ ุงูุฏูุน ุงูุฃูู
- [ ] ุฅูุดุงุก ููุฏ ุงูุฏูุน (Cash/AR)

#### 9.2 ุฏูุนุฉ ูุงููุฉ (Full Payment)

| ุงูุนูุตุฑ | ุงูุชูุงุตูู |
|--------|----------|
| **ุญุงูุฉ ุงููุงุชูุฑุฉ** | `paid` |
| **ุงููููุฏ** | ููุณ ุงูุฏูุนุฉ ุงูุฌุฒุฆูุฉ |

---

## ๐ ููุฎุต ุงููููุฏ ุงููุญุงุณุจูุฉ

### ููุงุชูุฑ ุงููุจูุนุงุช

| ุงูุญุฏุซ | ุงูููุฏ |
|-------|-------|
| `sent` | โ ูุง ููุฏ |
| `partially_paid` / `paid` | Dr: ุงูุฐูู ุงููุฏููุฉ / Cr: ุงูุฅูุฑุงุฏุงุช + ุงูุถุฑูุจุฉ |
| ุงูุฏูุน | Dr: ุงูููุฏูุฉ / Cr: ุงูุฐูู ุงููุฏููุฉ |
| ุงููุฑุชุฌุน | Dr: ูุฑุฏูุฏุงุช ุงููุจูุนุงุช / Cr: ุงูุฐูู ุงููุฏููุฉ (ุฃู ุฑุตูุฏ ุฏุงุฆู ููุนููู) |

### ููุงุชูุฑ ุงููุดุชุฑูุงุช

| ุงูุญุฏุซ | ุงูููุฏ |
|-------|-------|
| `sent/received` | โ ูุง ููุฏ |
| `paid` | Dr: ุงููุฎุฒูู + ุถุฑูุจุฉ ุงููุฏุฎูุงุช / Cr: ุงูุฐูู ุงูุฏุงุฆูุฉ |
| ุงูุฏูุน | Dr: ุงูุฐูู ุงูุฏุงุฆูุฉ / Cr: ุงูููุฏูุฉ |
| ุงููุฑุชุฌุน | Dr: ุงูุฐูู ุงูุฏุงุฆูุฉ / Cr: ุงููุฎุฒูู |

---

# 2. Checklist ุงูุชูููุฐ ุงููุฏูู

## ๐ ุงูุงุฎุชุจุงุฑ ุงูุดุงูู

### ุงููุฑุญูุฉ 1: ุฅุนุฏุงุฏ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ

```
โก 1.1 ุฅูุดุงุก ููุชุฌ ุฌุฏูุฏ
    - ุงูุงุณู: "ููุชุฌ ุงุฎุชุจุงุฑ"
    - SKU: "TEST-001"
    - ุณุนุฑ ุงูุดุฑุงุก: 50
    - ุณุนุฑ ุงูุจูุน: 100
    - ุงููููุฉ ุงูุฃูููุฉ: 0
    
    โ ุงูุชุญูู:
    - [ ] ุงูููุชุฌ ุธุงูุฑ ูู ูุงุฆูุฉ ุงูููุชุฌุงุช
    - [ ] quantity_on_hand = 0
```

### ุงููุฑุญูุฉ 2: ุฏูุฑุฉ ุงูุดุฑุงุก

```
โก 2.1 ุฅูุดุงุก ุฃูุฑ ุดุฑุงุก
    - ุงูููุฑุฏ: [ุงุฎุชุฑ ููุฑุฏ]
    - ุงูููุชุฌ: ููุชุฌ ุงุฎุชุจุงุฑ
    - ุงููููุฉ: 100
    - ุงูุณุนุฑ: 50
    
    โ ุงูุชุญูู:
    - [ ] ุฃูุฑ ุงูุดุฑุงุก ุธุงูุฑ ูู ุงููุงุฆูุฉ
    - [ ] ุงูุญุงูุฉ = draft
    - [ ] ุงููุฎุฒูู = 0 (ูู ูุชุบูุฑ)

โก 2.2 ุชุญููู ุฃูุฑ ุงูุดุฑุงุก ุฅูู ูุงุชูุฑุฉ ูุดุชุฑูุงุช
    
    โ ุงูุชุญูู:
    - [ ] ูุงุชูุฑุฉ ุงููุดุชุฑูุงุช ูุฑุชุจุทุฉ ุจุฃูุฑ ุงูุดุฑุงุก
    - [ ] ุงูุญุงูุฉ = draft
    - [ ] ุงููุฎุฒูู = 0 (ูู ูุชุบูุฑ)

โก 2.3 ุชุญุฏูุฏ ุงููุงุชูุฑุฉ ููุณุชููุฉ (sent/received)
    
    โ ุงูุชุญูู:
    - [ ] ุงูุญุงูุฉ = sent
    - [ ] ุงููุฎุฒูู = 100 โ
    - [ ] ุธููุฑ ุณุฌู ูู inventory_transactions
    - [ ] ูุง ููุฌุฏ ููุฏ ูุญุงุณุจู

โก 2.4 ุฏูุน ุงููุงุชูุฑุฉ (paid)
    
    โ ุงูุชุญูู:
    - [ ] ุงูุญุงูุฉ = paid
    - [ ] ุฅูุดุงุก ููุฏ: Dr ุงููุฎุฒูู / Cr ุงูุฐูู ุงูุฏุงุฆูุฉ
    - [ ] ุธููุฑ ุงูููุฏ ูู journal_entries
```

### ุงููุฑุญูุฉ 3: ุฏูุฑุฉ ุงููุจูุนุงุช

```
โก 3.1 ุฅูุดุงุก ุฃูุฑ ุจูุน
    - ุงูุนููู: [ุงุฎุชุฑ ุนููู]
    - ุงูููุชุฌ: ููุชุฌ ุงุฎุชุจุงุฑ
    - ุงููููุฉ: 50
    - ุงูุณุนุฑ: 100
    
    โ ุงูุชุญูู:
    - [ ] ุฃูุฑ ุงูุจูุน ุธุงูุฑ ูู ุงููุงุฆูุฉ
    - [ ] ุงูุญุงูุฉ = draft
    - [ ] ุงููุฎุฒูู = 100 (ูู ูุชุบูุฑ)

โก 3.2 ุชุญููู ุฃูุฑ ุงูุจูุน ุฅูู ูุงุชูุฑุฉ ูุจูุนุงุช
    
    โ ุงูุชุญูู:
    - [ ] ุงููุงุชูุฑุฉ ูุฑุชุจุทุฉ ุจุฃูุฑ ุงูุจูุน
    - [ ] ุญุงูุฉ ุฃูุฑ ุงูุจูุน = invoiced
    - [ ] ุงูุญุงูุฉ = draft
    - [ ] ุงููุฎุฒูู = 100 (ูู ูุชุบูุฑ)

โก 3.3 ุชุญุฏูุฏ ุงููุงุชูุฑุฉ ููุฑุณูุฉ (sent)
    - ุงุฎุชูุงุฑ ุดุฑูุฉ ุงูุดุญู
    
    โ ุงูุชุญูู:
    - [ ] ุงูุญุงูุฉ = sent
    - [ ] ุงููุฎุฒูู = 50 โ (ุชู ุงูุฎุตู)
    - [ ] ุธููุฑ ุณุฌู ูู inventory_transactions ููุน sale_out
    - [ ] ุธููุฑ ุณุฌู ูู third_party_inventory
    - [ ] ุธููุฑ ุงูุจุถุงุนุฉ ูู ุตูุญุฉ "ุจุถุงุนุฉ ูุฏู ุงูุบูุฑ"
    - [ ] โ ูุง ููุฌุฏ ููุฏ ูุญุงุณุจู

โก 3.4 ุนูู ูุฑุชุฌุน ุฌุฒุฆู (25 ูุญุฏุฉ)
    
    โ ุงูุชุญูู:
    - [ ] invoice_items.returned_quantity = 25
    - [ ] third_party_inventory.returned_quantity = 25
    - [ ] invoices.returned_amount = 2500 (25 ร 100)
    - [ ] invoices.return_status = 'partial'
    - [ ] ุงูุญุงูุฉ = sent + badge ูุฑุชุฌุน ุฌุฒุฆู
    - [ ] ุตูุญุฉ ุฃูุงูุฑ ุงูุจูุน: ุงููุฌููุน 5000 | ูุฑุชุฌุน -2500 | ูุชุจูู 2500
    - [ ] ุตูุญุฉ ุจุถุงุนุฉ ูุฏู ุงูุบูุฑ: ุงููููุฉ = 25 (50 - 25)

โก 3.5 ุชุณุฌูู ุฏูุนุฉ ุฌุฒุฆูุฉ (1000)
    
    โ ุงูุชุญูู:
    - [ ] ุฅูุดุงุก ุณุฌู ูู payments
    - [ ] invoices.paid_amount = 1000
    - [ ] ุงูุญุงูุฉ = partially_paid
    - [ ] ุฅูุดุงุก ููุฏ ุงููุงุชูุฑุฉ: Dr ุงูุฐูู ุงููุฏููุฉ 2500 / Cr ุงูุฅูุฑุงุฏุงุช 2500
    - [ ] ุฅูุดุงุก ููุฏ ุงูุฏูุน: Dr ุงูููุฏูุฉ 1000 / Cr ุงูุฐูู ุงููุฏููุฉ 1000

โก 3.6 ุชุณุฌูู ุฏูุนุฉ ูุฅููุงู ุงูุณุฏุงุฏ (1500)
    
    โ ุงูุชุญูู:
    - [ ] invoices.paid_amount = 2500
    - [ ] ุงูุญุงูุฉ = paid
    - [ ] ุฅูุดุงุก ููุฏ ุงูุฏูุน: Dr ุงูููุฏูุฉ 1500 / Cr ุงูุฐูู ุงููุฏููุฉ 1500
```

### ุงููุฑุญูุฉ 4: ุงูุชุญูู ูู ุงูุชูุงุฑูุฑ

```
โก 4.1 ุชูุฑูุฑ ุงููุฎุฒูู
    โ ุงูุชุญูู:
    - [ ] ุงูููุชุฌ ูุธูุฑ ุจุงููููุฉ ุงูุตุญูุญุฉ (75 = 100 - 50 + 25)
    - [ ] ุงููููุฉ ุตุญูุญุฉ

โก 4.2 ุชูุฑูุฑ ุงูุฐูู ุงููุฏููุฉ
    โ ุงูุชุญูู:
    - [ ] ุงูุนููู ุฑุตูุฏู = 0 (ุชู ุงูุณุฏุงุฏ ุงููุงูู)

โก 4.3 ุชูุฑูุฑ ุงูุฐูู ุงูุฏุงุฆูุฉ
    โ ุงูุชุญูู:
    - [ ] ุงูููุฑุฏ ุฑุตูุฏู = 0 (ุชู ุงูุณุฏุงุฏ ุงููุงูู)

โก 4.4 ุชูุฑูุฑ ุงููุจูุนุงุช
    โ ุงูุชุญูู:
    - [ ] ุตุงูู ุงููุจูุนุงุช = 2500 (5000 - 2500 ูุฑุชุฌุน)

โก 4.5 ููุฒุงู ุงููุฑุงุฌุนุฉ
    โ ุงูุชุญูู:
    - [ ] ูุฌููุน ุงููุฏูู = ูุฌููุน ุงูุฏุงุฆู
```

---

# 3. ูุฑุงุฌุนุฉ ุงูุญูููุฉ ูุงูุตูุงุญูุงุช

## ๐ฅ ุฃุฏูุงุฑ ุงููุณุชุฎุฏููู

| ุงูุฏูุฑ | ุงูุฑูุฒ | ูุณุชูู ุงููุตูู |
|-------|-------|--------------|
| ุงููุงูู | `owner` | ูู ุดูุก |
| ุงููุฏูุฑ ุงูุนุงู | `admin` | ูู ุดูุก |
| ูุฏูุฑ ุงููุฑุน | `manager` | ุงููุฑุน ุงููุญุฏุฏ ููุท |
| ุงููุญุงุณุจ | `accountant` | ุงููุฑุน ุงููุญุฏุฏ + ุงููููุฏ |
| ุงููุดุฑู | `supervisor` | ุงููุฑุน ุงููุญุฏุฏ |
| ุงูููุธู | `staff` / `sales` | ูุง ุฃูุดุฃู ููุท |

## ๐ ููู ุงูุตูุงุญูุงุช ุงูุฑุฆูุณู

**ุงููุณุงุฑ:** `lib/data-visibility-control-fixed.ts`

```typescript
// Owner/Admin - ูุตูู ูุงูู
if (role === 'owner' || role === 'admin') {
  return true // ูู ุงูุจูุงูุงุช
}

// Manager - ูุตูู ุนูู ูุณุชูู ุงููุฑุน
if (role === 'manager') {
  // ููุท ุจูุงูุงุช ุงููุฑุน ุงููุญุฏุฏ
  query = query.eq('branch_id', member.branch_id)
}

// Accountant - ูุตูู ุนูู ูุณุชูู ุงููุฑุน ูุน ุงููููุฏ
if (role === 'accountant') {
  // ููุท ุจูุงูุงุช ุงููุฑุน + ุงููููุฏ ุงููุญุงุณุจูุฉ
}

// Staff - ูุตูู ูุญุฏูุฏ
// ููุท ูุง ุฃูุดุฃู ุงููุณุชุฎุฏู
query = query.eq('created_by_user_id', userId)
```

## ๐ Checklist ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช

### ุงุฎุชุจุงุฑ ุงููุงูู (Owner)

```
โก ูุฑู ุฌููุน ุงูููุงุชูุฑ ูู ูู ุงููุฑูุน
โก ูุฑู ุฌููุน ุฃูุงูุฑ ุงูุจูุน ูู ูู ุงููุฑูุน
โก ูุฑู ุฌููุน ุงููููุฏ ุงููุญุงุณุจูุฉ
โก ููููู ุชุนุฏูู ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ
โก ููููู ุฅุถุงูุฉ/ุญุฐู ูุณุชุฎุฏููู
```

### ุงุฎุชุจุงุฑ ูุฏูุฑ ุงููุฑุน (Manager)

```
โก ูุฑู ููุท ููุงุชูุฑ ูุฑุนู
โก ูุฑู ููุท ุฃูุงูุฑ ุงูุจูุน ูู ูุฑุนู
โก ูุง ูุฑู ุจูุงูุงุช ุงููุฑูุน ุงูุฃุฎุฑู
โก ูุง ููููู ุชุนุฏูู ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ
โก ููููู ุฅุฏุงุฑุฉ ููุธูู ูุฑุนู
```

### ุงุฎุชุจุงุฑ ุงููุญุงุณุจ (Accountant)

```
โก ูุฑู ููุงุชูุฑ ูุฑุนู
โก ูุฑู ุงููููุฏ ุงููุญุงุณุจูุฉ
โก ููููู ุชุณุฌูู ุงูุฏูุนุงุช
โก ูุง ููููู ุญุฐู ุงูููุงุชูุฑ ุงููุฏููุนุฉ
โก ููููู ุนุฑุถ ุงูุชูุงุฑูุฑ ุงููุงููุฉ
```

### ุงุฎุชุจุงุฑ ุงูููุธู (Staff)

```
โก ูุฑู ููุท ูุง ุฃูุดุฃู
โก ูุง ูุฑู ุจูุงูุงุช ุงูููุธููู ุงูุขุฎุฑูู
โก ููููู ุฅูุดุงุก ุฃูุงูุฑ ุจูุน ุฌุฏูุฏุฉ
โก ูุง ููููู ุชุนุฏูู ููุงุชูุฑ ุงูุขุฎุฑูู
โก ูุง ูุฑู ุงููููุฏ ุงููุญุงุณุจูุฉ
```

---

# 4. ูุฑุงุฌุนุฉ ุงูุตูุญุงุช ูุงูููุทู

## ๐ ุตูุญุฉ ุงูููุงุชูุฑ `/invoices`

### โ ูุง ูุฌุจ ุงูุชุญูู ููู:

| ุงูุนูุตุฑ | ุงููุชููุน | ุงูุชุญูู |
|--------|---------|--------|
| ุนุฑุถ ุงูุญุงูุฉ | badge ุฑุฆูุณู + badge ูุฑุชุฌุน (ุฅู ูุฌุฏ) | [ ] |
| ุงููุฌููุน | `original_total` | [ ] |
| ุงููุชุจูู | `total_amount - paid_amount` | [ ] |
| ุงููุฑุชุฌุน | `returned_amount` | [ ] |
| ุงูุฅุฌูุงููุงุช | ุตุญูุญุฉ ููุญุณูุจุฉ | [ ] |

### โ ุฃุณุฆูุฉ ุงูุชุญูู:

1. ูู ุงูููุงุชูุฑ ุงููุฑุณูุฉ ุชุธูุฑ ุจุดูู ุตุญูุญุ
2. ูู ุญุงูุฉ "ูุฑุชุฌุน ุฌุฒุฆู" ุชุธูุฑ ูู badge ูููุตูุ
3. ูู ุงููุจุงูุบ ุตุญูุญุฉ ุจุนุฏ ุงููุฑุชุฌุนุ

---

## ๐ ุตูุญุฉ ุจุถุงุนุฉ ูุฏู ุงูุบูุฑ `/inventory/third-party`

### โ ูุง ูุฌุจ ุงูุชุญูู ููู:

| ุงูุนูุตุฑ | ุงููุชููุน | ุงูุชุญูู |
|--------|---------|--------|
| ุงูููุงุชูุฑ ุงููุนุฑูุถุฉ | `sent`, `partially_returned`, `partially_paid` | [ ] |
| ุงููููุฉ | `quantity - cleared_quantity - returned_quantity` | [ ] |
| ุงููููุฉ | `unit_price ร ุงููููุฉ ุงููุชุงุญุฉ` | [ ] |
| ุงูุฅุฌูุงููุงุช | ุตุญูุญุฉ | [ ] |

### โ ุฃุณุฆูุฉ ุงูุชุญูู:

1. ูู ุชุฎุชูู ุงูุจุถุงุนุฉ ุจุนุฏ ุงููุฑุชุฌุน ุงููุงููุ
2. ูู ุชุชุญุฏุซ ุงููููุฉ ุจุนุฏ ุงููุฑุชุฌุน ุงูุฌุฒุฆูุ
3. ูู ุฒุฑ "ุนุฑุถ" ููุฌู ููุตูุญุฉ ุงูุตุญูุญุฉุ

---

## ๐ ุตูุญุฉ ุฃูุงูุฑ ุงูุจูุน `/sales-orders`

### โ ูุง ูุฌุจ ุงูุชุญูู ููู:

| ุงูุนูุตุฑ | ุงููุชููุน | ุงูุชุญูู |
|--------|---------|--------|
| ุงููุฌููุน | `original_total` | [ ] |
| ุงููุฑุชุฌุน | `-returned_amount` | [ ] |
| ุงููุชุจูู | `original - paid - returned` | [ ] |
| ุงูุญุงูุฉ | ุงูุญุงูุฉ ุงูุฃุณุงุณูุฉ + ุญุงูุฉ ุงููุงุชูุฑุฉ + ุญุงูุฉ ุงููุฑุชุฌุน | [ ] |
| ุงูุฅุฌูุงููุงุช | ุงููุชุจูู ููุชุญุตูู | [ ] |

---

## ๐ ุตูุญุฉ ุงููุฑุชุฌุนุงุช `/sales-returns`

### โ ูุง ูุฌุจ ุงูุชุญูู ููู:

| ุงูุนูุตุฑ | ุงููุชููุน | ุงูุชุญูู |
|--------|---------|--------|
| ูุงุฆูุฉ ุงููุฑุชุฌุนุงุช | ูู ุงููุฑุชุฌุนุงุช ูุน ุชูุงุตูููุง | [ ] |
| ุงููููุฉ | ุตุญูุญุฉ | [ ] |
| ุงูุฑุจุท ุจุงููุงุชูุฑุฉ | ุงููุงุชูุฑุฉ ุงูุฃุตููุฉ | [ ] |

---

# 5. ูููุฐุฌ ุงูุชูุฑูุฑ ุงูููุงุฆู

## ๐ ุชูุฑูุฑ ุงููุฑุงุฌุนุฉ ุงูุดุงููุฉ

### ูุนูููุงุช ุงููุฑุงุฌุนุฉ

| ุงูุนูุตุฑ | ุงููููุฉ |
|--------|--------|
| **ุชุงุฑูุฎ ุงููุฑุงุฌุนุฉ** | ____/____/______ |
| **ุงุณู ุงููุฑุงุฌุน** | ________________ |
| **ุฅุตุฏุงุฑ ุงููุธุงู** | ________________ |

---

### 1. ููุฎุต ุงููุชุงุฆุฌ

| ุงููุฌุงู | ุงูุญุงูุฉ | ุงูููุงุญุธุงุช |
|--------|--------|-----------|
| ุฏูุฑุฉ ุงููุดุชุฑูุงุช | โฌ โ โ | |
| ุฏูุฑุฉ ุงููุจูุนุงุช | โฌ โ โ | |
| ุงููุฎุฒูู | โฌ โ โ | |
| ุงููููุฏ ุงููุญุงุณุจูุฉ | โฌ โ โ | |
| ุจุถุงุนุฉ ูุฏู ุงูุบูุฑ | โฌ โ โ | |
| ุงููุฑุชุฌุนุงุช | โฌ โ โ | |
| ุงููุฏููุนุงุช | โฌ โ โ | |
| ุงูุตูุงุญูุงุช | โฌ โ โ | |
| ุงูุชูุงุฑูุฑ | โฌ โ โ | |

---

### 2. ุงูุฃุฎุทุงุก ุงูููุชุดูุฉ

| # | ุงูุฎุทุฃ | ุงูุฎุทูุฑุฉ | ุงูุตูุญุฉ | ุงููุตู |
|---|-------|---------|--------|-------|
| 1 | | ๐ด ุนุงูู / ๐ก ูุชูุณุท / ๐ข ููุฎูุถ | | |
| 2 | | | | |

---

### 3. ูุณุชูู ุฌุงูุฒูุฉ ุงููุธุงู

| ุงููุนูุงุฑ | ุงููุชูุฌุฉ |
|---------|---------|
| **ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ** | _____/100 |
| **ุงูุฏูุฉ ุงููุญุงุณุจูุฉ** | _____/100 |
| **ุฃูุงู ุงูุจูุงูุงุช** | _____/100 |
| **ุณูููุฉ ุงูุงุณุชุฎุฏุงู** | _____/100 |
| **ุงูุฃุฏุงุก** | _____/100 |
| **ุงููุฌููุน** | _____/100 |

**ุงูุชูููู ุงูููุงุฆู:**
- [ ] ๐ข ุฌุงูุฒ ููุฅูุชุงุฌ (90%+)
- [ ] ๐ก ูุญุชุงุฌ ุชุญุณููุงุช ุทูููุฉ (70-89%)
- [ ] ๐ ูุญุชุงุฌ ุชุญุณููุงุช ุฌููุฑูุฉ (50-69%)
- [ ] ๐ด ุบูุฑ ุฌุงูุฒ (<50%)

---

### 4. ููุงุท ุงูุถุนู ุงููุญุชููุฉ

1. ________________________________________________
2. ________________________________________________
3. ________________________________________________

---

### 5. ุชูุตูุงุช ุงูุชุญุณูู

| # | ุงูุชูุตูุฉ | ุงูุฃููููุฉ | ุงูุฌูุฏ ุงููุทููุจ |
|---|---------|----------|---------------|
| 1 | | ุนุงูู/ูุชูุณุท/ููุฎูุถ | ุฃูุงู/ุฃุณุงุจูุน |
| 2 | | | |
| 3 | | | |

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

### ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ ูููุฑุงุฌุนุฉ

```sql
-- ูุญุต ุณุฑูุน ููููุงุชูุฑ
SELECT invoice_number, status, return_status, 
       total_amount, returned_amount, paid_amount, original_total
FROM invoices
WHERE company_id = 'COMPANY_ID'
ORDER BY created_at DESC LIMIT 10;

-- ูุญุต ุงููุฎุฒูู
SELECT name, quantity_on_hand, cost_price, unit_price
FROM products
WHERE company_id = 'COMPANY_ID';

-- ูุญุต ุจุถุงุนุฉ ูุฏู ุงูุบูุฑ
SELECT tpi.*, i.invoice_number, i.status
FROM third_party_inventory tpi
JOIN invoices i ON i.id = tpi.invoice_id
WHERE tpi.company_id = 'COMPANY_ID';

-- ูุญุต ุงููููุฏ ุงููุญุงุณุจูุฉ
SELECT je.reference_type, je.reference_id, je.description,
       SUM(jel.debit_amount) as total_debit,
       SUM(jel.credit_amount) as total_credit
FROM journal_entries je
JOIN journal_entry_lines jel ON jel.journal_entry_id = je.id
WHERE je.company_id = 'COMPANY_ID'
GROUP BY je.id
HAVING SUM(jel.debit_amount) != SUM(jel.credit_amount);
```

---

**ููุงูุฉ ุฏููู ุงููุฑุงุฌุนุฉ ุงูุดุงููุฉ**
