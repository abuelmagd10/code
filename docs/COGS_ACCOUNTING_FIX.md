# ุชุตุญูุญ ุงููุธุงู ุงููุญุงุณุจู - COGS (Cost of Goods Sold)

## ๐ ุงููุดููุฉ

### ุงููุถุน ุงูุณุงุจู (ุฎุงุทุฆ ูุญุงุณุจููุง):
1. **ุงููุดุชุฑูุงุช ุชูุณุฌู ููุตุฑูู ูุจุงุดุฑ** ุจุฏูุงู ูู ูุฎุฒูู (Asset)
2. **COGS = 0** ูุฃูู ูู ููู ููุณุฌู ุนูุฏ ุงูุจูุน
3. **ุงูุฑุจุญ ูุถุฎู** ูุฃูู ูุง ูุฎุตู ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ
4. **ูุซุงู**: ุดุฑุงุก ุจุถุงุนุฉ ุจู 5,000 ุฌ.ู ูุจูุนูุง ุจู 10,000 ุฌ.ู
   - ุงูุฑุจุญ ุงูุธุงูุฑ: 10,000 ุฌ.ู (ุฎุทุฃ!)
   - ุงูุฑุจุญ ุงูุตุญูุญ: 5,000 ุฌ.ู

---

## โ ุงูุญู ุงููุญุงุณุจู ุงูุตุญูุญ

### ุงููุนูุงุฑ ุงููุญุงุณุจู ุงููุชุจุน (Odoo / Zoho Books / Next ERP):

```
ุงููุดุชุฑูุงุช โ ุงููุฎุฒูู (Asset)
ุนูุฏ ุงูุจูุน โ COGS = Quantity ร Cost Price
ุงูุฑุจุญ = ุงููุจูุนุงุช - COGS - ุงููุตุฑููุงุช
```

### ุงููููุฏ ุงููุญุงุณุจูุฉ:

#### 1๏ธโฃ ุนูุฏ ุงูุดุฑุงุก (Bill Sent):
```
ูุฏูู: ุงููุฎุฒูู (Asset)         5,000 ุฌ.ู
ุฏุงุฆู: ุงูุฐูู ุงูุฏุงุฆูุฉ (AP)       5,000 ุฌ.ู
```

#### 2๏ธโฃ ุนูุฏ ุงูุจูุน (Invoice Sent):
```
ุฃ) ููุฏ ุงููุจูุนุงุช:
ูุฏูู: ุงูุฐูู ุงููุฏููุฉ (AR)      10,000 ุฌ.ู
ุฏุงุฆู: ุงููุจูุนุงุช (Revenue)      10,000 ุฌ.ู

ุจ) ููุฏ COGS (ุชููุงุฆู):
ูุฏูู: ุชูููุฉ ุงูุจุถุงุนุฉ (COGS)    5,000 ุฌ.ู
ุฏุงุฆู: ุงููุฎุฒูู (Asset)         5,000 ุฌ.ู
```

#### 3๏ธโฃ ุงููุชูุฌุฉ:
- **ุงููุจูุนุงุช**: 10,000 ุฌ.ู
- **COGS**: 5,000 ุฌ.ู
- **ูุฌูู ุงูุฑุจุญ**: 5,000 ุฌ.ู
- **ุตุงูู ุงูุฑุจุญ**: 5,000 - ุงููุตุฑููุงุช

---

## ๐ง ุงูุชุบููุฑุงุช ุงููุทุจูุฉ

### 1. Database Trigger ููู COGS ุงูุชููุงุฆู
**ุงูููู**: `scripts/011_auto_cogs_trigger.sql`

- ูููุดุฆ ููุฏ COGS ุชููุงุฆููุง ุนูุฏ ุฅูุดุงุก ุญุฑูุฉ ูุฎุฒูู ูู ููุน `sale`
- ูุญุณุจ COGS = `ABS(quantity_change) ร cost_price`
- ูุฑุจุท ุญุฑูุฉ ุงููุฎุฒูู ุจุงูููุฏ ุงููุญุงุณุจู

### 2. ุชุตุญูุญ Bills API
**ุงูููู**: `app/bills/[id]/page.tsx`

- ุชุณุฌูู ุงููุดุชุฑูุงุช ูู ุญุณุงุจ ุงููุฎุฒูู (Asset) ุจุฏูุงู ูู ุงููุตุฑููุงุช
- ุงูููุฏ: `Debit: Inventory / Credit: AP`

### 3. ุชุตุญูุญ Simple Report API
**ุงูููู**: `app/api/simple-report/route.ts`

- ุญุณุงุจ COGS ูู ุงููููุฏ ุงููุญุงุณุจูุฉ ุจุดูู ุตุญูุญ
- ุชุตููุฉ ุญุณุงุจุงุช COGS (account_code = 5000 ุฃู sub_type = cogs)

### 4. ุชุตุญูุญ Income Statement
**ุงูููู**: `scripts/enhanced_reports_system.sql`

- ุฅุฒุงูุฉ ุงุณุชุจุนุงุฏ COGS ูู ูุงุฆูุฉ ุงูุฏุฎู
- COGS ูุฌุจ ุฃู ูุธูุฑ ููุตุฑูู ูู ูุงุฆูุฉ ุงูุฏุฎู

### 5. ุฅุตูุงุญ ุงูุจูุงูุงุช ุงููุฏููุฉ
**ุงูููู**: `scripts/012_fix_historical_cogs.sql`

- ุฏุงูุฉ `fix_historical_cogs()` ูุฅูุดุงุก ูููุฏ COGS ูููุนุงููุงุช ุงููุฏููุฉ
- ุชูุดุบู ูุฑุฉ ูุงุญุฏุฉ ูุชุตุญูุญ ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ

### 6. API ููุชุตุญูุญ
**ุงูููู**: `app/api/fix-cogs-accounting/route.ts`

- `GET`: ูุญุต ุญุงูุฉ ุงููุธุงู ุงููุญุงุณุจู
- `POST`: ุชุทุจูู ุงูุชุตุญูุญุงุช ุนูู ุงูุจูุงูุงุช ุงููุฏููุฉ

### 7. ูุงุฌูุฉ ุงููุณุชุฎุฏู
**ุงูููู**: `app/settings/fix-cogs/page.tsx`

- ุตูุญุฉ ููุญุต ูุชุทุจูู ุงูุชุตุญูุญุงุช ุงููุญุงุณุจูุฉ
- ุนุฑุถ ุญุงูุฉ ุงููุธุงู ููุชุงุฆุฌ ุงูุชุตุญูุญ

---

## ๐ ุงูุชุฃุซูุฑ ุนูู ุงูุชูุงุฑูุฑ ุงููุงููุฉ

### ูุจู ุงูุชุตุญูุญ:
```
ุงููุจูุนุงุช:        10,000 ุฌ.ู
COGS:                 0 ุฌ.ู  โ
ุงููุตุฑููุงุช:       2,000 ุฌ.ู
ุตุงูู ุงูุฑุจุญ:      8,000 ุฌ.ู  โ (ุฎุทุฃ!)
```

### ุจุนุฏ ุงูุชุตุญูุญ:
```
ุงููุจูุนุงุช:        10,000 ุฌ.ู
COGS:             5,000 ุฌ.ู  โ
ุงููุตุฑููุงุช:       2,000 ุฌ.ู
ุตุงูู ุงูุฑุจุญ:      3,000 ุฌ.ู  โ (ุตุญูุญ!)
```

---

## ๐ ุฎุทูุงุช ุงูุชุทุจูู

### 1. ุชุทุจูู ุงูุณูุฑูุจุชุงุช ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```sql
-- ุชุทุจูู Trigger ููู COGS ุงูุชููุงุฆู
\i scripts/011_auto_cogs_trigger.sql

-- ุชุทุจูู ุฏุงูุฉ ุฅุตูุงุญ ุงูุจูุงูุงุช ุงููุฏููุฉ
\i scripts/012_fix_historical_cogs.sql

-- ุชุญุฏูุซ ุฏุงูุฉ Income Statement
\i scripts/enhanced_reports_system.sql
```

### 2. ุฅุตูุงุญ ุงูุจูุงูุงุช ุงููุฏููุฉ:
```sql
-- ุชุดุบูู ุฏุงูุฉ ุงูุฅุตูุงุญ ููู ุดุฑูุฉ
SELECT * FROM fix_historical_cogs('YOUR_COMPANY_ID');
```

### 3. ุฃู ุงุณุชุฎุฏุงู ูุงุฌูุฉ ุงููุณุชุฎุฏู:
- ุงูุชูู ุฅูู: `/settings/fix-cogs`
- ุงุถุบุท ุนูู "ุชุทุจูู ุงูุชุตุญูุญุงุช"

---

## โ ุงูุชุญูู ูู ุงููุฌุงุญ

### 1. ูุญุต ูููุฏ COGS:
```sql
SELECT 
  je.entry_date,
  je.description,
  jel.account_id,
  coa.account_name,
  jel.debit_amount,
  jel.credit_amount
FROM journal_entries je
JOIN journal_entry_lines jel ON je.id = jel.journal_entry_id
JOIN chart_of_accounts coa ON jel.account_id = coa.id
WHERE je.reference_type = 'invoice_cogs'
ORDER BY je.entry_date DESC;
```

### 2. ูุญุต ุงูุฃุฑุจุงุญ:
```sql
SELECT 
  SUM(CASE WHEN coa.account_type = 'income' THEN jel.credit_amount - jel.debit_amount ELSE 0 END) as revenue,
  SUM(CASE WHEN coa.sub_type = 'cogs' THEN jel.debit_amount - jel.credit_amount ELSE 0 END) as cogs,
  SUM(CASE WHEN coa.account_type = 'expense' AND coa.sub_type != 'cogs' THEN jel.debit_amount - jel.credit_amount ELSE 0 END) as expenses
FROM journal_entry_lines jel
JOIN chart_of_accounts coa ON jel.account_id = coa.id
WHERE coa.company_id = 'YOUR_COMPANY_ID';
```

---

## ๐ ุงููุฑุงุฌุน

- [Odoo Accounting Documentation](https://www.odoo.com/documentation/16.0/applications/finance/accounting.html)
- [Zoho Books Inventory Accounting](https://www.zoho.com/books/guides/inventory-accounting.html)
- [GAAP - Cost of Goods Sold](https://www.investopedia.com/terms/c/cogs.asp)

---

## ๐ ุงูุฃูุงู

- ุฌููุน ุงูุชุบููุฑุงุช ุชุณุชุฎุฏู `SECURITY DEFINER` ููุญูุงูุฉ
- ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูุจู ุชุทุจูู ุงูุชุตุญูุญุงุช
- ูุง ูููู ุญุฐู ุฃู ุชุนุฏูู ุงููููุฏ ุงููุฏููุฉุ ููุท ุฅุถุงูุฉ ูููุฏ ุฌุฏูุฏุฉ

---

## ๐ ููุงุญุธุงุช

1. **ุงูู Trigger ูุนูู ููุท ุนูู ุงููุนุงููุงุช ุงูุฌุฏูุฏุฉ**
   - ูููุนุงููุงุช ุงููุฏููุฉุ ุงุณุชุฎุฏู `fix_historical_cogs()`

2. **ุงูุฎุฏูุงุช (Services) ูุง ุชุคุซุฑ ุนูู ุงููุฎุฒูู**
   - ุงูู Trigger ูุชุฌุงูู ุงูููุชุฌุงุช ูู ููุน `service`

3. **ุงูุชูููุฉ = 0 ูุง ุชููุดุฆ ููุฏ COGS**
   - ูุฌุจ ุชุญุฏูุซ `cost_price` ููููุชุฌุงุช

4. **ุงููุธุงู ูุชูุงูู ูุน ุงููุนุงููุฑ ุงููุญุงุณุจูุฉ ุงูุฏูููุฉ**
   - GAAP (Generally Accepted Accounting Principles)
   - IFRS (International Financial Reporting Standards)

