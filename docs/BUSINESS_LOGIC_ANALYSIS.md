# ุชุญููู Business Logic - ุฎุทุฉ ุนุฒู ุงูููุทู ุงููุญุงุณุจู
# Business Logic Analysis - Service Layer Migration Plan

**ุชุงุฑูุฎ ุงูุชุญููู:** 2025-01-27  
**ุงููุฏู:** ุชุญููู ุงูููุทู ุงูููุฌูุฏ ูู UI ูุงูุชุฑุงุญ Service Layer  
**โ๏ธ ููู:** ูุฐุง ุชุญููู ููุท - ูุง ุชูููุฐ ุงูุขู

---

## ๐ ุงูููุฎุต ุงูุชูููุฐู

**ุงููุฏู:** ุนุฒู Business Logic ูู UI ุฅูู Service Layer  
**ุงููููุฌูุฉ:** ุชุญููู ููุท - ูุง ููู ูุนูู  
**ุงููุชูุฌุฉ:** ุฎุทุฉ ูุงุถุญุฉ ููููู ูุงุญูุงู ุจุฏูู ูุณุฑ ุงูุฃููุงุท

---

## ๐ ุงูููุทู ุงูููุฌูุฏ ูู UI

### 1๏ธโฃ ููุทู ุฅูุดุงุก ูููุฏ COGS

**ุงููููุน:** `app/invoices/[id]/page.tsx`

**ุงูุณุทูุฑ:** ~1888-1979

**ูุง ููุนูู:**
- ุญุณุงุจ ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ (COGS)
- ุฅูุดุงุก ูููุฏ ูุญุงุณุจูุฉ ุชููุงุฆูุงู
- ุฑุจุท ุงููููุฏ ุจุงููุงุชูุฑุฉ

**ุงููุดููุฉ:**
- โ ููุทู ูุญุงุณุจู ูุนูุฏ ูู UI
- โ ุตุนูุจุฉ ุงูุงุฎุชุจุงุฑ
- โ ุตุนูุจุฉ ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู

**ุงูุชุฑุงุญ Service:**
```typescript
// lib/services/journal-service.ts
export async function createCOGSEntry(
  supabase: SupabaseClient,
  invoiceId: string,
  companyId: string
): Promise<{ success: boolean; journalEntryId?: string; error?: string }>
```

---

### 2๏ธโฃ ููุทู ุฅูุดุงุก ุงููููุฏ ุงููุญุงุณุจูุฉ

**ุงููููุน:** `app/invoices/[id]/page.tsx`

**ุงูุณุทูุฑ:** ~1954-1973

**ูุง ููุนูู:**
- ุฅูุดุงุก ูููุฏ ูุญุงุณุจูุฉ ููููุงุชูุฑ
- ุฑุจุท ุงููููุฏ ุจุงูุญุณุงุจุงุช
- ุงูุชุญูู ูู ุงูุชูุงุฒู

**ุงููุดููุฉ:**
- โ ููุทู ูุญุงุณุจู ูู UI
- โ ุชูุฑุงุฑ ุงูููุฏ

**ุงูุชุฑุงุญ Service:**
```typescript
// lib/services/journal-service.ts
export async function createInvoiceJournalEntry(
  supabase: SupabaseClient,
  invoice: Invoice,
  companyId: string
): Promise<{ success: boolean; journalEntryId?: string; error?: string }>
```

---

### 3๏ธโฃ ููุทู ุชุญุฏูุซ ุงููุฎุฒูู

**ุงููููุน:** `app/bills/new/page.tsx`

**ุงูุณุทูุฑ:** ~531-551

**ูุง ููุนูู:**
- ุชุญุฏูุซ ุงููุฎุฒูู ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ุดุฑุงุก
- ุฅูุดุงุก ุญุฑูุงุช ูุฎุฒูู
- ุฑุจุท ุญุฑูุงุช ุงููุฎุฒูู ุจุงููุงุชูุฑุฉ

**ุงููุดููุฉ:**
- โ ููุทู ูุฎุฒูู ูู UI
- โ ุตุนูุจุฉ ุงูุงุฎุชุจุงุฑ

**ุงูุชุฑุงุญ Service:**
```typescript
// lib/services/inventory-service.ts
export async function updateInventoryFromBill(
  supabase: SupabaseClient,
  billId: string,
  companyId: string
): Promise<{ success: boolean; error?: string }>
```

---

### 4๏ธโฃ ููุทู ุงููุฏููุนุงุช

**ุงููููุน:** `app/payments/page.tsx`

**ูุง ููุนูู:**
- ุชุณุฌูู ุงููุฏููุนุงุช
- ุชุญุฏูุซ ุฃุฑุตุฏุฉ ุงูููุงุชูุฑ
- ุฅูุดุงุก ูููุฏ ูุญุงุณุจูุฉ ูููุฏููุนุงุช

**ุงููุดููุฉ:**
- โ ููุทู ูุญุงุณุจู ูู UI
- โ ุชูุฑุงุฑ ุงูููุฏ

**ุงูุชุฑุงุญ Service:**
```typescript
// lib/services/payment-service.ts
export async function recordPayment(
  supabase: SupabaseClient,
  payment: PaymentInput,
  companyId: string
): Promise<{ success: boolean; paymentId?: string; error?: string }>
```

---

## ๐ฏ ุงูุชุฑุงุญ Service Layer

### ุงููููู ุงูููุชุฑุญ:

```
lib/services/
โโโ invoice-service.ts      # ุฎุฏูุงุช ุงูููุงุชูุฑ
โโโ journal-service.ts      # ุฎุฏูุงุช ุงููููุฏ ุงููุญุงุณุจูุฉ
โโโ inventory-service.ts     # ุฎุฏูุงุช ุงููุฎุฒูู
โโโ payment-service.ts       # ุฎุฏูุงุช ุงููุฏููุนุงุช
โโโ bill-service.ts          # ุฎุฏูุงุช ููุงุชูุฑ ุงูุดุฑุงุก
โโโ index.ts                 # Export ููุญุฏ
```

### 1. Invoice Service

**ุงูููู:** `lib/services/invoice-service.ts`

**ุงูุฏูุงู ุงูููุชุฑุญุฉ:**
```typescript
// ุฅูุดุงุก ููุฏ ูุญุงุณุจู ูููุงุชูุฑุฉ
export async function createInvoiceJournalEntry(...)

// ุฅูุดุงุก ููุฏ COGS ูููุงุชูุฑุฉ
export async function createCOGSEntry(...)

// ุชุญุฏูุซ ุญุงูุฉ ุงููุงุชูุฑุฉ
export async function updateInvoiceStatus(...)

// ุงูุชุญูู ูู ุฅููุงููุฉ ุงูุชุนุฏูู
export async function canEditInvoice(...)
```

**ูุง ุณูุชู ูููู:**
- ููุทู ุฅูุดุงุก ุงููููุฏ ูู `app/invoices/[id]/page.tsx`
- ููุทู COGS ูู `app/invoices/[id]/page.tsx`
- ููุทู ุชุญุฏูุซ ุงูุญุงูุฉ

---

### 2. Journal Service

**ุงูููู:** `lib/services/journal-service.ts`

**ุงูุฏูุงู ุงูููุชุฑุญุฉ:**
```typescript
// ุฅูุดุงุก ููุฏ ูุญุงุณุจู
export async function createJournalEntry(...)

// ุงูุชุญูู ูู ุชูุงุฒู ุงูููุฏ
export async function validateJournalBalance(...)

// ุฑุจุท ููุฏ ุจูุณุชูุฏ
export async function linkJournalToDocument(...)
```

**ูุง ุณูุชู ูููู:**
- ููุทู ุฅูุดุงุก ุงููููุฏ
- ููุทู ุงูุชุญูู ูู ุงูุชูุงุฒู
- ููุทู ุงูุฑุจุท ุจุงููุณุชูุฏุงุช

---

### 3. Inventory Service

**ุงูููู:** `lib/services/inventory-service.ts`

**ุงูุฏูุงู ุงูููุชุฑุญุฉ:**
```typescript
// ุชุญุฏูุซ ุงููุฎุฒูู ูู ูุงุชูุฑุฉ
export async function updateInventoryFromInvoice(...)

// ุชุญุฏูุซ ุงููุฎุฒูู ูู ูุงุชูุฑุฉ ุดุฑุงุก
export async function updateInventoryFromBill(...)

// ุงูุชุญูู ูู ุชููุฑ ุงููุฎุฒูู
export async function checkInventoryAvailability(...)
```

**ูุง ุณูุชู ูููู:**
- ููุทู ุชุญุฏูุซ ุงููุฎุฒูู ูู `app/bills/new/page.tsx`
- ููุทู ุงูุชุญูู ูู ุงููุฎุฒูู (ููุฌูุฏ ูู `lib/inventory-check.ts` - ุฌูุฏ)

---

### 4. Payment Service

**ุงูููู:** `lib/services/payment-service.ts`

**ุงูุฏูุงู ุงูููุชุฑุญุฉ:**
```typescript
// ุชุณุฌูู ุฏูุนุฉ
export async function recordPayment(...)

// ุชุญุฏูุซ ุฑุตูุฏ ุงููุงุชูุฑุฉ
export async function updateInvoiceBalance(...)

// ุฅูุดุงุก ููุฏ ูุญุงุณุจู ููุฏูุนุฉ
export async function createPaymentJournalEntry(...)
```

**ูุง ุณูุชู ูููู:**
- ููุทู ุชุณุฌูู ุงููุฏููุนุงุช ูู `app/payments/page.tsx`
- ููุทู ุชุญุฏูุซ ุงูุฃุฑุตุฏุฉ
- ููุทู ุงููููุฏ ุงููุญุงุณุจูุฉ

---

## ๐ ุฎุทุฉ ุงูููู (ูุงุญูุงู)

### ุงููุฑุญูุฉ 1: ุฅูุดุงุก Services (ุจุฏูู ุงุณุชุฎุฏุงู)
1. ุฅูุดุงุก ูููุงุช Services
2. ููู ุงูุฏูุงู ูู UI ุฅูู Services
3. ุงูุญูุงุธ ุนูู ููุณ ุงููุงุฌูุฉ (API)
4. ุงุฎุชุจุงุฑ Services ุจุดูู ูููุตู

### ุงููุฑุญูุฉ 2: ุงุณุชุฎุฏุงู Services ูู UI
1. ุงุณุชุจุฏุงู ุงูููุฏ ูู UI ุจุงุณุชุฏุนุงุก Services
2. ุงูุญูุงุธ ุนูู ููุณ ุงูุณููู
3. ุงุฎุชุจุงุฑ ุดุงูู

### ุงููุฑุญูุฉ 3: ุชูุธูู
1. ุญุฐู ุงูููุฏ ุงูููุฑุฑ
2. ุชุญุณูู Services
3. ุชูุซูู

---

## โ๏ธ ููุงุนุฏ ุงูููู

### โ ูุง ูุฌุจ ูุนูู:
- โ ููู ุงูููุฏ ููุง ูู (ุจุฏูู ุชุบููุฑ ุงูููุทู)
- โ ุงูุญูุงุธ ุนูู ููุณ ุงููุงุฌูุฉ
- โ ุงูุญูุงุธ ุนูู ููุณ ุงููุชุงุฆุฌ
- โ ุงุฎุชุจุงุฑ ุดุงูู ูุจู ูุจุนุฏ

### โ ูุง ูุฌุจ ุชุฌูุจู:
- โ ุชุบููุฑ ุงูููุทู ุฃุซูุงุก ุงูููู
- โ ุชุบููุฑ ุงููุชุงุฆุฌ
- โ ูุณุฑ ุงูุฃููุงุท ุงููุงุฆูุฉ
- โ ููู ุจุฏูู ุงุฎุชุจุงุฑ

---

## ๐ ุงูุชูููู

**ุงูููุทู ุงูููุฌูุฏ ูู UI:**
- โ๏ธ ~500 ุณุทุฑ ูู Business Logic ูู UI
- โ๏ธ 4 ูููุงุช ุฑุฆูุณูุฉ ุชุญุชุงุฌ ููู
- โ๏ธ ุชูุฑุงุฑ ูู ุนุฏุฉ ุฃูุงูู

**ุจุนุฏ ุงูููู:**
- โ Business Logic ูุนุฒูู ูู Services
- โ UI ุจุณูุท ููุงุถุญ
- โ ูุงุจู ููุงุฎุชุจุงุฑ
- โ ูุงุจู ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู

---

## ๐ฏ ุงูุฎูุงุตุฉ

**ุงููุฏู:** ุนุฒู Business Logic ูู UI ุฅูู Service Layer  
**ุงููููุฌูุฉ:** ุชุญููู ููุท - ูุง ุชูููุฐ ุงูุขู  
**ุงูุฎุทุฉ:** ูุงุถุญุฉ ูููุตูุฉ ููููู ูุงุญูุงู  
**ุงูุถูุงู:** ูุง ูุณุฑ ููุฃููุงุท - ููุณ ุงููุชุงุฆุฌ

---

**โ๏ธ ููุงุญุธุฉ:** ูุฐุง ุชุญููู ููุท - ูุง ุชูููุฐ ุงูุขู. ุงูููู ุณูุชู ูุงุญูุงู ุจุนุฏ ุงูุชุฃูุฏ ูู ุนุฏู ูุณุฑ ุฃู ููุท.
