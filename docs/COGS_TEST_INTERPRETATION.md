# ุชูุณูุฑ ูุชุงุฆุฌ ุงุฎุชุจุงุฑ ูุธุงู COGS Professional

## ๐ ุงููุชุงุฆุฌ ุงูููุณุชููุฉ

```json
{
  "total_cogs_transactions": 0,
  "invoices_with_cogs": 0,
  "returns_with_cogs_reversal": 0,
  "missing_governance": 0,
  "overall_status": "โ ุฌููุน COGS Transactions ูุฏููุง ุญูููุฉ ูุงููุฉ"
}
```

---

## โ ุงูุชูุณูุฑ

### ุงููุชูุฌุฉ ุทุจูุนูุฉ ููุชููุนุฉ

ูุฐู ุงููุชุงุฆุฌ ุทุจูุนูุฉ ูุชุดูุฑ ุฅูู:

1. โ **ุงูุฌุฏูู ููุฌูุฏ ููุนูู** - ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู SQL migration
2. โ **ุงูุญูููุฉ ุณูููุฉ** - ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู
3. โน๏ธ **ูุง ุชูุฌุฏ COGS transactions ุจุนุฏ** - ูุฃู ุงููุธุงู ูู ููุณุชุฎุฏู ุจุนุฏ ุงูุชุญุฏูุซ

---

## ๐ ุงูุญุงูุฉ ุงูุญุงููุฉ

### ุงููุถุน:
- โ ุฌุฏูู `cogs_transactions` ููุฌูุฏ
- โ RLS Policies ููุนูุฉ
- โ ุงูุญูููุฉ ุณูููุฉ
- โน๏ธ ูุง ุชูุฌุฏ ููุงุชูุฑ ุฌุฏูุฏุฉ ุชู ุฅุฑุณุงููุง ุจุนุฏ ุงูุชุญุฏูุซ

### ุงูุณุจุจ:
ุงูููุงุชูุฑ ุงููุฏููุฉ (ูุจู ุงูุชุญุฏูุซ) ูุง ุชุญุชูู ุนูู COGS transactions ูุฃููุง ุชู ุฅูุดุงุคูุง ูุจู ุชุทุจูู ุงููุธุงู ุงูุฌุฏูุฏ.

---

## ๐งช ุงูุฎุทูุงุช ุงูุชุงููุฉ ููุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ ูุฅุฑุณุงููุง

**ุงูุฅุฌุฑุงุกุงุช**:
1. ุฅูุดุงุก Invoice ุฌุฏูุฏุฉ (Draft)
2. ุฅุถุงูุฉ ููุชุฌุงุช (ูู ููุชุฌุงุช ูุฏููุง FIFO Lots)
3. ุงูุชุฃูุฏ ูู ูุฌูุฏ `branch_id`, `cost_center_id`, `warehouse_id`
4. ุชุบููุฑ ุญุงูุฉ Invoice ุฅูู `sent`
5. ุงูุชุญูู ูู ุฅูุดุงุก COGS Transactions

**ุงูุชุญูู**:
```sql
-- ุจุนุฏ ุฅุฑุณุงู ุงููุงุชูุฑุฉุ ุชุญูู ูู:
SELECT * FROM cogs_transactions
WHERE source_type = 'invoice'
  AND source_id = '[NEW_INVOICE_ID]';
```

---

### ุงุฎุชุจุงุฑ 2: ุงุณุชุฎุฏุงู ูุงุชูุฑุฉ ูุฏููุฉ (ุงุฎุชูุงุฑู)

ุฅุฐุง ููุช ุชุฑูุฏ ุงุฎุชุจุงุฑ ุงููุธุงู ุนูู ูุงุชูุฑุฉ ูุฏููุฉุ ููููู:

1. **ุฅูุดุงุก COGS Transactions ูุฏููุงู** ููููุงุชูุฑ ุงููุฏููุฉ (ุบูุฑ ููุตู ุจู)
2. **ุฃู**: ุงุณุชุฎุฏุงู ููุงุชูุฑ ุฌุฏูุฏุฉ ููุท (ููุตู ุจู)

**ููุงุญุธุฉ**: ุงูููุงุชูุฑ ุงููุฏููุฉ ุจุฏูู COGS transactions ุณุชุณุชุฎุฏู fallback ุฅูู `cost_price` ูู ุงูุชูุงุฑูุฑ (ููุชูุงูู).

---

## ๐ ุงูุชุญูู ูู ุฌุงูุฒูุฉ ุงููุธุงู

### ุงุณุชุฎุฏู ุณูุฑูุจุช ุงูุชุญูู:

```bash
# ุชุดุบูู ุณูุฑูุจุช ุงูุชุญูู
psql -h [DB_HOST] -U [USER] -d [DB_NAME] -f scripts/verify_cogs_system.sql
```

ูุฐุง ุงูุณูุฑูุจุช ูุชุญูู ูู:
- ูุฌูุฏ ุงูุฌุฏูู ูุงููููู
- ูุฌูุฏ ููุงุชูุฑ ุฌุงูุฒุฉ ููุงุฎุชุจุงุฑ
- ูุฌูุฏ FIFO Lots ููููุชุฌุงุช
- ุญุงูุฉ ุงููุธุงู ุงูุนุงูุฉ

---

## โ Checklist ูุจู ุงูุงุฎุชุจุงุฑ

- [ ] โ SQL Migration ุชู ุชุทุจููู (`cogs_transactions` ููุฌูุฏ)
- [ ] โ ุงูุชุญุฏูุซุงุช ุงูุจุฑูุฌูุฉ ุชู ูุดุฑูุง
- [ ] ๐ ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ ูุฅุฑุณุงููุง (ูุงุฎุชุจุงุฑ COGS)
- [ ] ๐ ุงูุชุญูู ูู ูุฌูุฏ FIFO Lots ููููุชุฌุงุช
- [ ] ๐ ุงูุชุญูู ูู ูุฌูุฏ `branch_id`, `cost_center_id`, `warehouse_id` ูู ุงููุงุชูุฑุฉ

---

## ๐ ุงูุณููุงุฑูู ุงูููุตู ุจู ููุงุฎุชุจุงุฑ

### 1๏ธโฃ ุฅุนุฏุงุฏ ุงูุจูุงูุงุช
```sql
-- ุงูุชุญูู ูู ูุฌูุฏ FIFO Lots
SELECT 
  p.name as product_name,
  COUNT(fl.id) as fifo_lots_count,
  SUM(fl.remaining_quantity) as total_remaining_qty
FROM products p
LEFT JOIN fifo_cost_lots fl ON fl.product_id = p.id AND fl.remaining_quantity > 0
WHERE p.item_type = 'product'
GROUP BY p.id, p.name
HAVING SUM(fl.remaining_quantity) > 0
LIMIT 10;
```

### 2๏ธโฃ ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ
- ุงุณุชุฎุฏู ูุงุฌูุฉ ุงููุณุชุฎุฏู
- ุฃุถู ููุชุฌุงุช ูุฏููุง FIFO Lots
- ุชุฃูุฏ ูู ุชุนุจุฆุฉ `branch_id`, `cost_center_id`, `warehouse_id`

### 3๏ธโฃ ุฅุฑุณุงู ุงููุงุชูุฑุฉ
- ุบูุฑ ุญุงูุฉ Invoice ุฅูู `sent`
- ุชุญูู ูู Console Logs (ูุฌุจ ุฃู ุชุฑู: `โ COGS created...`)

### 4๏ธโฃ ุงูุชุญูู ูู COGS Transactions
```sql
SELECT 
  ct.*,
  p.name as product_name,
  i.invoice_number
FROM cogs_transactions ct
JOIN products p ON ct.product_id = p.id
JOIN invoices i ON ct.source_id = i.id
WHERE ct.source_type = 'invoice'
  AND ct.created_at >= CURRENT_DATE
ORDER BY ct.created_at DESC;
```

---

## ๐ฏ ุงููุชูุฌุฉ ุงููุชููุนุฉ ุจุนุฏ ุงูุงุฎุชุจุงุฑ

ุจุนุฏ ุฅุฑุณุงู ูุงุชูุฑุฉ ุฌุฏูุฏุฉุ ูุฌุจ ุฃู ุชุฑู:

```json
{
  "total_cogs_transactions": 3,  // ุนูู ุณุจูู ุงููุซุงู (ุญุณุจ ุนุฏุฏ ุงูููุชุฌุงุช)
  "invoices_with_cogs": 1,
  "returns_with_cogs_reversal": 0,
  "missing_governance": 0,
  "overall_status": "โ ุฌููุน COGS Transactions ูุฏููุง ุญูููุฉ ูุงููุฉ"
}
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุงูููุงุชูุฑ ุงููุฏููุฉ**: ูู ุชุญุชูู ุนูู COGS transactions (ุทุจูุนู)
   - ุงููุธุงู ูุณุชุฎุฏู fallback ุฅูู `cost_price` ููุชูุงูู

2. **ุงูููุงุชูุฑ ุงูุฌุฏูุฏุฉ**: ูุฌุจ ุฃู ุชุญุชูู ุนูู COGS transactions ุชููุงุฆูุงู
   - ุฅุฐุง ูู ูุชู ุฅูุดุงุคูุงุ ุชุญูู ูู:
     - ูุฌูุฏ `branch_id`, `cost_center_id`, `warehouse_id`
     - ูุฌูุฏ FIFO Lots ููููุชุฌุงุช
     - Console Logs ููุฃุฎุทุงุก

3. **Dashboard Stats**: ุณูุนุฑุถ COGS ูู `cogs_transactions` ููุท ููููุงุชูุฑ ุงูุฌุฏูุฏุฉ

---

## โ ุงูุฎูุงุตุฉ

**ุงูุญุงูุฉ ุงูุญุงููุฉ**: โ ุงููุธุงู ุฌุงูุฒ ููุนูู ุจุดูู ุตุญูุญ

**ุงูุฎุทูุฉ ุงูุชุงููุฉ**: ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ ูุฅุฑุณุงููุง ูุงุฎุชุจุงุฑ ุงููุธุงู ูุนููุงู

**ุจุนุฏ ุงูุงุฎุชุจุงุฑ**: ุฅุฐุง ูุฌุญ ุงูุงุฎุชุจุงุฑุ ููุชูู ุฅูู Inventory Depreciation
